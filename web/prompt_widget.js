const _0xe95701=_0x431d;(function(_0xd915fe,_0x31ab61){const _0x34fdb3=_0x431d,_0x29db9a=_0xd915fe();while(!![]){try{const _0x557e56=-parseInt(_0x34fdb3(0x1dd))/0x1+-parseInt(_0x34fdb3(0x3ae))/0x2+-parseInt(_0x34fdb3(0x218))/0x3+-parseInt(_0x34fdb3(0x3c6))/0x4+parseInt(_0x34fdb3(0x369))/0x5+parseInt(_0x34fdb3(0x396))/0x6+parseInt(_0x34fdb3(0x26c))/0x7;if(_0x557e56===_0x31ab61)break;else _0x29db9a['push'](_0x29db9a['shift']());}catch(_0x47513c){_0x29db9a['push'](_0x29db9a['shift']());}}}(_0x3adf,0xdd6a7));import{app}from'../../../scripts/app.js';import{$el}from'../../../scripts/ui.js';import{api}from'../../../scripts/api.js';const EXTENSION_NAME=_0xe95701(0x3cc),EXTENSION_VERSION=_0xe95701(0x3ad);let DEBUG=![];const FEATURES={'enabled':!![],'history':!![],'preset':!![],'expand':!![],'translate':!![],'areAllFeaturesDisabled'(){return!this['history']&&!this['preset']&&!this['expand']&&!this['translate'];},'updateEnabledState'(){const _0x309164=_0xe95701,_0x4d60b6={'qKSgW':'PromptWidget.Features.Enabled'},_0x3eb1be=this['areAllFeaturesDisabled']();if(_0x3eb1be&&this['enabled']){this[_0x309164(0x3c7)]=![];const _0x1f722b=app['ui']['settings']['getSettingValue'](_0x4d60b6[_0x309164(0x288)]);_0x1f722b&&app['ui'][_0x309164(0x3db)]['setSettingValue'](_0x4d60b6['qKSgW'],![]),TranslateManager['cleanup'](),logger['log'](_0x309164(0x33d));}}},THROTTLE={'minInterval':0x3e8,'lastRequestTime':{},'lastRequestText':{},'shouldThrottle'(_0x355f4d,_0x33de81){const _0x5bfb0b=_0xe95701,_0x561787={'juWcO':function(_0x3f4a26,_0x35fa3c){return _0x3f4a26<_0x35fa3c;}},_0x14b164=Date['now'](),_0x484a1b=this['lastRequestTime'][_0x355f4d]||0x0,_0x27b25c=this[_0x5bfb0b(0x1de)][_0x355f4d]||'';if(_0x33de81===_0x27b25c&&_0x561787[_0x5bfb0b(0x401)](_0x14b164-_0x484a1b,this[_0x5bfb0b(0x30a)]))return logger['warn']('节点\x20'+_0x355f4d+'\x20请求过于频繁，已自动节流'),!![];return this['lastRequestTime'][_0x355f4d]=_0x14b164,this['lastRequestText'][_0x355f4d]=_0x33de81,![];}},getAssetPath=_0x2835cb=>{return'./assets/'+_0x2835cb;},logger={'printedMessages':new Set(),'log':(..._0x18eef6)=>{const _0xf7322a=_0xe95701;if(!FEATURES['enabled'])return;const _0x2cd216=_0x18eef6['join']('\x20');DEBUG&&!logger['printedMessages']['has'](_0x2cd216)&&(console['log']('[PromptWidget]',..._0x18eef6),logger[_0xf7322a(0x210)]['add'](_0x2cd216));},'warn':(..._0x40527b)=>{const _0xff7393=_0xe95701;if(!FEATURES[_0xff7393(0x3c7)])return;console['warn']('[PromptWidget]',..._0x40527b);},'error':(..._0x50f166)=>{if(!FEATURES['enabled'])return;console['error']('[PromptWidget]',..._0x50f166);},'info':(..._0xe82c85)=>{const _0x125f74=_0xe95701;if(!FEATURES[_0x125f74(0x3c7)])return;DEBUG&&console[_0x125f74(0x349)]('[PromptWidget]',..._0xe82c85);}},DOMUtils={'removeElement'(_0x53ed7f){const _0x414db0=_0xe95701,_0x4f6df7={'jbzAM':'div'};if(!_0x53ed7f)return![];try{while(_0x53ed7f['firstChild']){_0x53ed7f['removeChild'](_0x53ed7f['firstChild']);}if(_0x53ed7f['parentNode'])return _0x53ed7f['parentNode']['removeChild'](_0x53ed7f),!![];if(document['body']['contains'](_0x53ed7f))return document['body']['removeChild'](_0x53ed7f),!![];const _0x1d2f8c=document[_0x414db0(0x32a)](_0x4f6df7[_0x414db0(0x2df)]);if(_0x53ed7f[_0x414db0(0x3ef)])return _0x53ed7f['parentNode']['replaceChild'](_0x1d2f8c,_0x53ed7f),_0x1d2f8c[_0x414db0(0x2a4)](),!![];}catch(_0x5d60f5){logger['error']('移除DOM元素出错:',_0x5d60f5);}return![];},'removeElementsBySelector'(_0x346e4d,_0x287cfa=null){const _0xffb055=_0xe95701,_0x382768={'brfrL':function(_0x49122e,_0x273392){return _0x49122e(_0x273392);}};try{const _0x585482=document[_0xffb055(0x1d0)](_0x346e4d);if(_0x585482['length']===0x0)return 0x0;let _0x2503d2=0x0;return _0x585482['forEach'](_0x191f9d=>{const _0x4946ca=_0xffb055;(!_0x287cfa||_0x382768[_0x4946ca(0x291)](_0x287cfa,_0x191f9d))&&(this['removeElement'](_0x191f9d)&&_0x2503d2++);}),_0x2503d2;}catch(_0x1aa3b1){return logger['error']('移除选择器\x20'+_0x346e4d+_0xffb055(0x386),_0x1aa3b1),0x0;}},'removeElementsBySelectors'(_0x2c16cf,_0x3cde6e=null){const _0x5d7039=_0xe95701;if(!_0x2c16cf||!Array['isArray'](_0x2c16cf))return 0x0;let _0x9b14bf=0x0;return _0x2c16cf[_0x5d7039(0x1df)](_0x49b760=>{_0x9b14bf+=this['removeElementsBySelector'](_0x49b760,_0x3cde6e);}),_0x9b14bf;}},TranslateManager={'instances':new Map(),'history':new Map(),'activeHistoryPopup':null,'activePresetPopup':null,'translationCache':new Map(),'presets':null,'socket':null,'socketInitialized':![],'statusTips':null,'setupWebSocket'(){const _0x5b7f00=_0xe95701;if(this['socketInitialized'])return;try{api[_0x5b7f00(0x3ca)]('prompt_translate_update',_0x37db32=>{this['handleTranslationUpdate'](_0x37db32);}),api['addEventListener']('prompt_widget_config_update',_0x2bb986=>{this['handleConfigUpdate'](_0x2bb986);}),this['socketInitialized']=!![],logger['info']('WebSocket监听已初始化');}catch(_0x258534){logger[_0x5b7f00(0x20f)]('WebSocket初始化失败:',_0x258534);}},'handleTranslationUpdate'(_0xae7288){const _0x4b801d=_0xe95701,_0x240ab0={'BBxSq':_0x4b801d(0x20f),'cxBsp':_0x4b801d(0x2a3),'stUii':function(_0x4ade55,_0x29ce0f){return _0x4ade55===_0x29ce0f;},'XpCnX':'恢复原文'};try{logger['info']('收到翻译更新:',_0xae7288);const {node_id:_0x3d52f3,status:_0x49c9b8,translated_text:_0x181e6d,original_text:_0x1daf42,message:_0x138565,progress:_0x2a485f,operation_type:_0x2f1ce7,operation_desc:_0x5c202b,translate_direction:_0x16cb3d}=_0xae7288;if(!_0x3d52f3)return;const _0x2cc4a6=this[_0x4b801d(0x2e9)](_0x3d52f3);if(!_0x2cc4a6){logger['warn'](_0x4b801d(0x368)+_0x3d52f3+'\x20的实例');return;}const _0xa5c010=_0x2cc4a6[_0x4b801d(0x1ff)]?.[_0x4b801d(0x203)]||_0x2cc4a6['text_element'];if(_0x49c9b8==='translating'&&_0x2a485f){const {current:_0x2eec0a,total:_0x512081}=_0x2a485f;_0x2cc4a6[_0x4b801d(0x3e3)]&&this[_0x4b801d(0x31d)](_0xa5c010,_0x4b801d(0x3e6),'翻译中\x20'+_0x2eec0a+'/'+_0x512081+'...');return;}if(_0x49c9b8===_0x4b801d(0x20f)&&_0x138565){logger['error']('翻译错误:\x20'+_0x138565);_0x2cc4a6['text_element']&&this['showStatusTip'](_0xa5c010,_0x240ab0['BBxSq'],_0x138565);_0x2cc4a6['buttons']?.[_0x4b801d(0x203)]&&_0x2cc4a6[_0x4b801d(0x1ff)][_0x4b801d(0x203)]['classList'][_0x4b801d(0x2a4)]('widget_button_loading');return;}if(_0x49c9b8==='success'&&_0x181e6d&&_0x1daf42){this['translationCache']['set'](_0x1daf42,_0x181e6d),this['translationCache']['set'](_0x181e6d,_0x1daf42);if(_0x2cc4a6['text_element']){this['updateTextValue'](_0x2cc4a6['text_element'],_0x181e6d),this[_0x4b801d(0x3e0)](_0x3d52f3,_0x181e6d),this[_0x4b801d(0x325)](_0x2cc4a6['text_element'],'prompt_text_updated');if(_0x2f1ce7===_0x240ab0['cxBsp'])this['showStatusTip'](_0xa5c010,'restore',_0x5c202b||'已恢复'),_0x240ab0['stUii'](_0x5c202b,_0x240ab0['XpCnX'])&&(_0x2cc4a6['originalText']=_0x181e6d);else{if(_0x16cb3d){_0x2cc4a6[_0x4b801d(0x27d)]=_0x1daf42;const _0xcfbea=_0xae7288['from_cache']?'(缓存)':'';this[_0x4b801d(0x31d)](_0xa5c010,'success',_0x16cb3d+'完成'+_0xcfbea);}else _0x2cc4a6['originalText']=_0x1daf42,this[_0x4b801d(0x31d)](_0xa5c010,'success','翻译完成');}}_0x2cc4a6['buttons']?.['translate']&&_0x2cc4a6['buttons']['translate']['classList']['remove'](_0x4b801d(0x323));}}catch(_0x424221){logger['error']('处理翻译更新事件失败:',_0x424221);}},'handleConfigUpdate'(_0x3e2fe5){const _0x39e6fc=_0xe95701,_0x51170e={'NUJSQ':function(_0x405aeb,_0x21f85f){return _0x405aeb===_0x21f85f;},'HoDKf':'success','BWabF':function(_0x1f0a80,_0xed0bd0){return _0x1f0a80(_0xed0bd0);},'rXyvp':'配置已更新'};try{logger['info']('收到配置更新:',_0x3e2fe5);if(_0x51170e[_0x39e6fc(0x28e)](_0x3e2fe5[_0x39e6fc(0x254)],_0x51170e['HoDKf']))_0x3e2fe5['config']&&(this['reloadConfig'](),_0x51170e['BWabF'](showSuccessToast,_0x51170e[_0x39e6fc(0x1cc)]));else{}}catch(_0xbd2061){logger[_0x39e6fc(0x20f)](_0x39e6fc(0x2e3),_0xbd2061);}},async 'callBaiduTranslateAPI'(_0x14b73d,_0x57e293,_0x55fcb2='auto',_0x315d10=_0xe95701(0x20a)){const _0x2bd9a7=_0xe95701,_0x264739={'TNGSd':'application/json','FxLyx':'调用百度翻译API失败:','PoFKz':'error'};try{if(!_0x14b73d||!_0x14b73d[_0x2bd9a7(0x33e)]())return{'status':_0x2bd9a7(0x20f),'message':'翻译文本为空'};if(THROTTLE['shouldThrottle'](_0x57e293,_0x14b73d))return{'status':'error','message':'请求过于频繁，请稍后再试'};DEBUG&&logger['info'](_0x2bd9a7(0x2d1)+_0x14b73d[_0x2bd9a7(0x215)]+'字符,\x20节点ID:\x20'+_0x57e293);const _0x6f6ec3=await api[_0x2bd9a7(0x2e6)]('/prompt_translate',{'method':'POST','headers':{'Content-Type':_0x264739['TNGSd']},'body':JSON['stringify']({'text':_0x14b73d,'node_id':_0x57e293,'from_lang':_0x55fcb2,'to_lang':_0x315d10})});if(!_0x6f6ec3['ok'])throw new Error('HTTP\x20error!\x20status:\x20'+_0x6f6ec3['status']);const _0x4f13e7=await _0x6f6ec3['json']();if(DEBUG){const _0x4fb573=JSON[_0x2bd9a7(0x3f1)](_0x4f13e7)['substring'](0x0,0x64);logger['info'](_0x2bd9a7(0x381)+_0x4fb573+'...');}return _0x4f13e7;}catch(_0x4f6cf0){return logger['error'](_0x264739['FxLyx'],_0x4f6cf0),{'status':_0x264739[_0x2bd9a7(0x1e4)],'message':_0x2bd9a7(0x39c)+_0x4f6cf0['message']};}},'isNodeExists'(_0x2ff1b7){const _0x444c82=_0xe95701;if(!_0x2ff1b7)return![];try{const _0x3ddc74=_0x444c82(0x3ed)['split']('|');let _0x437131=0x0;while(!![]){switch(_0x3ddc74[_0x437131++]){case'0':if(!app['graph'])return![];continue;case'1':if(app['graph']['_nodes_by_id']&&app['graph']['_nodes_by_id'][_0x2ff1b7]!==undefined)return!![];continue;case'2':return![];case'3':if(app['graph']['nodes'])return app['graph']['nodes'][_0x444c82(0x242)](_0x3dc9d8=>_0x3dc9d8['id']===_0x2ff1b7);continue;case'4':if(app[_0x444c82(0x1d7)]['getNodeById'])return!!app['graph']['getNodeById'](_0x2ff1b7);continue;}break;}}catch(_0x5cbf5a){return logger['error']('检查节点\x20'+_0x2ff1b7+'\x20存在性时出错:',_0x5cbf5a),![];}},'initOrClearHistory'(_0x3986db,_0x293318=![]){const _0x3ccba8=_0xe95701,_0x471ea2={'WOGDe':function(_0x425f40,_0x1844ba){return _0x425f40(_0x1844ba);}};if(!_0x3986db)return![];try{const _0x3b7e8b=_0x471ea2['WOGDe'](String,_0x3986db);return(!this['history']['has'](_0x3b7e8b)||_0x293318)&&this[_0x3ccba8(0x24d)]['set'](_0x3b7e8b,{'past':[],'future':[],'current':_0x293318?'':this['history']['get'](_0x3b7e8b)?.['current']||''}),_0x293318&&(this[_0x3ccba8(0x303)](),this['updateButtonStates'](_0x3986db),logger['log']('已'+(_0x293318?'清空':_0x3ccba8(0x2ee))+_0x3ccba8(0x377)+_0x3986db+_0x3ccba8(0x25f))),!![];}catch(_0x378616){return logger['error'](_0x3ccba8(0x2b5)+_0x3986db+'\x20的历史记录时出错:',_0x378616),![];}},'recordHistory'(_0x34d02f,_0x512780){const _0x4c3976=_0xe95701,_0x5b7442={'kePSB':function(_0x2e4334,_0x43d65b){return _0x2e4334>_0x43d65b;}};if(!_0x34d02f)return;try{this['initOrClearHistory'](_0x34d02f);const _0x46eb80=String(_0x34d02f),_0x586d46=this['history'][_0x4c3976(0x2d7)](_0x46eb80);if(!_0x586d46)return;if(_0x586d46['current']===_0x512780)return;if(_0x586d46['past'][_0x4c3976(0x2b4)](_0x512780))return;_0x586d46['past']['push'](_0x586d46[_0x4c3976(0x2f8)]),_0x586d46[_0x4c3976(0x2f8)]=_0x512780,_0x586d46['future']=[],_0x5b7442[_0x4c3976(0x3ac)](_0x586d46['past']['length'],0x14)&&_0x586d46['past']['shift'](),this['updateButtonStates'](_0x34d02f);}catch(_0x4b5152){logger['error']('记录节点\x20'+_0x34d02f+'\x20的历史时出错:',_0x4b5152);}},'clearHistory'(_0x1bb2ed){return this['initOrClearHistory'](_0x1bb2ed,!![]);},'updateButtonStates'(_0x1d384b){const _0x45288c=_0xe95701,_0x2b207c={'SXHct':'widget_button_disabled','cdrkA':function(_0x2c9b8d,_0x10788){return _0x2c9b8d>_0x10788;}};if(!_0x1d384b||!FEATURES['enabled']||!FEATURES['history'])return;try{const _0x3321be=String(_0x1d384b),_0x53aa4a=this['getInstance'](_0x3321be);if(!_0x53aa4a?.['buttons'])return;const _0x1c69cb=this['history'][_0x45288c(0x2d7)](_0x3321be);if(!_0x1c69cb)return;const _0xac9d0e=_0x1c69cb['past']&&_0x1c69cb[_0x45288c(0x302)]['length']>0x0,_0x470099=_0x1c69cb['future']&&_0x2b207c[_0x45288c(0x20e)](_0x1c69cb['future']['length'],0x0),_0xa23408={'undo':_0xac9d0e,'redo':_0x470099,'history':!![]};Object['entries'](_0xa23408)[_0x45288c(0x1df)](([_0x12b30e,_0x4a1fa7])=>{const _0x1f7639=_0x53aa4a['buttons'][_0x12b30e];_0x1f7639&&(_0x4a1fa7?(_0x1f7639['classList']['remove']('widget_button_disabled'),_0x1f7639['disabled']=![]):(_0x1f7639['classList']['add'](_0x2b207c['SXHct']),_0x1f7639['disabled']=!![]));});}catch(_0x76c5f5){logger['error']('更新节点\x20'+_0x1d384b+'\x20的按钮状态时出错:',_0x76c5f5);}},'addHoverEffect'(_0xb4136b,_0x22e004={}){const _0x26e41a=_0xe95701,_0x1a65a9={'EIyxu':'mouseenter'},_0x4b826e={'scale':1.1,'opacity':0x1,'color':null,'backgroundColor':null},_0x1e311f={..._0x4b826e,..._0x22e004};_0xb4136b[_0x26e41a(0x3ca)](_0x1a65a9['EIyxu'],()=>{const _0xcb6924=_0x26e41a;_0xb4136b[_0xcb6924(0x35c)][_0xcb6924(0x1e0)]=String(_0x1e311f[_0xcb6924(0x1e0)]),_0xb4136b['style']['transform']=_0xcb6924(0x2d8)+_0x1e311f[_0xcb6924(0x2c0)]+')';if(_0x1e311f['color'])_0xb4136b[_0xcb6924(0x35c)]['color']=_0x1e311f[_0xcb6924(0x3c8)];if(_0x1e311f[_0xcb6924(0x300)])_0xb4136b['style']['backgroundColor']=_0x1e311f['backgroundColor'];}),_0xb4136b[_0x26e41a(0x3ca)]('mouseleave',()=>{const _0xbbea17=_0x26e41a;_0xb4136b['style'][_0xbbea17(0x1e0)]=_0xbbea17(0x226),_0xb4136b['style'][_0xbbea17(0x25b)]='scale(1)';if(_0x1e311f['color'])_0xb4136b['style']['color']='rgba(255,\x20255,\x20255,\x200.6)';if(_0x1e311f['backgroundColor'])_0xb4136b['style']['backgroundColor']='transparent';});},'safeRemoveElement'(_0x36e3ba){const _0x2141a4=_0xe95701;return DOMUtils[_0x2141a4(0x1c3)](_0x36e3ba);},'cleanup'(_0x8689ad=null){const _0x5ec5b0=_0xe95701,_0x143019={'GVUXJ':'blur'};if(_0x8689ad!==null&&!FEATURES['enabled'])return;this['closeHistoryPopup'](),this['closePresetPopup']();if(_0x8689ad){const _0x4699fc=this['getInstance'](_0x8689ad);_0x4699fc&&(_0x4699fc[_0x5ec5b0(0x3e3)]&&_0x4699fc['blurHandler']&&_0x4699fc[_0x5ec5b0(0x3e3)]['removeEventListener']('blur',_0x4699fc[_0x5ec5b0(0x290)]),this['safeRemoveElement'](_0x4699fc[_0x5ec5b0(0x2c5)]),this['instances']['delete'](_0x8689ad));return;}for(const [_0x368f00,_0x1072a0]of this['instances']){_0x1072a0[_0x5ec5b0(0x3e3)]&&_0x1072a0['blurHandler']&&_0x1072a0['text_element']['removeEventListener'](_0x143019['GVUXJ'],_0x1072a0['blurHandler']),this[_0x5ec5b0(0x2ae)](_0x1072a0['element']);}this['instances']['clear']();},'addInstance'(_0x50080e,_0x5e62ca){const _0x3d1bf7=_0xe95701,_0x18db0a={'dEHvO':function(_0x444fb1,_0x2ac97c){return _0x444fb1||_0x2ac97c;}};if(!FEATURES['enabled'])return;if(_0x18db0a['dEHvO'](!_0x50080e,!_0x5e62ca))return;try{const _0x3503bc=String(_0x50080e);this['instances']['has'](_0x3503bc)&&this['cleanup'](_0x50080e),this['instances']['set'](_0x3503bc,_0x5e62ca),_0x5e62ca['text_element']&&(this[_0x3d1bf7(0x32d)](_0x50080e),this[_0x3d1bf7(0x3e0)](_0x50080e,_0x5e62ca[_0x3d1bf7(0x3e3)]['value']||''));}catch(_0x35dcbd){}},'hasInstance'(_0x2cef42){const _0x5bbf05=_0xe95701;if(_0x2cef42==null)return![];try{return this['instances']['has'](String(_0x2cef42));}catch(_0x932efa){return logger[_0x5bbf05(0x20f)]('检查节点\x20'+_0x2cef42+_0x5bbf05(0x388),_0x932efa),![];}},'isEmptyInstance'(_0x2fa024){const _0x25b70e=_0xe95701,_0x13a154={'iwspc':function(_0x6627cd,_0x32afe4){return _0x6627cd==_0x32afe4;},'vgnrO':function(_0x28ab89,_0x1b70cb){return _0x28ab89===_0x1b70cb;}};if(_0x13a154[_0x25b70e(0x35e)](_0x2fa024,null))return!![];try{const _0x420895=String(_0x2fa024);if(!this['instances'][_0x25b70e(0x304)](_0x420895))return!![];const _0x2d1646=this['history']['get'](_0x420895);if(!_0x2d1646)return!![];const _0x256ee4=(!_0x2d1646[_0x25b70e(0x2f8)]||_0x13a154[_0x25b70e(0x392)](_0x2d1646['current'],''))&&(!_0x2d1646[_0x25b70e(0x302)]||_0x2d1646['past']['length']===0x0)&&(!_0x2d1646['future']||_0x2d1646['future']['length']===0x0);return _0x256ee4;}catch(_0x356d37){return logger[_0x25b70e(0x20f)]('检查节点\x20'+_0x2fa024+'\x20的实例是否为空时出错:',_0x356d37),!![];}},'cleanupEmptyInstances'(_0x211a30=_0xe95701(0x2f0)){const _0x36102a=_0xe95701,_0x4cda10={'BrJph':function(_0x1f67b9,_0x3a4851){return _0x1f67b9&&_0x3a4851;},'wVcli':'nodeDelete'};if(!FEATURES['enabled'])return 0x0;let _0x5b0fe6=0x0;try{const _0x48dd62=Array['from'](this[_0x36102a(0x3a8)]['keys']());for(const _0x48628a of _0x48dd62){const _0x94f856=this['isNodeExists'](_0x48628a),_0x4e2934=this[_0x36102a(0x24d)][_0x36102a(0x2d7)](_0x48628a),_0x5072f6=_0x4e2934&&(_0x4e2934['current']&&_0x4e2934['current']['trim']()!==''||_0x4e2934['past']&&_0x4e2934['past'][_0x36102a(0x215)]>0x0||_0x4e2934['future']&&_0x4e2934['future']['length']>0x0);if(_0x4cda10['BrJph'](!_0x94f856,!_0x5072f6)){this['cleanup'](_0x48628a),_0x5b0fe6++;continue;}_0x94f856&&this['isEmptyInstance'](_0x48628a)&&!_0x5072f6&&(this[_0x36102a(0x3a6)](_0x48628a),_0x5b0fe6++);}const _0x201940=this[_0x36102a(0x3a8)][_0x36102a(0x275)];if(_0x211a30===_0x36102a(0x2f0))logger['info']('[定时清理]\x20已清理\x20'+_0x5b0fe6+'\x20个空实例（不包含有历史记录的实例），当前剩余\x20'+_0x201940+'\x20个实例');else _0x211a30===_0x4cda10['wVcli']&&logger['info'](_0x36102a(0x3b5)+_0x5b0fe6+_0x36102a(0x1cb)+_0x201940+'\x20个实例');return _0x5b0fe6;}catch(_0x222ba0){return logger['error']('清理空实例时出错:\x20'+_0x222ba0['message']),_0x5b0fe6;}},'getInstance'(_0x1286a3){const _0x50a513=_0xe95701;if(_0x1286a3==null)return null;try{const _0x395a9a=String(_0x1286a3);return this['instances']['get'](_0x395a9a);}catch(_0x5a4b5e){return logger[_0x50a513(0x20f)]('获取节点\x20'+_0x1286a3+'\x20的实例时出错:',_0x5a4b5e),null;}},'executeAction'(_0x145f33,_0x3ff3ce,..._0x21021b){const _0x23ff6b=_0xe95701,_0x2f2c75={'dPqMW':'redo','KSDPU':'translate'};if(!_0x145f33||!_0x3ff3ce)return logger['warn'](_0x23ff6b(0x375)),![];try{const _0x44c4e9=String(_0x145f33),_0x193580=this[_0x23ff6b(0x2e9)](_0x44c4e9);if(!_0x193580)return logger[_0x23ff6b(0x2c4)]('找不到节点\x20'+_0x145f33+_0x23ff6b(0x204)),![];logger[_0x23ff6b(0x278)](_0x23ff6b(0x224)+_0x145f33+_0x23ff6b(0x3a9)+_0x3ff3ce+'\x20操作');_0x3ff3ce!=='history'&&this['closeHistoryPopup']();switch(_0x3ff3ce){case _0x23ff6b(0x24d):return this['showHistory'](_0x44c4e9,..._0x21021b);case'undo':return this['undoOperation'](_0x44c4e9,..._0x21021b);case _0x2f2c75[_0x23ff6b(0x3c9)]:return this[_0x23ff6b(0x3e8)](_0x44c4e9,..._0x21021b);case _0x2f2c75['KSDPU']:return this['translateText'](_0x44c4e9,..._0x21021b);case'expand':return this['expandText'](_0x44c4e9,..._0x21021b);default:logger['warn'](_0x23ff6b(0x234)+_0x3ff3ce);return![];}}catch(_0x4c8652){return logger[_0x23ff6b(0x20f)]('执行节点\x20'+_0x145f33+'\x20的\x20'+_0x3ff3ce+'\x20操作时出错:',_0x4c8652),![];}},'showEffect'(_0x474df5,_0x66fd2b,_0x26434e=0x12c){const _0x23c3a1=_0xe95701;if(!_0x474df5)return;_0x474df5[_0x23c3a1(0x293)]['add'](_0x66fd2b),setTimeout(()=>_0x474df5['classList'][_0x23c3a1(0x2a4)](_0x66fd2b),_0x26434e);},'updateTextValue'(_0x1a7ece,_0x1ff864){const _0x128cd4=_0xe95701,_0x3d939d={'XAwmY':_0x128cd4(0x2bb)};if(!_0x1a7ece)return;_0x1a7ece['value']=_0x1ff864;const _0x2e4ddd=new Event('input',{'bubbles':!![]});_0x1a7ece['dispatchEvent'](_0x2e4ddd),this['showEffect'](_0x1a7ece,_0x3d939d[_0x128cd4(0x339)]);},'STYLES':{'popup':'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20position:\x20absolute;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20z-index:\x2010000;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background-color:\x20rgba(30,\x2030,\x2030,\x200.95);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border:\x201px\x20solid\x20rgba(255,\x20255,\x20255,\x200.2);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border-radius:\x204px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20box-shadow:\x200\x204px\x2012px\x20rgba(0,\x200,\x200,\x200.5);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20backdrop-filter:\x20blur(10px);\x0a\x20\x20\x20\x20\x20\x20\x20\x20','flexRow':'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20flex;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20justify-content:\x20space-between;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20align-items:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20','buttonReset':'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20none;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border:\x20none;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20cursor:\x20pointer;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20','transition':'transition:\x20all\x200.2s;'},'createHistoryPopup'(_0x3e008d,_0x21da88,_0xfb77e2){const _0x2fb003=_0xe95701,_0x21bd9c={'wHfva':_0x2fb003(0x1f6),'RdzpA':'\x20current','jIWPc':'button','FZBrP':'查看完整内容','rzJRL':'click','EbjvB':_0x2fb003(0x36c),'Gkqmc':'prompt_history_clear','aWivT':'prompt_history_list','XjolP':function(_0x4f1234,_0x209c96){return _0x4f1234>_0x209c96;},'nhstR':function(_0x1d31fc,_0x29048c){return _0x1d31fc+_0x29048c;},'nOVPF':function(_0x349828,_0x449d63){return _0x349828-_0x449d63;},'RYmzX':'auto','mMxdM':'popup_up'};this['closeHistoryPopup']();if(!_0x21da88||!_0x21da88['past']||_0x21da88[_0x2fb003(0x302)]['length']===0x0)return logger['warn'](_0x2fb003(0x1ca)),null;const _0x44b5a4=[..._0x21da88[_0x2fb003(0x302)]]['reverse']();_0x21da88[_0x2fb003(0x2f8)]&&_0x44b5a4[_0x2fb003(0x2cc)](_0x21da88[_0x2fb003(0x2f8)]);const _0x1b5639=document['createElement']('div');_0x1b5639['className']='prompt_history_popup',_0x1b5639['setAttribute']('data-node-id',_0x3e008d);const _0x4cc44f=document['createElement'](_0x2fb003(0x1f6));_0x4cc44f['className']=_0x21bd9c['EbjvB'];const _0x3bff0e=document['createElement'](_0x21bd9c[_0x2fb003(0x1f1)]);_0x3bff0e['className']='prompt_history_title',_0x3bff0e['textContent']='历史记录';const _0xbb2cc7=document[_0x2fb003(0x32a)](_0x2fb003(0x1f6));_0xbb2cc7['className']='prompt_history_actions';const _0x3aa1be=document['createElement']('button');_0x3aa1be['className']='prompt_history_clear',_0x3aa1be['textContent']='清除当前',_0x3aa1be[_0x2fb003(0x3ca)]('click',_0x4d47ba=>{const _0x269503=_0x2fb003;_0x4d47ba['stopPropagation'](),this['clearHistory'](_0x3e008d),this[_0x269503(0x303)]();});const _0x1bc4f9=document['createElement']('button');_0x1bc4f9['className']=_0x21bd9c['Gkqmc'],_0x1bc4f9['textContent']='清空全部',_0x1bc4f9[_0x2fb003(0x3ca)](_0x21bd9c['rzJRL'],_0x248844=>{_0x248844['stopPropagation'](),Array['from'](this['history']['keys']())['forEach'](_0x571d2f=>{const _0x1cc8f7=_0x431d;this[_0x1cc8f7(0x34b)](_0x571d2f);}),this['closeHistoryPopup']();});const _0x50683e=document[_0x2fb003(0x32a)](_0x21bd9c['jIWPc']);_0x50683e[_0x2fb003(0x363)]='prompt_history_close',_0x50683e['textContent']='×',_0x50683e['addEventListener']('click',_0xf68045=>{const _0x2c7a9f=_0x2fb003;_0xf68045[_0x2c7a9f(0x35f)](),this['closeHistoryPopup']();}),_0xbb2cc7[_0x2fb003(0x249)](_0x3aa1be),_0xbb2cc7['appendChild'](_0x1bc4f9),_0xbb2cc7['appendChild'](_0x50683e),_0x4cc44f['appendChild'](_0x3bff0e),_0x4cc44f[_0x2fb003(0x249)](_0xbb2cc7),_0x1b5639[_0x2fb003(0x249)](_0x4cc44f);const _0x205b14=document['createElement']('div');_0x205b14['className']=_0x21bd9c[_0x2fb003(0x1c1)],_0x44b5a4['forEach']((_0x2f82b6,_0xd0b624)=>{const _0x33f34a=_0x2fb003;if(!_0x2f82b6['trim']())return;const _0x2b6a6d=_0xd0b624===0x0&&_0x2f82b6===_0x21da88[_0x33f34a(0x2f8)],_0x4d5cba=document['createElement'](_0x21bd9c['wHfva']);_0x4d5cba['className']='prompt_history_item'+(_0x2b6a6d?_0x21bd9c['RdzpA']:''),_0x4d5cba[_0x33f34a(0x2a0)]('data-index',_0xd0b624);const _0x11a348=document['createElement']('div');_0x11a348['style'][_0x33f34a(0x23d)]=_0x33f34a(0x273);const _0x19e4e8=document['createElement']('span');_0x19e4e8[_0x33f34a(0x1f7)]=_0x2f82b6[_0x33f34a(0x215)]>0x28?_0x2f82b6['substring'](0x0,0x28)+'...':_0x2f82b6,_0x19e4e8['title']=_0x2f82b6;const _0x4c735b=document['createElement'](_0x21bd9c[_0x33f34a(0x267)]);_0x4c735b[_0x33f34a(0x1f7)]='⋯',_0x4c735b['title']=_0x21bd9c[_0x33f34a(0x201)],_0x4c735b['style'][_0x33f34a(0x23d)]=_0x33f34a(0x407)+(_0x2f82b6[_0x33f34a(0x215)]>0x28?'block':'none')+_0x33f34a(0x3cf),_0x4c735b['addEventListener'](_0x21bd9c['rzJRL'],_0x387a45=>{const _0x18bf8d=_0x33f34a;_0x387a45['stopPropagation'](),this[_0x18bf8d(0x29e)](_0x2f82b6);}),_0x11a348['appendChild'](_0x19e4e8),_0x11a348['appendChild'](_0x4c735b),_0x4d5cba['appendChild'](_0x11a348),_0x4d5cba[_0x33f34a(0x3ca)](_0x33f34a(0x373),_0x18f195=>{_0x18f195['stopPropagation'](),this['applyHistoryItem'](_0x3e008d,_0x2f82b6),this['closeHistoryPopup']();}),_0x205b14['appendChild'](_0x4d5cba);}),_0x1b5639[_0x2fb003(0x249)](_0x205b14);const _0x2ec10e=_0xfb77e2['getBoundingClientRect']();let _0x17c22f=_0x2ec10e['left'],_0xaf39ec=_0x2ec10e[_0x2fb003(0x3fc)]+0x5;_0x17c22f+0x12c>window['innerWidth']&&(_0x17c22f=window['innerWidth']-0x136);const _0x4dc3fa=0x15e;if(_0x21bd9c['XjolP'](_0x21bd9c['nhstR'](_0xaf39ec,_0x4dc3fa),window[_0x2fb003(0x21c)])){const _0x13f7c1=_0x2fb003(0x3b4)['split']('|');let _0x45089b=0x0;while(!![]){switch(_0x13f7c1[_0x45089b++]){case'0':_0x1b5639['style'][_0x2fb003(0x3fc)]=window['innerHeight']-_0xaf39ec+'px';continue;case'1':_0x1b5639['style']['transformOrigin']='bottom';continue;case'2':_0xaf39ec=_0x21bd9c[_0x2fb003(0x2d9)](_0x2ec10e['top'],0x5);continue;case'3':_0x1b5639['style']['top']='auto';continue;case'4':_0x1b5639['classList']['add']('popup_down');continue;}break;}}else _0x1b5639['style'][_0x2fb003(0x281)]='top',_0x1b5639['style']['top']=Math[_0x2fb003(0x3da)](0xa,_0xaf39ec)+'px',_0x1b5639['style']['bottom']=_0x21bd9c[_0x2fb003(0x37b)],_0x1b5639['classList'][_0x2fb003(0x3bc)](_0x21bd9c['mMxdM']);return _0x1b5639['style']['left']=Math[_0x2fb003(0x3da)](0xa,_0x17c22f)+'px',document['body'][_0x2fb003(0x249)](_0x1b5639),this[_0x2fb003(0x1d3)]=_0x1b5639,setTimeout(()=>{const _0x4b9b81=_0x2fb003;document['addEventListener'](_0x4b9b81(0x373),this['handleDocumentClick']);},0xa),_0x1b5639;},'createHistoryPopupWithAllRecords'(_0x4942a1,_0x5d4fba,_0x386b9a){const _0x11ec44=_0xe95701,_0x43633a={'FzmhE':'data-index','VdBtz':_0x11ec44(0x1d5),'WTYbo':'node_color_current','qAkXV':'...','TgqTy':_0x11ec44(0x373),'OysLt':'prompt_history_popup','zBIvl':'div','fcZXM':_0x11ec44(0x2ce),'lkVwV':'prompt_history_close','asFzZ':function(_0x1b232b,_0x13046d){return _0x1b232b+_0x13046d;},'aKzMN':'bottom','tfBXs':'auto','bihwL':function(_0x1140e1,_0xb385bc,_0x2869e0){return _0x1140e1(_0xb385bc,_0x2869e0);}};this['closeHistoryPopup']();if(!_0x5d4fba||_0x5d4fba['length']===0x0)return logger['warn'](_0x11ec44(0x1ca)),null;const _0x43f3d8=document['createElement'](_0x11ec44(0x1f6));_0x43f3d8['className']=_0x43633a['OysLt'],_0x43f3d8['setAttribute']('data-node-id',_0x4942a1);const _0x96da04=document['createElement'](_0x43633a['zBIvl']);_0x96da04[_0x11ec44(0x363)]='prompt_history_title_bar';const _0x173322=document['createElement'](_0x43633a['zBIvl']);_0x173322['className']='prompt_history_title',_0x173322['textContent']='所有历史记录';const _0x1eb3cc=document[_0x11ec44(0x32a)](_0x43633a[_0x11ec44(0x394)]);_0x1eb3cc['className']='prompt_history_actions';const _0x3d0196=document['createElement']('button');_0x3d0196[_0x11ec44(0x363)]='prompt_history_clear',_0x3d0196['textContent']='清除当前',_0x3d0196['addEventListener'](_0x43633a['TgqTy'],_0xf8db3e=>{_0xf8db3e['stopPropagation'](),this['clearHistory'](_0x4942a1),this['closeHistoryPopup']();});const _0x3cd026=document['createElement'](_0x43633a[_0x11ec44(0x358)]);_0x3cd026['className']='prompt_history_clear',_0x3cd026['textContent']='清空全部',_0x3cd026['addEventListener'](_0x43633a['TgqTy'],_0x4d4f2d=>{const _0x2feccc=_0x11ec44;_0x4d4f2d[_0x2feccc(0x35f)](),Array['from'](this['history']['keys']())['forEach'](_0x5e796b=>{this['clearHistory'](_0x5e796b);}),this[_0x2feccc(0x303)]();});const _0x54728a=document[_0x11ec44(0x32a)](_0x43633a['fcZXM']);_0x54728a[_0x11ec44(0x363)]=_0x43633a['lkVwV'],_0x54728a['textContent']='×',_0x54728a['addEventListener']('click',_0x5e83ef=>{const _0x1a719a=_0x11ec44;_0x5e83ef[_0x1a719a(0x35f)](),this['closeHistoryPopup']();}),_0x1eb3cc['appendChild'](_0x3d0196),_0x1eb3cc[_0x11ec44(0x249)](_0x3cd026),_0x1eb3cc['appendChild'](_0x54728a),_0x96da04['appendChild'](_0x173322),_0x96da04['appendChild'](_0x1eb3cc),_0x43f3d8['appendChild'](_0x96da04);const _0x1f3cac=document[_0x11ec44(0x32a)]('div');_0x1f3cac['className']='prompt_history_list',_0x5d4fba['forEach']((_0x5b210d,_0x331158)=>{const _0x5b8624=_0x11ec44;if(!_0x5b210d['text']||!_0x5b210d['text']['trim']())return;const _0x5b2d8d=document[_0x5b8624(0x32a)]('div');_0x5b2d8d['className']='prompt_history_item'+(_0x5b210d['isCurrent']?_0x5b8624(0x283):''),_0x5b2d8d['setAttribute'](_0x43633a[_0x5b8624(0x3f9)],_0x331158),_0x5b2d8d['setAttribute'](_0x43633a[_0x5b8624(0x27a)],_0x5b210d['nodeId']);_0x5b210d['isCurrentNode']&&_0x5b2d8d['classList']['add']('current_node');const _0x11b23f=document['createElement'](_0x5b8624(0x1f6));_0x11b23f[_0x5b8624(0x35c)]['cssText']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20flex;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20justify-content:\x20space-between;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20align-items:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';const _0x2918bf=document['createElement']('span');_0x2918bf['className']=_0x5b8624(0x2ad);if(_0x5b210d['isCurrentNode'])_0x2918bf['classList'][_0x5b8624(0x3bc)](_0x43633a['WTYbo']);else{const _0x2e1aae=parseInt(_0x5b210d['shortId'])||0x0,_0x6ec3d7=_0x2e1aae%0xa;_0x2918bf['classList']['add']('node_color_'+_0x6ec3d7);}let _0xfee834='';_0x5b210d['nodeId']['includes']('_')&&(_0xfee834=_0x5b210d[_0x5b8624(0x29c)]['split']('_')['slice'](0x1)['join']('_'));_0x2918bf['textContent']=_0xfee834?'#'+_0x5b210d['shortId']+':\x20':'#'+_0x5b210d['shortId']+':\x20';const _0x4c2ec7=document['createElement']('span');_0x4c2ec7['className']=_0x5b8624(0x3ab),_0x4c2ec7['textContent']=_0x5b210d['text'][_0x5b8624(0x215)]>0x32?_0x5b210d['text']['substring'](0x0,0x32)+_0x43633a['qAkXV']:_0x5b210d[_0x5b8624(0x2b6)],_0x4c2ec7['title']=_0x5b210d['text'],_0x4c2ec7['style']['cssText']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20flex:\x201;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20overflow:\x20hidden;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20text-overflow:\x20ellipsis;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20white-space:\x20nowrap;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20';const _0x1d7622=document['createElement']('div');_0x1d7622['style']['cssText']=_0x5b8624(0x2f1),_0x1d7622['appendChild'](_0x2918bf),_0x1d7622[_0x5b8624(0x249)](_0x4c2ec7),_0x11b23f['appendChild'](_0x1d7622),_0x5b2d8d[_0x5b8624(0x249)](_0x11b23f),_0x5b2d8d[_0x5b8624(0x3ca)](_0x43633a[_0x5b8624(0x231)],_0x915d5f=>{const _0x4c2d1e=_0x5b8624;_0x915d5f['stopPropagation'](),this['applyHistoryItem'](_0x5b210d['nodeId'],_0x5b210d['text'],_0x4942a1),this[_0x4c2d1e(0x303)]();}),_0x1f3cac['appendChild'](_0x5b2d8d);}),_0x43f3d8['appendChild'](_0x1f3cac);const _0xa6713a=_0x386b9a['getBoundingClientRect']();let _0x13d5d5=_0xa6713a['left'],_0x1497d8=_0xa6713a['bottom']+0x5;_0x43633a[_0x11ec44(0x371)](_0x13d5d5,0x12c)>window['innerWidth']&&(_0x13d5d5=window['innerWidth']-0x136);const _0x15905f=0x15e;if(_0x1497d8+_0x15905f>window[_0x11ec44(0x21c)]){const _0x1f5dd7=_0x11ec44(0x3d4)['split']('|');let _0x55a3da=0x0;while(!![]){switch(_0x1f5dd7[_0x55a3da++]){case'0':_0x43f3d8['style'][_0x11ec44(0x3fc)]=window['innerHeight']-_0x1497d8+'px';continue;case'1':_0x43f3d8['style'][_0x11ec44(0x33c)]=_0x11ec44(0x20a);continue;case'2':_0x43f3d8['classList']['add']('popup_down');continue;case'3':_0x43f3d8['style'][_0x11ec44(0x281)]=_0x43633a['aKzMN'];continue;case'4':_0x1497d8=_0xa6713a[_0x11ec44(0x33c)]-0x5;continue;}break;}}else _0x43f3d8['style'][_0x11ec44(0x281)]=_0x11ec44(0x33c),_0x43f3d8['style']['top']=Math['max'](0xa,_0x1497d8)+'px',_0x43f3d8[_0x11ec44(0x35c)]['bottom']=_0x43633a[_0x11ec44(0x3d5)],_0x43f3d8['classList'][_0x11ec44(0x3bc)]('popup_up');_0x43f3d8[_0x11ec44(0x35c)]['left']=Math['max'](0xa,_0x13d5d5)+'px',_0x43f3d8[_0x11ec44(0x35c)]['width']='350px',_0x43f3d8['addEventListener'](_0x11ec44(0x373),_0x1b1a5e=>{const _0x3d6ecb=_0x11ec44;_0x1b1a5e[_0x3d6ecb(0x35f)]();});const _0x153dc9=_0x3284af=>{const _0x1e1fc7=_0x11ec44;_0x43f3d8&&!_0x43f3d8['contains'](_0x3284af[_0x1e1fc7(0x200)])&&_0x3284af['target']!==_0x386b9a&&(this['closeHistoryPopup'](),document['removeEventListener'](_0x1e1fc7(0x373),_0x153dc9));};return _0x43633a['bihwL'](setTimeout,()=>{const _0x352d04=_0x11ec44;document[_0x352d04(0x3ca)](_0x352d04(0x373),_0x153dc9);},0xa),document['body']['appendChild'](_0x43f3d8),this['activeHistoryPopup']=_0x43f3d8,_0x43f3d8;},'handleDocumentClick':function(_0x171504){const _0xc4ed4=_0xe95701,_0x141f1b={'MRcha':'.prompt_history_popup'};TranslateManager[_0xc4ed4(0x1d3)]&&!TranslateManager[_0xc4ed4(0x1d3)]['contains'](_0x171504['target'])&&!_0x171504['target'][_0xc4ed4(0x20c)](_0x141f1b['MRcha'])&&TranslateManager['closeHistoryPopup']();},'closeHistoryPopup'(){const _0x1efb39=_0xe95701,_0x449263={'TwFNW':'closing-up','vatdf':'closing-down','BJyAA':function(_0x57ce3a,_0x7c1225,_0x1eff9d){return _0x57ce3a(_0x7c1225,_0x1eff9d);}};if(this['activeHistoryPopup'])try{const _0x5e4e7f=this['activeHistoryPopup']['classList']['contains'](_0x1efb39(0x1ec)),_0x8e139c=_0x5e4e7f?_0x449263[_0x1efb39(0x2f5)]:_0x449263['vatdf'];this[_0x1efb39(0x1d3)][_0x1efb39(0x293)]['add'](_0x8e139c),document['removeEventListener']('click',this['handleDocumentClick']),_0x449263[_0x1efb39(0x33a)](setTimeout,()=>{const _0x189485=_0x1efb39;try{this['activeHistoryPopup']&&document[_0x189485(0x208)]['contains'](this['activeHistoryPopup'])&&document['body'][_0x189485(0x38c)](this['activeHistoryPopup']);}catch(_0x8d18d6){}this['activeHistoryPopup']=null;},0xc8);}catch(_0x5f4685){try{document['body']['removeChild'](this['activeHistoryPopup']);}catch(_0x6d712b){}this['activeHistoryPopup']=null,document['removeEventListener']('click',this[_0x1efb39(0x332)]);}},'applyHistoryItem'(_0x1974b6,_0x57a858,_0x3bc31b=null){const _0x1e2bb4=_0xe95701,_0x453c69={'dfaDi':function(_0x4fecc3,_0x50f8af){return _0x4fecc3||_0x50f8af;}},_0x2b8dd6=_0x453c69[_0x1e2bb4(0x3e7)](_0x3bc31b,_0x1974b6),_0x147887=this['getInstance'](_0x2b8dd6);if(!_0x147887?.[_0x1e2bb4(0x3e3)])return logger['warn']('无法应用历史记录：找不到节点\x20'+_0x2b8dd6+'\x20的文本元素'),![];return this['updateTextValue'](_0x147887[_0x1e2bb4(0x3e3)],_0x57a858),logger['log'](_0x1e2bb4(0x405)+_0x1974b6+_0x1e2bb4(0x2da)+_0x2b8dd6),this['recordHistory'](_0x2b8dd6,_0x57a858),!![];},'showHistory'(_0x5a7db7){const _0x4a5dce=_0xe95701,_0x1cf2f7={'JdxCn':function(_0x1a4316,_0x575dcd){return _0x1a4316!==_0x575dcd;},'UFbys':function(_0x4a2e88,_0x3451e8){return _0x4a2e88(_0x3451e8);},'OBfXg':function(_0x18daa8,_0x924b62){return _0x18daa8-_0x924b62;},'YbmOx':function(_0x590140,_0x3a5fec,_0x2af1bd){return _0x590140(_0x3a5fec,_0x2af1bd);},'pLybe':function(_0x5b9d10,_0x76362f){return _0x5b9d10>_0x76362f;},'TadmB':function(_0x3dc57c,_0x2c2376){return _0x3dc57c===_0x2c2376;},'ysEqE':function(_0x43d6b8,_0x12fb93){return _0x43d6b8>_0x12fb93;},'fxvCS':'div'};if(!_0x5a7db7||!FEATURES['enabled']||!FEATURES['history'])return![];try{const _0x414115=String(_0x5a7db7);this['activePresetPopup']&&this[_0x4a5dce(0x30b)]();if(this['activeHistoryPopup'])return this['closeHistoryPopup'](),!![];this['initOrClearHistory'](_0x414115);const _0x432f14=this[_0x4a5dce(0x2e9)](_0x414115);if(!_0x432f14?.['element']||!_0x432f14['buttons']?.[_0x4a5dce(0x24d)])return logger['warn'](_0x4a5dce(0x219)+_0x5a7db7+'\x20的元素或按钮'),![];this['showEffect'](_0x432f14[_0x4a5dce(0x1ff)][_0x4a5dce(0x24d)],'widget_button_active');const _0x1cbf94=[];for(const [_0x20da86,_0x260af2]of this['history'][_0x4a5dce(0x370)]()){if(_0x260af2&&(_0x260af2['past']&&_0x1cf2f7['pLybe'](_0x260af2['past'][_0x4a5dce(0x215)],0x0)||_0x260af2['current'])){const _0x5b4c71=_0x20da86['replace'](/^node_/i,''),_0x373486=_0x20da86[_0x4a5dce(0x38e)]('_')[0x0],_0x1dcc77=_0x414115['split']('_')[0x0],_0x5eb05e=_0x1cf2f7['TadmB'](_0x373486,_0x1dcc77);_0x260af2['current']&&_0x1cbf94['push']({'nodeId':_0x20da86,'shortId':_0x5b4c71,'text':_0x260af2['current'],'isCurrent':!![],'isCurrentNode':_0x5eb05e,'index':_0x260af2['past']['length']}),_0x260af2[_0x4a5dce(0x302)]&&_0x1cf2f7['ysEqE'](_0x260af2['past']['length'],0x0)&&_0x260af2[_0x4a5dce(0x302)]['forEach']((_0x3a0006,_0x51aa25)=>{const _0x3e1616=_0x4a5dce;_0x1cbf94[_0x3e1616(0x3cb)]({'nodeId':_0x20da86,'shortId':_0x5b4c71,'text':_0x3a0006,'isCurrent':![],'isCurrentNode':_0x5eb05e,'index':_0x51aa25});});}}_0x1cbf94['sort']((_0x183e56,_0x27ed86)=>{const _0x16dbe5=_0x4a5dce;if(_0x1cf2f7['JdxCn'](_0x183e56['isCurrentNode'],_0x27ed86[_0x16dbe5(0x34c)]))return _0x183e56['isCurrentNode']?-0x1:0x1;const _0x13c0d4=_0x183e56['nodeId']['split']('_')[0x0],_0x4c3996=_0x27ed86['nodeId']['split']('_')[0x0];if(_0x13c0d4!==_0x4c3996){const _0x4e6659=parseInt(_0x13c0d4['replace'](/\D/g,''))||0x0,_0x305cdb=_0x1cf2f7['UFbys'](parseInt,_0x4c3996['replace'](/\D/g,''))||0x0;return _0x4e6659-_0x305cdb;}if(_0x183e56['nodeId']!==_0x27ed86['nodeId']){const _0x4d9957=_0x183e56[_0x16dbe5(0x29c)]['includes']('_')?_0x183e56['nodeId']['split']('_')['slice'](0x1)['join']('_'):'',_0xf21069=_0x27ed86['nodeId'][_0x16dbe5(0x2b4)]('_')?_0x27ed86[_0x16dbe5(0x29c)]['split']('_')['slice'](0x1)[_0x16dbe5(0x28d)]('_'):'';return _0x4d9957[_0x16dbe5(0x3de)](_0xf21069);}return _0x1cf2f7[_0x16dbe5(0x26e)](_0x27ed86[_0x16dbe5(0x222)],_0x183e56[_0x16dbe5(0x222)]);});if(_0x1cbf94[_0x4a5dce(0x215)]>0x0)return this['createHistoryPopupWithAllRecords'](_0x414115,_0x1cbf94,_0x432f14['buttons']['history']),!![];else{logger[_0x4a5dce(0x349)]('没有找到任何历史记录');const _0x296b76=_0x432f14['buttons'][_0x4a5dce(0x24d)];if(_0x296b76){const _0x48f5e5=document['createElement'](_0x1cf2f7['fxvCS']);_0x48f5e5['className']='prompt_widget_status\x20info',_0x48f5e5[_0x4a5dce(0x1f7)]=_0x4a5dce(0x3f4),document[_0x4a5dce(0x208)][_0x4a5dce(0x249)](_0x48f5e5);const _0x23bbf4=_0x296b76[_0x4a5dce(0x403)](),_0x56ebb8=Math['max'](0x78,'当前无历史记录'['length']*0xa);_0x48f5e5[_0x4a5dce(0x35c)]['left']=_0x23bbf4['left']+_0x23bbf4['width']/0x2-_0x56ebb8/0x2+'px',_0x48f5e5['style'][_0x4a5dce(0x33c)]=_0x1cf2f7['OBfXg'](_0x23bbf4['top'],0x22)+'px',_0x48f5e5['style']['minWidth']=_0x56ebb8+'px',_0x48f5e5['style']['animation']='clipShake\x200.3s\x20ease-in-out',_0x1cf2f7['YbmOx'](setTimeout,()=>{_0x48f5e5['style']['animation']='clipFloatUp\x200.5s\x20ease-in-out\x20forwards',_0x1cf2f7['YbmOx'](setTimeout,()=>{document['body']['contains'](_0x48f5e5)&&document['body']['removeChild'](_0x48f5e5);},0x320);},0x5dc);}return![];}}catch(_0x13d916){return logger['error']('节点\x20'+_0x5a7db7+'\x20显示历史记录失败:',_0x13d916),![];}},'showTextPreview'(_0x2101ee){alert(_0x2101ee);},'undoOperation'(_0x1a0f25){const _0x4bdae1=_0xe95701;if(!_0x1a0f25)return;try{const _0x495347=String(_0x1a0f25),_0xcf6ad5=this['history'][_0x4bdae1(0x2d7)](_0x495347);if(!_0xcf6ad5||!_0xcf6ad5['past']['length'])return;const _0x269a9b=_0xcf6ad5['current'];_0xcf6ad5['future']['push'](_0x269a9b),_0xcf6ad5['current']=_0xcf6ad5['past']['pop'](),this['updateButtonStates'](_0x1a0f25);const _0x2262da=this[_0x4bdae1(0x2e9)](_0x495347);if(!_0x2262da?.['text_element'])return;this['updateTextValue'](_0x2262da['text_element'],_0xcf6ad5['current']),logger['log'](_0x4bdae1(0x3af)+_0x1a0f25+'\x20的操作');}catch(_0x430b4d){logger['error'](_0x4bdae1(0x285)+_0x1a0f25+'\x20的操作时出错:',_0x430b4d);}},'redoOperation'(_0x43e9dd){const _0x50a3da=_0xe95701;if(!_0x43e9dd)return;try{const _0x2d39ff=String(_0x43e9dd),_0x345ed3=this['history']['get'](_0x2d39ff);if(!_0x345ed3||!_0x345ed3['future'][_0x50a3da(0x215)])return;const _0x25cfab=_0x345ed3['current'];_0x345ed3['past']['push'](_0x25cfab),_0x345ed3['current']=_0x345ed3['future']['pop'](),this['updateButtonStates'](_0x43e9dd);const _0x4fd6a5=this[_0x50a3da(0x2e9)](_0x2d39ff);if(!_0x4fd6a5?.['text_element'])return;this[_0x50a3da(0x1e3)](_0x4fd6a5['text_element'],_0x345ed3['current']),logger[_0x50a3da(0x278)]('已重做节点\x20'+_0x43e9dd+'\x20的操作');}catch(_0x5339c6){logger['error']('重做节点\x20'+_0x43e9dd+'\x20的操作时出错:',_0x5339c6);}},'showStatusTip'(_0x3015f1,_0x269713,_0x5d8686){const _0x546a9e=_0xe95701,_0x375ced={'kSDaT':function(_0x48e1ce){return _0x48e1ce();},'JcqHJ':function(_0x2126ad,_0x431634){return _0x2126ad>=_0x431634;},'slrri':function(_0x35931d,_0x207fde){return _0x35931d===_0x207fde;},'qAMQd':function(_0xfcde62,_0x54d136){return _0xfcde62+_0x54d136;},'MENWF':function(_0xc6a3a5,_0x196c81,_0x59af45){return _0xc6a3a5(_0x196c81,_0x59af45);},'cHNiN':'transform\x200.8s\x20ease-out,\x20opacity\x200.8s\x20ease-out','RictU':_0x546a9e(0x313),'zCRcl':_0x546a9e(0x28f),'DbaRB':_0x546a9e(0x1f3),'ttUhc':_0x546a9e(0x1f6),'dmNYl':'传入的文本元素是扩写按钮','iHXUm':'通过textElement找到所属小部件和翻译按钮','udHzN':_0x546a9e(0x3b2),'Baviw':_0x546a9e(0x37c),'tEhZv':'通过widgetKey找到对应小部件和翻译按钮','EsyVr':'通过widgetKey找到对应小部件和扩写按钮','eRmuL':'通过widgetKey找到对应小部件和预设按钮','UHgYV':'传入的文本元素本身就是预设按钮','vyTKw':function(_0x11cbae,_0x513d6d){return _0x11cbae===_0x513d6d;},'qEzbZ':_0x546a9e(0x3e1),'rxjDT':'data-input-id','mENnj':'absolute','kFhJF':'translate(-50%,\x20-100%)\x20translateY(-8px)','feHUC':function(_0x3472a4){return _0x3472a4();}};try{!this['statusTips']&&(this['statusTips']=new Map());let _0x3a7e74;if(_0x3015f1['closest']){const _0x2e4d48=_0x3015f1[_0x546a9e(0x20c)]('.prompt_widget_box');_0x2e4d48&&(_0x3a7e74=_0x2e4d48['getAttribute'](_0x375ced['RictU']));}!_0x3a7e74&&(_0x3a7e74=_0x3015f1['getAttribute'](_0x375ced[_0x546a9e(0x310)]),!_0x3a7e74&&(_0x3a7e74=_0x375ced['qAMQd']('tip_',Date['now']())+'_'+Math['floor'](Math['random']()*0x3e8),_0x3015f1[_0x546a9e(0x2a0)]('data-element-id',_0x3a7e74)));const _0x2b9d60=this[_0x546a9e(0x34f)][_0x546a9e(0x2d7)](_0x3a7e74);_0x2b9d60&&_0x2b9d60[_0x546a9e(0x3a1)]&&clearTimeout(_0x2b9d60['timeoutId']);let _0x41cf2d,_0xca6b=![];_0x2b9d60&&_0x2b9d60['element']&&document['body']['contains'](_0x2b9d60['element'])?(_0x41cf2d=_0x2b9d60['element'],_0x41cf2d[_0x546a9e(0x293)][_0x546a9e(0x2a4)](_0x546a9e(0x2aa),'error','loading','restore',_0x375ced[_0x546a9e(0x237)]),_0x41cf2d['style']['animation']='none',_0x41cf2d[_0x546a9e(0x311)]):(_0x41cf2d=document['createElement'](_0x375ced[_0x546a9e(0x2c9)]),_0x41cf2d['className']='prompt_widget_status',document['body']['appendChild'](_0x41cf2d),_0xca6b=!![]);let _0x513836=null,_0x592264=null,_0x595d8c=null,_0x10e1b1=null,_0x3f9599=null;if(_0x3015f1['tagName']===_0x546a9e(0x37f)){if(_0x3015f1['title']&&_0x3015f1[_0x546a9e(0x353)]['includes']('历史'))_0x592264=_0x3015f1,logger['log']('传入的文本元素是历史按钮');else{if(_0x3015f1['title']&&_0x3015f1['title']['includes']('扩写'))_0x595d8c=_0x3015f1,logger['log'](_0x375ced['dmNYl']);else _0x3015f1['title']&&_0x3015f1['title'][_0x546a9e(0x2b4)]('预设')&&(_0x10e1b1=_0x3015f1,logger['log']('传入的文本元素是预设按钮'));}}_0x3015f1&&_0x3015f1[_0x546a9e(0x20c)]&&(_0x3f9599=_0x3015f1[_0x546a9e(0x20c)]('.prompt_widget_box'),_0x3f9599&&(_0x513836=_0x3f9599['querySelector'](_0x546a9e(0x271)),_0x513836&&logger[_0x546a9e(0x278)](_0x375ced['iHXUm']),!_0x592264&&(_0x592264=_0x3f9599['querySelector'](_0x375ced['udHzN']),_0x592264&&logger['log']('在小部件中找到历史按钮')),!_0x595d8c&&(_0x595d8c=_0x3f9599['querySelector']('button[title*=\x22扩写\x22]'),_0x595d8c&&logger['log']('在小部件中找到扩写按钮')),!_0x10e1b1&&(_0x10e1b1=_0x3f9599[_0x546a9e(0x3aa)](_0x375ced[_0x546a9e(0x2c2)]),_0x10e1b1&&logger['log'](_0x546a9e(0x362)))));if(!_0x3f9599&&_0x3a7e74){let _0x4ee2ef=null;if(_0x3a7e74[_0x546a9e(0x2b4)]('_')){const _0x1d2abd=_0x3a7e74[_0x546a9e(0x38e)]('_');if(_0x375ced['JcqHJ'](_0x1d2abd['length'],0x2))_0x4ee2ef=_0x3a7e74;else _0x1d2abd['length']===0x1&&(_0x4ee2ef=_0x1d2abd[0x0]);}_0x4ee2ef&&(_0x3f9599=document[_0x546a9e(0x3aa)]('.prompt_widget_box[data-widget-key=\x22'+_0x4ee2ef+'\x22]'),_0x3f9599&&(_0x513836=_0x3f9599['querySelector'](_0x546a9e(0x271)),_0x595d8c=_0x3f9599['querySelector']('button[title*=\x22扩写\x22]'),_0x10e1b1=_0x3f9599['querySelector'](_0x375ced['Baviw']),_0x513836&&logger[_0x546a9e(0x278)](_0x375ced['tEhZv']),_0x595d8c&&logger['log'](_0x375ced['EsyVr']),_0x10e1b1&&logger['log'](_0x375ced[_0x546a9e(0x3c4)])));}if(!_0x513836&&_0x3015f1['tagName']==='BUTTON'){if(_0x3015f1['title']&&_0x3015f1['title'][_0x546a9e(0x2b4)]('翻译'))_0x513836=_0x3015f1,logger['log']('传入的文本元素本身就是翻译按钮');else{if(_0x3015f1['title']&&_0x3015f1['title']['includes']('扩写'))_0x595d8c=_0x3015f1,logger[_0x546a9e(0x278)]('传入的文本元素本身就是扩写按钮');else _0x3015f1['title']&&_0x3015f1[_0x546a9e(0x353)]['includes']('预设')&&(_0x10e1b1=_0x3015f1,logger[_0x546a9e(0x278)](_0x375ced['UHgYV']));}}let _0x522e67=_0x3015f1;if(_0x10e1b1&&(_0x375ced[_0x546a9e(0x335)](_0x3015f1,_0x10e1b1)||_0x3015f1['title']&&_0x3015f1['title']['includes']('预设')))_0x522e67=_0x10e1b1,logger[_0x546a9e(0x278)]('使用预设按钮作为参考元素');else{if(_0x595d8c&&(_0x3015f1===_0x595d8c||_0x3015f1[_0x546a9e(0x353)]&&_0x3015f1[_0x546a9e(0x353)]['includes']('扩写')))_0x522e67=_0x595d8c,logger[_0x546a9e(0x278)](_0x375ced['qEzbZ']);else _0x513836&&(_0x522e67=_0x513836,logger[_0x546a9e(0x278)](_0x546a9e(0x36b)));}_0x41cf2d['setAttribute']('data-reference-type',_0x513836?_0x546a9e(0x2ce):_0x546a9e(0x1c4)),_0x41cf2d['setAttribute']('data-tip-id',_0x3a7e74);_0x3f9599&&(_0x41cf2d['setAttribute']('data-widget-key',_0x3f9599['getAttribute']('data-widget-key')),_0x41cf2d['setAttribute'](_0x546a9e(0x1d5),_0x3f9599[_0x546a9e(0x3b0)]('data-node-id')),_0x41cf2d['setAttribute'](_0x375ced[_0x546a9e(0x1e9)],_0x3f9599['getAttribute'](_0x375ced[_0x546a9e(0x1e9)])));const _0x403403=_0x522e67['getBoundingClientRect'](),_0x128690=Math['max'](0x3c,_0x5d8686['length']*0xa),_0x9e92f7=_0x403403[_0x546a9e(0x378)]+_0x403403['width']/0x2,_0x5b4897=_0x403403[_0x546a9e(0x33c)];_0x41cf2d[_0x546a9e(0x35c)][_0x546a9e(0x243)]=_0x375ced[_0x546a9e(0x3c5)],_0x41cf2d['style']['top']=_0x5b4897+'px',_0x41cf2d['style']['left']=_0x9e92f7+'px',_0x41cf2d['style']['transform']=_0x375ced[_0x546a9e(0x2e8)],_0x41cf2d['style']['whiteSpace']='nowrap',_0x41cf2d[_0x546a9e(0x293)]['add'](_0x269713);let _0x12ac6e=0x0;const _0x4f7860=0x4,_0x23009f=0x0,_0x38d753=0x2;function _0x85d2cd(){const _0x4ef9eb=_0x546a9e;if(_0x375ced['JcqHJ'](_0x12ac6e,_0x4f7860))return;const _0x57bd40=_0x41cf2d['style']['transform']||'',_0x2b3ae0=_0x375ced['slrri'](_0x12ac6e%0x2,0x0)?-0x1:0x1,_0x448c49=_0x2b3ae0*_0x38d753;_0x41cf2d[_0x4ef9eb(0x35c)][_0x4ef9eb(0x25b)]=_0x375ced[_0x4ef9eb(0x1f5)](_0x57bd40['replace'](/translateX\([^)]*\)/g,''),_0x4ef9eb(0x39f)+_0x448c49+'px)'),_0x12ac6e++,_0x375ced['MENWF'](setTimeout,()=>{const _0xe9f9fb=_0x4ef9eb;_0x41cf2d&&document[_0xe9f9fb(0x208)][_0xe9f9fb(0x206)](_0x41cf2d)&&_0x375ced[_0xe9f9fb(0x223)](_0x85d2cd);},0x3c);}_0x375ced[_0x546a9e(0x3a4)](_0x85d2cd),_0x41cf2d[_0x546a9e(0x1f7)]=_0x5d8686;const _0x55e296=setTimeout(()=>{const _0x4e8cfc=_0x546a9e;if(_0x41cf2d&&document[_0x4e8cfc(0x208)]['contains'](_0x41cf2d)){const _0x3b416b=_0x41cf2d[_0x4e8cfc(0x35c)][_0x4e8cfc(0x25b)];_0x41cf2d['classList']['add']('float_out'),_0x41cf2d[_0x4e8cfc(0x35c)][_0x4e8cfc(0x25b)]=_0x3b416b+'\x20translateY(-50px)',_0x41cf2d['style']['opacity']='0',_0x41cf2d['style']['transition']=_0x375ced['cHNiN'];const _0x16c61d=_0x375ced['MENWF'](setTimeout,()=>{const _0xbd9c11=_0x4e8cfc;_0x41cf2d&&document['body']['contains'](_0x41cf2d)&&(document['body'][_0xbd9c11(0x38c)](_0x41cf2d),this[_0xbd9c11(0x34f)]['delete'](_0x3a7e74));},0x320),_0x3296d8=this[_0x4e8cfc(0x34f)]['get'](_0x3a7e74);_0x3296d8&&(_0x3296d8[_0x4e8cfc(0x21b)]=_0x16c61d);}},0x5dc);return this[_0x546a9e(0x34f)]['set'](_0x3a7e74,{'element':_0x41cf2d,'timeoutId':_0x55e296,'elementId':_0x3a7e74,'widgetKey':_0x3f9599?_0x3f9599[_0x546a9e(0x3b0)]('data-widget-key'):null}),_0x41cf2d;}catch(_0x83680a){return console['error'](_0x546a9e(0x3a7),_0x83680a),null;}},'removeStatusTip'(_0x2573cb){const _0x2285bb=_0xe95701,_0x5e7afa={'RBtlh':function(_0x4a60cb,_0x153c67){return _0x4a60cb(_0x153c67);},'UtPPi':'clipFloatUp\x200.5s\x20ease-in-out\x20forwards','oqZKx':function(_0x1cdfb6,_0x28148a,_0x39efb7){return _0x1cdfb6(_0x28148a,_0x39efb7);}};try{if(!this[_0x2285bb(0x34f)])return;if(_0x2573cb){const _0xc78561=_0x2573cb['getAttribute'](_0x2285bb(0x28f));if(_0xc78561){const _0x12c663=this[_0x2285bb(0x34f)][_0x2285bb(0x2d7)](_0xc78561);if(_0x12c663&&_0x12c663[_0x2285bb(0x2c5)]&&document[_0x2285bb(0x208)][_0x2285bb(0x206)](_0x12c663['element'])){if(_0x12c663[_0x2285bb(0x3a1)])clearTimeout(_0x12c663[_0x2285bb(0x3a1)]);if(_0x12c663['removeTimeoutId'])_0x5e7afa['RBtlh'](clearTimeout,_0x12c663['removeTimeoutId']);_0x12c663[_0x2285bb(0x2c5)][_0x2285bb(0x35c)]['animation']=_0x2285bb(0x2fc),setTimeout(()=>{_0x12c663['element']&&document['body']['contains'](_0x12c663['element'])&&(document['body']['removeChild'](_0x12c663['element']),this['statusTips']['delete'](_0xc78561));},0x320);}}}else{for(const [_0x688084,_0x2c97a6]of this['statusTips']['entries']()){if(_0x2c97a6[_0x2285bb(0x2c5)]&&document[_0x2285bb(0x208)]['contains'](_0x2c97a6['element'])){if(_0x2c97a6['timeoutId'])clearTimeout(_0x2c97a6['timeoutId']);if(_0x2c97a6['removeTimeoutId'])clearTimeout(_0x2c97a6['removeTimeoutId']);_0x2c97a6['element']['style']['animation']=_0x5e7afa[_0x2285bb(0x245)],function(_0x3af2d6,_0x4ab319){setTimeout(()=>{const _0x7840d5=_0x431d;_0x4ab319['element']&&document['body']['contains'](_0x4ab319['element'])&&document[_0x7840d5(0x208)]['removeChild'](_0x4ab319['element']);},0x320);}(_0x688084,_0x2c97a6);}}_0x5e7afa[_0x2285bb(0x2ef)](setTimeout,()=>{this['statusTips']['clear']();},0x320);}}catch(_0x47eca2){console['error']('移除状态提示时出错:',_0x47eca2);}},'disableAllButtons'(_0x2da43c,_0x305d89=null){const _0x256f44=_0xe95701,_0x351f82={'wvdQR':_0x256f44(0x382)},_0x4d03ea=this[_0x256f44(0x2e9)](_0x2da43c);if(!_0x4d03ea?.['buttons'])return;Object['keys'](_0x4d03ea['buttons'])['forEach'](_0x496f86=>{const _0x2c5194=_0x256f44,_0x4771be=_0x4d03ea['buttons'][_0x496f86];_0x4771be&&(_0x496f86===_0x305d89?_0x4771be['classList']['add']('widget_button_active'):(_0x4771be[_0x2c5194(0x293)][_0x2c5194(0x3bc)](_0x351f82[_0x2c5194(0x1ed)]),_0x4771be['disabled']=!![]));});},'restoreButtonStates'(_0x299282,_0x4a695b=null){const _0x11b07c=_0xe95701,_0x543688={'LPZqA':_0x11b07c(0x342)},_0x46c039=this['getInstance'](_0x299282);if(!_0x46c039?.[_0x11b07c(0x1ff)])return;Object[_0x11b07c(0x341)](_0x46c039[_0x11b07c(0x1ff)])['forEach'](_0x17be10=>{const _0x56d7cb=_0x11b07c,_0xcc360=_0x46c039['buttons'][_0x17be10];_0xcc360&&(_0xcc360['classList'][_0x56d7cb(0x2a4)]('widget_button_disabled'),_0xcc360['classList'][_0x56d7cb(0x2a4)](_0x543688['LPZqA']),_0xcc360['disabled']=![]);}),this[_0x11b07c(0x38b)](_0x299282);},'translateText'(_0x59dff0){const _0x585b95=_0xe95701,_0x5d00f4={'iUSML':_0x585b95(0x31e),'OSDox':function(_0x2084fd,_0x11394e){return _0x2084fd===_0x11394e;},'syNrd':_0x585b95(0x2af),'hcyvy':'error','JejgU':'没有要翻译的文本','ASXLR':_0x585b95(0x26f),'PRvIx':'在缓存中找到该文本，进行恢复操作','bEmjn':_0x585b95(0x3f8),'ShrKl':_0x585b95(0x323)};if(!FEATURES[_0x585b95(0x203)])return logger['warn'](_0x585b95(0x330)),![];const _0x149d61=this['getInstance'](_0x59dff0);if(!_0x149d61?.['text_element'])return logger[_0x585b95(0x20f)]('未找到节点的文本元素:',_0x59dff0),![];const _0x2dcb63=_0x149d61['text_element'],_0x57fd44=_0x149d61[_0x585b95(0x1ff)]?.['translate'],_0x2a3f2e=_0x57fd44||_0x2dcb63,_0x842040=_0x2dcb63['value']||'';if(!_0x842040[_0x585b95(0x33e)]())return logger[_0x585b95(0x349)]('没有要翻译的文本'),this['showStatusTip'](_0x2a3f2e,_0x5d00f4[_0x585b95(0x1fa)],_0x5d00f4['JejgU']),![];if(_0x149d61['isTranslating']||_0x149d61['isExpanding']){const _0x4c9608=_0x149d61[_0x585b95(0x289)]?_0x5d00f4[_0x585b95(0x1fd)]:'扩写处理中，请稍候...';return logger[_0x585b95(0x2c4)](_0x4c9608),this['showStatusTip'](_0x2a3f2e,'loading',_0x4c9608),![];}_0x149d61[_0x585b95(0x3e0)]&&_0x149d61['recordHistory'](_0x842040);if(this['translationCache']['has'](_0x842040)){logger[_0x585b95(0x349)](_0x5d00f4['PRvIx']);const _0xe7f418=this['translationCache'][_0x585b95(0x2d7)](_0x842040);this['updateTextValue'](_0x2dcb63,_0xe7f418),this['recordHistory'](_0x59dff0,_0xe7f418);let _0x4a7091='已恢复';return _0x149d61['originalText']&&_0x842040===_0x149d61['originalText']?_0x4a7091='译文':(_0x4a7091='原文',_0x149d61[_0x585b95(0x27d)]=_0xe7f418),this['showStatusTip'](_0x2a3f2e,'restore',_0x4a7091),!![];}let _0x122f29='auto',_0x35146f='auto';const _0x318bf2=(_0x842040[_0x585b95(0x40a)](/[\u4e00-\u9fff]/g)||[])['length'],_0x462b26=_0x318bf2>_0x842040['length']*0.2;_0x462b26?_0x35146f='en':_0x35146f='zh';DEBUG&&logger[_0x585b95(0x349)]('检测到语言:\x20'+(_0x462b26?'中文':'非中文')+',\x20目标语言:\x20'+_0x35146f);const _0x51d49b=_0x2dcb63[_0x585b95(0x35c)]['border'];return _0x2dcb63['style']['border']=_0x5d00f4[_0x585b95(0x346)],_0x149d61['isTranslating']=!![],_0x57fd44&&_0x57fd44['classList']['add'](_0x5d00f4['ShrKl']),this[_0x585b95(0x3d9)](_0x59dff0,_0x585b95(0x203)),this['showStatusTip'](_0x2a3f2e,'loading','正在翻译...'),DEBUG&&logger['info']('发送翻译请求到后端...'),this['callBaiduTranslateAPI'](_0x842040,_0x59dff0,_0x122f29,_0x35146f)['then'](_0x475e64=>{const _0x5e7048=_0x585b95;_0x149d61['isTranslating']=![],_0x2dcb63[_0x5e7048(0x35c)]['border']=_0x51d49b;_0x57fd44&&(_0x57fd44['classList']['remove']('widget_button_loading'),_0x57fd44['classList'][_0x5e7048(0x2a4)]('widget_button_active'));this['restoreButtonStates'](_0x59dff0);DEBUG&&logger[_0x5e7048(0x349)](_0x5d00f4['iUSML'],_0x475e64);if(_0x5d00f4['OSDox'](_0x475e64['status'],'success')&&_0x475e64['text']){const _0xb6111e=_0x475e64[_0x5e7048(0x2b6)];DEBUG&&logger[_0x5e7048(0x349)]('翻译成功:\x20'+_0xb6111e[_0x5e7048(0x3dd)](0x0,0x1e)+(_0xb6111e['length']>0x1e?'...':'')),this[_0x5e7048(0x1e3)](_0x149d61['text_element'],_0xb6111e),this['translationCache']['set'](_0x842040,_0xb6111e),this[_0x5e7048(0x1c8)]['set'](_0xb6111e,_0x842040),this['recordHistory'](_0x59dff0,_0xb6111e),_0x149d61['originalText']=_0x842040,this[_0x5e7048(0x31d)](_0x2a3f2e,_0x5e7048(0x2aa),_0x475e64['from_cache']?_0x5d00f4['syNrd']:'翻译完成');}else this['showStatusTip'](_0x2a3f2e,_0x5e7048(0x20f),_0x475e64['message']||'翻译失败');})['catch'](_0x590425=>{const _0x2679e5=_0x585b95;_0x149d61['isTranslating']=![],_0x2dcb63['style']['border']=_0x51d49b,_0x57fd44&&(_0x57fd44['classList']['remove']('widget_button_loading'),_0x57fd44[_0x2679e5(0x293)]['remove']('widget_button_active')),this[_0x2679e5(0x350)](_0x59dff0),logger['error']('翻译请求失败:',_0x590425),this['showStatusTip'](_0x2a3f2e,'error',_0x2679e5(0x212)+_0x590425['message']);}),!![];},async 'expandText'(_0x3f5e9e){const _0x2633c8=_0xe95701,_0x2ed8fe={'AIRHH':_0x2633c8(0x20f),'Zjvpi':'扩写中，请稍候...','jYswx':'翻译中，请稍候...','qZCmu':'widget_button_loading','EgmgK':'expand','FZZwj':'widget_button_active','kotjW':'success','BwNow':_0x2633c8(0x327)},_0x2890f7=this[_0x2633c8(0x2e9)](_0x3f5e9e);if(!_0x2890f7?.['text_element'])return logger[_0x2633c8(0x20f)]('未找到节点的文本元素:',_0x3f5e9e),![];const _0x380f7b=_0x2890f7[_0x2633c8(0x3e3)],_0x8125d6=_0x2890f7['buttons']?.['expand'],_0x233108=_0x8125d6||_0x380f7b,_0x416561=_0x380f7b['value']||'';if(!_0x416561[_0x2633c8(0x33e)]())return logger['info']('没有要扩写的文本'),this['showStatusTip'](_0x233108,_0x2ed8fe[_0x2633c8(0x22c)],'没有要扩写的文本'),![];if(_0x2890f7['isExpanding']||_0x2890f7['isTranslating']){const _0x24a383=_0x2890f7[_0x2633c8(0x2ed)]?_0x2ed8fe['Zjvpi']:_0x2ed8fe['jYswx'];return logger['warn'](_0x24a383),this['showStatusTip'](_0x233108,'loading',_0x24a383),![];}_0x2890f7['recordHistory']&&_0x2890f7[_0x2633c8(0x3e0)](_0x416561);const _0x22bf00=_0x380f7b[_0x2633c8(0x35c)]['border'];_0x380f7b['style']['border']=_0x2633c8(0x361),_0x2890f7['isExpanding']=!![];_0x8125d6&&_0x8125d6[_0x2633c8(0x293)]['add'](_0x2ed8fe[_0x2633c8(0x3ce)]);this['disableAllButtons'](_0x3f5e9e,_0x2ed8fe['EgmgK']),this['showStatusTip'](_0x233108,'loading','正在扩写...');try{const _0xa0bf9a=await fetch('/expand_text',{'method':_0x2633c8(0x2bf),'headers':{'Content-Type':'application/json'},'body':JSON[_0x2633c8(0x3f1)]({'text':_0x416561,'node_id':_0x3f5e9e})});_0x2890f7['isExpanding']=![],_0x380f7b[_0x2633c8(0x35c)]['border']=_0x22bf00;_0x8125d6&&(_0x8125d6[_0x2633c8(0x293)][_0x2633c8(0x2a4)](_0x2ed8fe['qZCmu']),_0x8125d6['classList']['remove'](_0x2ed8fe['FZZwj']));this['restoreButtonStates'](_0x3f5e9e);if(!_0xa0bf9a['ok'])throw new Error('HTTP\x20error!\x20status:\x20'+_0xa0bf9a[_0x2633c8(0x254)]);const _0xbc9438=await _0xa0bf9a['json']();if(_0xbc9438['success']&&_0xbc9438['expanded_text']){const _0x577f1e=_0xbc9438['expanded_text'];return this['updateTextValue'](_0x2890f7['text_element'],_0x577f1e),this['forceRecordHistory'](_0x3f5e9e,_0x577f1e),this[_0x2633c8(0x31d)](_0x233108,_0x2ed8fe[_0x2633c8(0x27f)],'扩写完成'),!![];}else throw new Error(_0xbc9438[_0x2633c8(0x20f)]||_0x2ed8fe['BwNow']);}catch(_0x143bd2){_0x2890f7['isExpanding']=![],_0x380f7b['style']['border']=_0x22bf00;_0x8125d6&&(_0x8125d6['classList']['remove']('widget_button_loading'),_0x8125d6[_0x2633c8(0x293)]['remove']('widget_button_active'));this[_0x2633c8(0x350)](_0x3f5e9e);const _0x242d59=_0x143bd2['message']||'无法连接LLM服务';return this['showStatusTip'](_0x233108,_0x2633c8(0x20f),'扩写失败:\x20'+_0x242d59),logger['error']('扩写文本时出错:',_0x143bd2),![];}},'forceRecordHistory'(_0x1d2419,_0x40c1d8){const _0x2ed914=_0xe95701;if(!_0x1d2419)return;try{this['initOrClearHistory'](_0x1d2419);const _0x39d7a9=String(_0x1d2419),_0x286ff4=this[_0x2ed914(0x24d)]['get'](_0x39d7a9);if(!_0x286ff4)return;_0x286ff4['past'][_0x2ed914(0x3cb)](_0x286ff4['current']),_0x286ff4['current']=_0x40c1d8,_0x286ff4['future']=[],_0x286ff4['past']['length']>0x14&&_0x286ff4[_0x2ed914(0x302)]['shift'](),this[_0x2ed914(0x38b)](_0x1d2419);}catch(_0x20cc98){logger['error']('强制记录节点\x20'+_0x1d2419+_0x2ed914(0x3ec),_0x20cc98);}},async 'loadPresets'(){const _0x105946=_0xe95701;try{if(this['presets'])return this['presets'];const _0x21bd08=_0x105946(0x333),_0x289271=await fetch(_0x21bd08);if(!_0x289271['ok'])throw new Error('Failed\x20to\x20load\x20presets:\x20'+_0x289271[_0x105946(0x254)]+'\x20'+_0x289271['statusText']);const _0x198c23=await _0x289271['json']();return this['presets']=_0x198c23['presets']||[],logger['log']('成功加载\x20'+this[_0x105946(0x379)][_0x105946(0x215)]+'\x20个预设'),this[_0x105946(0x379)];}catch(_0x3b9269){return logger['error'](_0x105946(0x39e),_0x3b9269),this['presets']=[],[];}},async 'showPresets'(_0xa43f15){const _0xce035c=_0xe95701,_0x5e3783={'fqGhN':function(_0x2ad559,_0x5c99c9){return _0x2ad559===_0x5c99c9;},'ACvPt':'没有可用的预设'};if(!_0xa43f15||!FEATURES['enabled']||!FEATURES['preset'])return![];try{const _0x3de864=String(_0xa43f15);this['activeHistoryPopup']&&this['closeHistoryPopup']();if(this[_0xce035c(0x320)])return this['closePresetPopup'](),!![];const _0x31c63e=this['getInstance'](_0x3de864);if(!_0x31c63e?.[_0xce035c(0x2c5)]||!_0x31c63e['buttons']?.['preset'])return logger['warn']('无法显示预设：找不到节点\x20'+_0xa43f15+'\x20的元素或按钮'),![];this['showEffect'](_0x31c63e['buttons']['preset'],_0xce035c(0x342)),await this[_0xce035c(0x37a)]();if(!this['presets']||_0x5e3783[_0xce035c(0x268)](this['presets'][_0xce035c(0x215)],0x0))return logger[_0xce035c(0x349)](_0xce035c(0x357)),this['showStatusTip'](_0x31c63e[_0xce035c(0x1ff)][_0xce035c(0x3d1)],'info',_0x5e3783['ACvPt']),![];return this[_0xce035c(0x367)](_0x3de864,this[_0xce035c(0x379)],_0x31c63e['buttons']['preset']),!![];}catch(_0x352e8f){return logger[_0xce035c(0x20f)]('节点\x20'+_0xa43f15+_0xce035c(0x2cb),_0x352e8f),![];}},'createPresetPopup'(_0x1e194a,_0x4eed79,_0x48522e){const _0x11e2df=_0xe95701,_0x20474e={'fDwhW':'prompt_history_item','zRJNe':_0x11e2df(0x1d4),'QIGFe':'风格提示词','hqQmy':'span','ckUtq':'prompt_preset_note','aaMyN':'preset-clean-button-container','KnIhd':_0x11e2df(0x262),'SmpmQ':_0x11e2df(0x331),'ziyIp':'button','lmgwy':'从输入框中清除此预设','DFxKM':'click','vpDjc':_0x11e2df(0x1f6),'wctDu':function(_0x14fb98,_0x55c85f){return _0x14fb98===_0x55c85f;},'Siyul':'没有预设可显示','QnUVz':'prompt_history_close','PCunt':_0x11e2df(0x3f0),'Wfojw':function(_0x53550e,_0x1c2772){return _0x53550e+_0x1c2772;},'lrsOc':function(_0x2aa40b,_0x1d8f54){return _0x2aa40b>_0x1d8f54;},'WegQt':'bottom','lxIFL':function(_0x4854f0,_0x2b5ddb){return _0x4854f0-_0x2b5ddb;},'EDBpt':'top','aYxNV':function(_0x47aad3,_0x1e3df1,_0x26cbb5){return _0x47aad3(_0x1e3df1,_0x26cbb5);}};this[_0x11e2df(0x30b)]();if(!_0x4eed79||_0x20474e[_0x11e2df(0x2bc)](_0x4eed79['length'],0x0))return logger[_0x11e2df(0x2c4)](_0x20474e['Siyul']),null;const _0x2cd473=document[_0x11e2df(0x32a)]('div');_0x2cd473['className']='prompt_history_popup',_0x2cd473['setAttribute'](_0x11e2df(0x1d5),_0x1e194a);const _0x42a4e1=document['createElement']('div');_0x42a4e1['className']='prompt_history_title_bar';const _0xf26e39=document[_0x11e2df(0x32a)](_0x11e2df(0x1f6));_0xf26e39[_0x11e2df(0x363)]='prompt_history_title',_0xf26e39[_0x11e2df(0x1f7)]='提示词预设';const _0x14a257=document[_0x11e2df(0x32a)]('div');_0x14a257['className']='prompt_history_actions';const _0x2f4f69=document[_0x11e2df(0x32a)]('button');_0x2f4f69['className']=_0x20474e['QnUVz'],_0x2f4f69['textContent']='×',_0x2f4f69[_0x11e2df(0x3ca)]('click',_0x5c4c6d=>{_0x5c4c6d['stopPropagation'](),this['closePresetPopup']();}),_0x14a257['appendChild'](_0x2f4f69),_0x42a4e1['appendChild'](_0xf26e39),_0x42a4e1['appendChild'](_0x14a257),_0x2cd473[_0x11e2df(0x249)](_0x42a4e1);const _0x2b945e=document[_0x11e2df(0x32a)](_0x20474e[_0x11e2df(0x252)]);_0x2b945e['className']=_0x20474e['PCunt'],_0x4eed79['forEach']((_0x5dfcb4,_0x28a355)=>{const _0x53b96e=_0x11e2df;if(!_0x5dfcb4['content']||!_0x5dfcb4[_0x53b96e(0x272)]['trim']())return;const _0x4bd7c1=document[_0x53b96e(0x32a)](_0x53b96e(0x1f6));_0x4bd7c1[_0x53b96e(0x363)]=_0x20474e['fDwhW'],_0x4bd7c1[_0x53b96e(0x2a0)]('data-index',_0x28a355);const _0x34f5d8=TranslateManager[_0x53b96e(0x2e9)](_0x1e194a),_0x1d7ff0=_0x34f5d8?.[_0x53b96e(0x3e3)]?.['value']||'',_0x4dde88=_0x1d7ff0['includes'](_0x5dfcb4['content']),_0x46d729=document['createElement']('span');_0x46d729[_0x53b96e(0x363)]=_0x20474e['zRJNe'],_0x46d729['textContent']=_0x5dfcb4[_0x53b96e(0x1e1)]||'未分类';if(_0x5dfcb4[_0x53b96e(0x2c6)])_0x46d729['classList']['add'](_0x53b96e(0x2b1)+_0x5dfcb4['color_type']);else switch(_0x5dfcb4[_0x53b96e(0x1e1)]){case'质量指示词':_0x46d729['classList']['add']('preset_type_quality');break;case _0x20474e['QIGFe']:_0x46d729['classList'][_0x53b96e(0x3bc)]('preset_type_style');break;case'负面提示词':_0x46d729['classList'][_0x53b96e(0x3bc)]('preset_type_negative');break;default:_0x46d729['classList']['add']('preset_type_default');}const _0x498e6d=document['createElement']('span');_0x498e6d['className']=_0x53b96e(0x1dc),_0x498e6d['textContent']=_0x5dfcb4[_0x53b96e(0x272)]['length']>0x32?_0x5dfcb4['content'][_0x53b96e(0x3dd)](0x0,0x32)+'...':_0x5dfcb4[_0x53b96e(0x272)],_0x498e6d['title']=_0x5dfcb4[_0x53b96e(0x272)];const _0x4fc4bd=document['createElement'](_0x20474e['hqQmy']);_0x4fc4bd[_0x53b96e(0x363)]=_0x20474e['ckUtq'],_0x4fc4bd[_0x53b96e(0x1f7)]=_0x5dfcb4[_0x53b96e(0x2fa)]||'',_0x4fc4bd[_0x53b96e(0x353)]=_0x5dfcb4[_0x53b96e(0x2fa)];const _0x6b4336=document['createElement']('span');_0x6b4336['className']=_0x20474e['aaMyN'],_0x6b4336['style'][_0x53b96e(0x30f)]=_0x4dde88?_0x20474e[_0x53b96e(0x3fb)]:_0x20474e[_0x53b96e(0x3eb)];const _0x21717a=document[_0x53b96e(0x32a)](_0x20474e[_0x53b96e(0x1c7)]);_0x21717a['className']='preset-action-button\x20erase-button',_0x21717a['title']=_0x20474e['lmgwy'],_0x21717a['addEventListener'](_0x20474e['DFxKM'],_0x1b920e=>{const _0x4c851a=_0x53b96e;_0x1b920e['stopPropagation'](),TranslateManager[_0x4c851a(0x229)](_0x1e194a,_0x5dfcb4['content']),_0x6b4336['style']['display']=_0x4c851a(0x331);}),_0x6b4336[_0x53b96e(0x249)](_0x21717a);const _0x504aeb=document['createElement']('div');_0x504aeb['style']['cssText']=_0x53b96e(0x344);const _0x102c10=document['createElement'](_0x20474e['vpDjc']);_0x102c10['style']['cssText']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20flex;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20justify-content:\x20space-between;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20align-items:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin-bottom:\x204px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x102c10['appendChild'](_0x46d729),_0x102c10['appendChild'](_0x4fc4bd);const _0x14c2e4=document['createElement'](_0x53b96e(0x1f6));_0x14c2e4['style']['cssText']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20flex;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20align-items:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20justify-content:\x20space-between;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x14c2e4['appendChild'](_0x498e6d),_0x14c2e4['appendChild'](_0x6b4336),_0x504aeb['appendChild'](_0x102c10),_0x504aeb['appendChild'](_0x14c2e4),_0x4bd7c1['appendChild'](_0x504aeb),_0x4bd7c1['addEventListener']('click',_0xf77875=>{_0xf77875['stopPropagation'](),!_0x4dde88&&(TranslateManager['applyPreset'](_0x1e194a,_0x5dfcb4['content']),_0x6b4336['style']['display']='inline-flex');}),_0x4dde88&&(_0x4bd7c1[_0x53b96e(0x293)][_0x53b96e(0x3bc)]('preset-applied'),_0x4bd7c1[_0x53b96e(0x35c)]['backgroundColor']='rgba(100,\x20255,\x20100,\x200.1)'),_0x2b945e[_0x53b96e(0x249)](_0x4bd7c1);}),_0x2cd473[_0x11e2df(0x249)](_0x2b945e);const _0x255be2=_0x48522e[_0x11e2df(0x403)]();let _0x3d17c3=_0x255be2['left'],_0x4d9d2d=_0x20474e['Wfojw'](_0x255be2['bottom'],0x5);_0x20474e['lrsOc'](_0x3d17c3+0x12c,window['innerWidth'])&&(_0x3d17c3=window[_0x11e2df(0x317)]-0x136);const _0xc270ba=0x15e;return _0x4d9d2d+_0xc270ba>window['innerHeight']?(_0x4d9d2d=_0x255be2['top']-0x5,_0x2cd473[_0x11e2df(0x35c)]['transformOrigin']=_0x20474e['WegQt'],_0x2cd473['style']['top']='auto',_0x2cd473[_0x11e2df(0x35c)]['bottom']=_0x20474e['lxIFL'](window[_0x11e2df(0x21c)],_0x4d9d2d)+'px',_0x2cd473['classList']['add'](_0x11e2df(0x1ec))):(_0x2cd473['style']['transformOrigin']=_0x20474e[_0x11e2df(0x279)],_0x2cd473[_0x11e2df(0x35c)]['top']=Math['max'](0xa,_0x4d9d2d)+'px',_0x2cd473['style']['bottom']=_0x11e2df(0x20a),_0x2cd473['classList']['add']('popup_up')),_0x2cd473[_0x11e2df(0x35c)]['left']=Math['max'](0xa,_0x3d17c3)+'px',document[_0x11e2df(0x208)]['appendChild'](_0x2cd473),this['activePresetPopup']=_0x2cd473,this['handleDocumentClick']=_0x58b170=>{_0x2cd473&&!_0x2cd473['contains'](_0x58b170['target'])&&_0x58b170['target']!==_0x48522e&&this['closePresetPopup']();},_0x20474e['aYxNV'](setTimeout,()=>{const _0x2b92f4=_0x11e2df;document['addEventListener']('click',this[_0x2b92f4(0x332)]);},0xa),_0x2cd473;},'closePresetPopup'(){const _0x476b7b=_0xe95701,_0x56143b={'HycTF':_0x476b7b(0x373)};try{if(this[_0x476b7b(0x320)]){const _0x3b78f1=this[_0x476b7b(0x320)]['classList']['contains']('popup_down'),_0x1f3adb=_0x3b78f1?_0x476b7b(0x1ea):'closing-down';this['activePresetPopup']['classList']['add'](_0x1f3adb),this['handleDocumentClick']&&(document['removeEventListener'](_0x476b7b(0x373),this['handleDocumentClick']),this[_0x476b7b(0x332)]=null),setTimeout(()=>{try{this['activePresetPopup']&&document['body']['contains'](this['activePresetPopup'])&&document['body']['removeChild'](this['activePresetPopup']);}catch(_0x2cd180){}this['activePresetPopup']=null;},0xc8);}}catch(_0xaa8dc7){try{this[_0x476b7b(0x320)]&&document['body'][_0x476b7b(0x206)](this[_0x476b7b(0x320)])&&document['body']['removeChild'](this['activePresetPopup']);}catch(_0x3a3c03){}this[_0x476b7b(0x320)]=null,this['handleDocumentClick']&&(document['removeEventListener'](_0x56143b['HycTF'],this['handleDocumentClick']),this['handleDocumentClick']=null);}},'applyPreset'(_0xddcf9e,_0x1253ff){const _0x57f933=_0xe95701,_0x3dac0f={'oxQhu':function(_0xd95bca,_0x1239ff){return _0xd95bca!==_0x1239ff;},'WqBrr':function(_0x74775d,_0x47e0ec){return _0x74775d+_0x47e0ec;}};if(!_0xddcf9e||!FEATURES['enabled']||!FEATURES['preset'])return![];const _0x190fa6=this[_0x57f933(0x2e9)](_0xddcf9e);if(!_0x190fa6?.['text_element'])return logger['error']('未找到节点的文本元素:',_0xddcf9e),![];const _0x14871b=_0x190fa6[_0x57f933(0x3e3)],_0x226203=_0x14871b['value']||'',_0x184fc3=_0x14871b['selectionStart'],_0x5d36bc=_0x184fc3!==undefined&&_0x3dac0f[_0x57f933(0x25a)](_0x184fc3,null);if(_0x226203['includes'](_0x1253ff))return this[_0x57f933(0x31d)](_0x190fa6['buttons']['preset'],'info',_0x57f933(0x280)),![];const _0x2f8cb0=_0x1253ff['trim']()['replace'](/^,+|,+$/g,'');let _0x2f12f8;if(!_0x226203)_0x2f12f8=_0x2f8cb0;else{if(_0x5d36bc){const _0x3481e9=_0x226203[_0x57f933(0x3dd)](0x0,_0x184fc3)['trim'](),_0x48ba54=_0x226203['substring'](_0x184fc3)[_0x57f933(0x33e)]();let _0x5c3b77=_0x3481e9;if(_0x5c3b77&&!_0x5c3b77['endsWith'](','))_0x5c3b77+=',\x20';else _0x5c3b77&&_0x5c3b77['endsWith'](',')&&(_0x5c3b77+='\x20');let _0x5bc733=_0x48ba54;if(_0x5bc733&&!_0x5bc733[_0x57f933(0x33b)](','))_0x5bc733=_0x3dac0f[_0x57f933(0x3e9)](',\x20',_0x5bc733);else _0x5bc733&&_0x5bc733['startsWith'](',')&&(_0x5bc733=_0x3dac0f[_0x57f933(0x3e9)]('\x20',_0x5bc733));_0x2f12f8=_0x5c3b77+_0x2f8cb0+(_0x5bc733?_0x5bc733:'');const _0x49a087=_0x5c3b77[_0x57f933(0x215)]+_0x2f8cb0['length'];setTimeout(()=>{const _0x403720=_0x57f933;_0x14871b[_0x403720(0x334)]=_0x49a087,_0x14871b[_0x403720(0x255)]=_0x49a087;},0x0);}else{const _0x331494=_0x226203[_0x57f933(0x33e)]()['replace'](/,+$/g,'');_0x2f12f8=_0x331494?_0x331494+',\x20'+_0x2f8cb0:_0x2f8cb0;}}return _0x2f12f8=_0x2f12f8[_0x57f933(0x33e)]()['replace'](/\s*,\s*/g,',\x20')['replace'](/,+/g,',')['replace'](/^,+|,+$/g,'')['trim'](),this['updateTextValue'](_0x14871b,_0x2f12f8),this['recordHistory'](_0xddcf9e,_0x2f12f8),this[_0x57f933(0x31d)](_0x190fa6['buttons'][_0x57f933(0x3d1)],'success',_0x57f933(0x360)),this['updatePresetItemState'](_0xddcf9e,_0x1253ff,!![]),!![];},'updatePresetItemState'(_0x5768bb,_0xab75bd,_0x34fca7){const _0x332e11=_0xe95701,_0x708aec={'Jkmew':'.prompt_preset_content','QLuCI':'rgba(100,\x20255,\x20100,\x200.1)','GXuxp':'.prompt_history_item'};try{const _0x1980cd=document['querySelectorAll'](_0x708aec[_0x332e11(0x29f)]);_0x1980cd[_0x332e11(0x1df)](_0x4254b0=>{const _0x59be4e=_0x332e11,_0x2ef525=_0x4254b0['querySelector'](_0x708aec['Jkmew']);if(_0x2ef525&&(_0x2ef525['textContent']===_0xab75bd||_0x2ef525['title']===_0xab75bd)){_0x34fca7?(_0x4254b0['classList']['add']('preset-applied'),_0x4254b0[_0x59be4e(0x35c)][_0x59be4e(0x300)]=_0x708aec['QLuCI']):(_0x4254b0['classList']['remove']('preset-applied'),_0x4254b0['style']['backgroundColor']='');const _0x12a5f5=_0x4254b0['querySelector'](_0x59be4e(0x3b9));_0x12a5f5&&(_0x12a5f5['style']['display']=_0x34fca7?'inline-flex':_0x59be4e(0x331));}});}catch(_0x28a393){logger[_0x332e11(0x20f)](_0x332e11(0x29a),_0x28a393);}},'executeAction'(_0x41ba07,_0x1e4271,..._0x2ecb16){const _0x20d02a=_0xe95701,_0x3ee906={'wVglR':'redo'};if(!_0x41ba07||!_0x1e4271)return logger['error'](_0x20d02a(0x30c)+_0x41ba07+',\x20'+_0x1e4271),![];try{const _0x3ae6d9=String(_0x41ba07);if(!this['hasInstance'](_0x3ae6d9))return logger['error']('找不到节点实例:\x20'+_0x41ba07),![];switch(_0x1e4271['toLowerCase']()){case _0x20d02a(0x24d):return this[_0x20d02a(0x25d)](_0x3ae6d9);case _0x20d02a(0x3bb):return this['undoOperation'](_0x3ae6d9);case _0x3ee906['wVglR']:return this[_0x20d02a(0x3e8)](_0x3ae6d9);case'translate':return this['translateText'](_0x3ae6d9);case'expand':return this['expandText'](_0x3ae6d9);case'preset':return this['showPresets'](_0x3ae6d9);default:logger['error']('未知的操作类型:\x20'+_0x1e4271);return![];}}catch(_0x302677){return logger['error']('执行操作\x20'+_0x1e4271+_0x20d02a(0x2ec),_0x302677),![];}},async 'reloadConfig'(){const _0x15dabe=_0xe95701,_0x4d7ed5={'HRRur':'配置已重新加载','SxnJL':'重新加载配置失败:'};try{const _0x18166f=await loadConfig();return this['presets']=null,await this['loadPresets'](),logger[_0x15dabe(0x349)](_0x4d7ed5['HRRur']),!![];}catch(_0xe94035){return logger['error'](_0x4d7ed5['SxnJL'],_0xe94035),![];}},'cleanPresetFromInput'(_0x2ab803,_0x575e3a){const _0x146096=_0xe95701,_0x597bfc={'pgzBi':function(_0x3d0529,_0x51db53){return _0x3d0529||_0x51db53;}};if(_0x597bfc[_0x146096(0x2de)](!_0x2ab803,!_0x575e3a))return![];const _0x1b9146=this['getInstance'](_0x2ab803);if(!_0x1b9146?.[_0x146096(0x3e3)])return logger['error']('未找到节点的文本元素:',_0x2ab803),![];const _0x269078=_0x1b9146['text_element'],_0x3da3cf=_0x269078[_0x146096(0x209)]||'';if(!_0x3da3cf['includes'](_0x575e3a))return this['showStatusTip'](_0x1b9146['buttons']['preset'],'info','未找到预设内容'),![];let _0x5c8b80=_0x3da3cf;return _0x5c8b80=_0x5c8b80['replace'](',\x20'+_0x575e3a,''),_0x5c8b80=_0x5c8b80[_0x146096(0x301)](_0x575e3a+',\x20',''),_0x5c8b80=_0x5c8b80['replace'](_0x575e3a,''),_0x5c8b80=_0x5c8b80['replace'](/,\s*,/g,',')[_0x146096(0x301)](/^\s*,\s*/,'')[_0x146096(0x301)](/\s*,\s*$/,'')['trim'](),this[_0x146096(0x1e3)](_0x269078,_0x5c8b80),this[_0x146096(0x3e0)](_0x2ab803,_0x5c8b80),this[_0x146096(0x31d)](_0x1b9146[_0x146096(0x1ff)]['preset'],'success','已清除预设'),this[_0x146096(0x3be)](_0x2ab803,_0x575e3a,![]),!![];}};function addStylesheet(){const _0xd60946=_0xe95701,_0x551f26={'dUERA':'clip-translate-styles'};if(document['getElementById']('clip-translate-styles'))return;const _0x22e28d=document['createElement']('link');_0x22e28d['id']=_0x551f26['dUERA'],_0x22e28d[_0xd60946(0x228)]='stylesheet',_0x22e28d['type']='text/css';const _0x1f3bd3=import.meta['url'],_0x2943f7=_0x1f3bd3['replace']('prompt_widget.js','style.css');return _0x22e28d['href']=_0x2943f7,document[_0xd60946(0x3d8)]['appendChild'](_0x22e28d),_0x22e28d;}function getPosition(_0x1387d1,_0x30c708,_0x1c4878,_0x1d8e3c,_0xf81fe3,_0x5b985e){const _0x14fa66=_0xe95701,_0x465bb4={'RqCVM':'none','xGrLA':function(_0x322d69,_0x5d0a10){return _0x322d69/_0x5d0a10;},'GJELX':function(_0x2a478f,_0x1c183c){return _0x2a478f-_0x1c183c;},'JMxmK':function(_0x127bab,_0x20edb8){return _0x127bab+_0x20edb8;},'lmWVb':'flex','TOtVL':_0x14fa66(0x28b)};if(!_0x1387d1||!_0xf81fe3?.['inputEl'])return logger['warn']('无法计算位置:\x20上下文或输入元素缺失'),null;try{if(_0x5b985e&&_0x5b985e['flags']&&_0x5b985e['flags'][_0x14fa66(0x270)])return{'display':_0x465bb4[_0x14fa66(0x338)]};const _0x122142=_0x1387d1[_0x14fa66(0x35b)][_0x14fa66(0x403)](),_0x5ce9b7=new DOMMatrix()['scaleSelf'](_0x465bb4[_0x14fa66(0x1cd)](_0x122142['width'],_0x1387d1['canvas'][_0x14fa66(0x343)]),_0x122142['height']/_0x1387d1['canvas']['height'])['multiplySelf'](_0x1387d1[_0x14fa66(0x207)]()),_0x29d12f=new DOMMatrix()['scaleSelf'](_0x5ce9b7['a'],_0x5ce9b7['d']),_0x48d5ba=_0xf81fe3[_0x14fa66(0x404)][_0x14fa66(0x403)]();if(!_0x48d5ba['width']||!_0x48d5ba['height'])return logger[_0x14fa66(0x2c4)]('文本输入框尺寸无效',_0x48d5ba),{'display':_0x465bb4['RqCVM']};return{'transformOrigin':_0x14fa66(0x259),'transform':_0x29d12f,'left':_0x465bb4['GJELX'](_0x48d5ba['right'],0x78*_0x29d12f['a'])-0x10+'px','top':_0x465bb4['JMxmK'](_0x48d5ba['bottom'],0x4)+'px','zIndex':+(_0xf81fe3[_0x14fa66(0x404)]['style']['zIndex']||0x14)+0x1,'display':_0x465bb4[_0x14fa66(0x22d)]};}catch(_0x1bb2d2){return logger['error'](_0x465bb4['TOtVL'],_0x1bb2d2),{'display':'none'};}}function createIconButton(_0x4f29b5,_0x11e1b7,_0x50b0e0,_0x457742){const _0x3abc39=_0xe95701,_0x3c6180={'kvJAV':'widget_button_active','PRlcK':_0x3abc39(0x2ba),'fpWCy':'data-input-id'},_0x342f8b=import.meta['url']['replace']('prompt_widget.js','assets/'),_0x1c3312=new URL(_0x4f29b5,_0x342f8b)[_0x3abc39(0x214)];let _0xe54ced,_0x4526bd;_0x457742&&_0x457742['includes']('_')?[_0xe54ced,_0x4526bd]=_0x457742[_0x3abc39(0x38e)]('_',0x2):(_0xe54ced=_0x457742,_0x4526bd='default');const _0x27c0a9=_0x457742['replace'](/\s+/g,'-'),_0x488665=$el(_0x3c6180['PRlcK'],{'onclick':_0x57873a=>{const _0x33859f=_0x3abc39;_0x57873a['preventDefault'](),_0x57873a['stopPropagation'](),_0x488665['classList']['add'](_0x3c6180['kvJAV']),setTimeout(()=>_0x488665[_0x33859f(0x293)]['remove']('widget_button_active'),0xc8),_0x50b0e0?.(_0x457742);},'style':{'backgroundImage':_0x3abc39(0x345)+_0x1c3312+'\x27)'},'title':_0x11e1b7,'dataset':{'nodeId':_0xe54ced['replace'](/\s+/g,'-'),'inputId':_0x4526bd['replace'](/\s+/g,'-'),'widgetKey':_0x27c0a9}});return _0x488665['setAttribute']('data-node-id',_0xe54ced['replace'](/\s+/g,'-')),_0x488665['setAttribute'](_0x3c6180['fpWCy'],_0x4526bd['replace'](/\s+/g,'-')),_0x488665[_0x3abc39(0x2a0)](_0x3abc39(0x313),_0x27c0a9),_0x488665[_0x3abc39(0x293)]['add']('translate-button-'+_0x27c0a9),TranslateManager[_0x3abc39(0x26b)](_0x488665),_0x488665;}function createDivider(){return $el('div.widget_divider');}function TranslateWidget(_0x55e2a3,_0x495e7b,_0x5bf0d3,_0x314e0e){const _0x34b0b5=_0xe95701,_0x40675b={'lxTMb':function(_0x38bd33,_0x37e9f8,_0x52c0e2,_0x400af0,_0xab9419){return _0x38bd33(_0x37e9f8,_0x52c0e2,_0x400af0,_0xab9419);},'NZNjN':'blur','Rkipv':'icon-history.svg','Ojkqo':_0x34b0b5(0x216),'qUoje':'icon-expand.svg','nQOiM':'icon-translate.svg','tUccJ':function(_0x30e411){return _0x30e411();},'gUwCe':_0x34b0b5(0x241),'BPRlb':_0x34b0b5(0x38d),'AFETy':function(_0x2b5797,_0x37b7ce,_0x5a1f7f){return _0x2b5797(_0x37b7ce,_0x5a1f7f);},'dTWWD':_0x34b0b5(0x1d5),'zVxbf':_0x34b0b5(0x313)};if(!FEATURES[_0x34b0b5(0x3c7)])return null;const _0x27b525=_0x55e2a3['id'],_0x1a48d2=_0x495e7b||_0x34b0b5(0x312),_0x28fb21=_0x27b525+'_'+_0x1a48d2;logger['log'](_0x34b0b5(0x1d8)+_0x28fb21);TranslateManager['hasInstance'](_0x28fb21)&&(logger['log']('输入控件已有翻译小部件实例，先清理'),TranslateManager['cleanup'](_0x28fb21));const _0x1e6098={'type':'translate_widget','name':_0x1a48d2,'nodeId':_0x27b525,'inputId':_0x1a48d2,'widgetKey':_0x28fb21,'buttons':{},'text_element':_0x314e0e?.[_0x34b0b5(0x404)],'node':_0x55e2a3,'isTranslating':![]};if(_0x1e6098['text_element']){let _0x1d1ff0=_0x1e6098['text_element'][_0x34b0b5(0x209)]||'';const _0x52107d=_0x455113=>{const _0x8bb616=_0x34b0b5;if(!FEATURES['history'])return![];if(!_0x455113['trim']())return![];const _0x1d8792=TranslateManager['history']['get'](_0x28fb21);if(_0x1d8792&&(_0x1d8792['current']===_0x455113||_0x1d8792[_0x8bb616(0x302)][_0x8bb616(0x2b4)](_0x455113)))return![];return!![];},_0x458d1d=_0x405996=>{const _0xfed71d=_0x34b0b5;_0x52107d(_0x405996)&&(TranslateManager['recordHistory'](_0x28fb21,_0x405996),_0x1d1ff0=_0x405996,TranslateManager[_0xfed71d(0x38b)](_0x28fb21));},_0xac3372=()=>{const _0x1eab57=_0x34b0b5;if(_0x1e6098[_0x1eab57(0x3e3)]){const _0x50a120=_0x1e6098['text_element']['value'];_0x458d1d(_0x50a120);}};_0x1e6098['text_element']['addEventListener'](_0x40675b['NZNjN'],_0xac3372),_0x1e6098['recordHistory']=_0x458d1d,_0x1e6098[_0x34b0b5(0x290)]=_0xac3372;}const _0x130f62={'history':_0x5696ff=>TranslateManager['executeAction'](_0x5696ff,'history'),'undo':_0x224a1b=>TranslateManager['executeAction'](_0x224a1b,'undo'),'redo':_0x370e6b=>TranslateManager['executeAction'](_0x370e6b,'redo'),'expand':_0x3f10cf=>TranslateManager['executeAction'](_0x3f10cf,'expand'),'translate':_0x59841d=>TranslateManager['executeAction'](_0x59841d,'translate'),'preset':_0x3a1d59=>TranslateManager['executeAction'](_0x3a1d59,'preset')},_0x250213={'history':[_0x40675b['Rkipv'],_0x40675b[_0x34b0b5(0x22a)]],'undo':['icon-undo.svg','撤销'],'redo':['icon-redo.svg','重做'],'preset':['icon-preset.svg','提示词预设'],'expand':[_0x40675b['qUoje'],'扩写文本'],'translate':[_0x40675b[_0x34b0b5(0x253)],'翻译文本']},_0x4af540=[];FEATURES[_0x34b0b5(0x24d)]&&([_0x34b0b5(0x24d),'undo','redo']['forEach'](_0x5844c2=>{const _0x40e957=_0x34b0b5;try{const [_0x5adc7c,_0x299325]=_0x250213[_0x5844c2];_0x1e6098['buttons'][_0x5844c2]=_0x40675b[_0x40e957(0x32b)](createIconButton,_0x5adc7c,_0x299325,_0x130f62[_0x5844c2],_0x28fb21),_0x4af540[_0x40e957(0x3cb)](_0x1e6098[_0x40e957(0x1ff)][_0x5844c2]);}catch(_0xabccfd){logger[_0x40e957(0x20f)]('创建按钮\x20'+_0x5844c2+'\x20失败:',_0xabccfd);}}),_0x4af540['push'](_0x40675b['tUccJ'](createDivider)));if(FEATURES['preset'])try{const [_0x2568b7,_0x2db0a3]=_0x250213['preset'];_0x1e6098[_0x34b0b5(0x1ff)]['preset']=createIconButton(_0x2568b7,_0x2db0a3,_0x130f62['preset'],_0x28fb21),_0x4af540['push'](_0x1e6098['buttons'][_0x34b0b5(0x3d1)]);}catch(_0x94feba){logger['error'](_0x40675b['gUwCe'],_0x94feba);}if(FEATURES['expand'])try{const [_0x3995d2,_0x502424]=_0x250213['expand'];_0x1e6098['buttons']['expand']=createIconButton(_0x3995d2,_0x502424,_0x130f62[_0x34b0b5(0x1fe)],_0x28fb21),_0x4af540['push'](_0x1e6098['buttons']['expand']);}catch(_0x102d1e){logger['error']('创建扩写按钮失败:',_0x102d1e);}if(FEATURES['translate'])try{const [_0x542891,_0x400ca1]=_0x250213['translate'];_0x1e6098[_0x34b0b5(0x1ff)]['translate']=createIconButton(_0x542891,_0x400ca1,_0x130f62['translate'],_0x28fb21),_0x4af540['push'](_0x1e6098['buttons'][_0x34b0b5(0x203)]);}catch(_0x3c7f03){logger['error'](_0x40675b['BPRlb'],_0x3c7f03);}if(_0x4af540['length']===0x0)return null;return _0x1e6098['element']=$el('div.prompt_widget_box',[..._0x4af540,$el('div.prompt_translate_info',[_0x40675b['AFETy']($el,'span',{'textContent':'','style':{'fontSize':'0.8em'}})])]),_0x1e6098['element']['setAttribute'](_0x40675b['dTWWD'],_0x27b525),_0x1e6098['element']['setAttribute']('data-input-id',_0x1a48d2),_0x1e6098['element'][_0x34b0b5(0x2a0)](_0x40675b['zVxbf'],_0x28fb21),_0x1e6098['element']['addEventListener'](_0x34b0b5(0x373),_0x336b0a=>{_0x336b0a['stopPropagation']();}),_0x1e6098['updatePosition']=function(){},_0x1e6098['text_element']&&(TranslateManager[_0x34b0b5(0x32d)](_0x28fb21),TranslateManager['recordHistory'](_0x28fb21,_0x1e6098['text_element']['value']||'')),TranslateManager['addInstance'](_0x28fb21,_0x1e6098),TranslateManager['updateButtonStates'](_0x28fb21),logger[_0x34b0b5(0x278)](_0x34b0b5(0x395)+_0x27b525+'\x20输入\x20'+_0x1a48d2+'\x20的翻译小部件实例'),_0x1e6098;}const PromptWidget={'name':EXTENSION_NAME,'nodes':{},'styleElement':null,'initialize'(){const _0x13e99e=_0xe95701,_0x11b896={'JwQJI':function(_0x15d1ef,_0x23cbca){return _0x15d1ef<=_0x23cbca;}};logger[_0x13e99e(0x349)](_0x13e99e(0x258)),this['styleElement']=addStylesheet(),TranslateManager[_0x13e99e(0x3e4)]();let _0x4c6a80=0x3c;try{const _0x56240a=app['ui']['settings'][_0x13e99e(0x2e1)]('PromptWidget.Cleanup.Interval');typeof _0x56240a==='number'&&_0x56240a>=0xa&&_0x11b896[_0x13e99e(0x1f0)](_0x56240a,0x78)&&(_0x4c6a80=_0x56240a);}catch(_0x5e902a){logger[_0x13e99e(0x2c4)](_0x13e99e(0x387));}this['startPeriodicCleanup'](_0x4c6a80*0x3e8);},'startPeriodicCleanup'(_0x2ebef6=0xea60){const _0x40fd44=_0xe95701,_0x29d9b9={'VvGXy':function(_0x4b7ca4,_0x29239c){return _0x4b7ca4(_0x29239c);}};if(!FEATURES['enabled'])return;const _0x413bb4=Math['max'](0x2710,Math[_0x40fd44(0x220)](0x1d4c0,_0x2ebef6));this['cleanupInterval']&&_0x29d9b9[_0x40fd44(0x2a1)](clearInterval,this[_0x40fd44(0x1d6)]),this['cleanupInterval']=setInterval(()=>{const _0x2190c4=_0x40fd44;if(!FEATURES['enabled']){this[_0x2190c4(0x23e)]();return;}TranslateManager['cleanupEmptyInstances']('timer');},_0x2ebef6),logger['log']('已启动定期清理，间隔\x20'+_0x2ebef6/0x3e8+'\x20秒');},'stopPeriodicCleanup'(){this['cleanupInterval']&&(clearInterval(this['cleanupInterval']),this['cleanupInterval']=null,logger['log']('已停止定期空实例清理'));},'checkAndSetupNode'(_0x554f2e){const _0x34a4a7=_0xe95701,_0x3365e6={'gHTGZ':function(_0xbeaf30,_0x10dac1){return _0xbeaf30===_0x10dac1;},'GUVfW':_0x34a4a7(0x2b6)};if(!_0x554f2e||!FEATURES['enabled'])return;if(!FEATURES['enabled']&&_0x554f2e['id']){this['hideNodeWidgets'](_0x554f2e),TranslateManager[_0x34a4a7(0x3a6)](_0x554f2e['id']);return;}const _0x301bc1=_0x554f2e['id'];if(_0x554f2e['flags']&&_0x554f2e['flags']['collapsed']){this[_0x34a4a7(0x233)](_0x554f2e);return;}logger['log'](_0x34a4a7(0x2a7)+_0x301bc1+',\x20类型:\x20'+_0x554f2e[_0x34a4a7(0x1e1)]);const _0x16f1f5=[];_0x554f2e[_0x34a4a7(0x2dd)]&&_0x554f2e['widgets']['forEach'](_0xeba4f8=>{const _0x1379db=_0x34a4a7;(_0x3365e6['gHTGZ'](_0xeba4f8[_0x1379db(0x351)],_0x1379db(0x2b6))||_0xeba4f8['type']===_0x3365e6['GUVfW']||_0xeba4f8['type']===_0x1379db(0x2b3)&&_0xeba4f8['options']&&_0xeba4f8['options']['multiline']||_0xeba4f8[_0x1379db(0x3d2)]===!![]||_0xeba4f8['inputEl']&&_0x3365e6['gHTGZ'](_0xeba4f8['inputEl'][_0x1379db(0x21d)],'TEXTAREA'))&&(_0xeba4f8[_0x1379db(0x404)]&&typeof _0xeba4f8[_0x1379db(0x404)]['value']==='string'&&_0x16f1f5['push'](_0xeba4f8));}),_0x16f1f5[_0x34a4a7(0x215)]>0x0&&(logger['log']('节点\x20'+_0x301bc1+'\x20包含\x20'+_0x16f1f5[_0x34a4a7(0x215)]+_0x34a4a7(0x287)),_0x16f1f5['forEach'](_0x479875=>{this['setupNodeWidget'](_0x554f2e,_0x479875);}));},'setupNodeWidget'(_0x27ccd0,_0x55b373){const _0x51b8d2=_0xe95701,_0x3796da={'ksOfe':'none','SrbMt':'999','TZBpn':'9999999','kABkL':'更新小部件位置时出错:','jlKvY':function(_0xe6a513,_0x40d5f7){return _0xe6a513(_0x40d5f7);},'aYwSu':'widget_hide','GCTox':_0x51b8d2(0x38a),'PcFZa':_0x51b8d2(0x24a),'vhtPc':'fixed','mkwqs':'auto','amUGW':function(_0x1f2c9e){return _0x1f2c9e();},'dBRpz':'transform','YifSf':'relative','oJRXU':_0x51b8d2(0x235),'OIVRq':_0x51b8d2(0x397),'XURkt':_0x51b8d2(0x1d5),'XLneH':'data-input-id'};if(!_0x27ccd0||!_0x55b373||!_0x55b373[_0x51b8d2(0x404)])return;const _0x3dfc72=_0x27ccd0['id'],_0x5627ca=_0x55b373['name']||_0x55b373['id']||Math['random']()['toString'](0x24)[_0x51b8d2(0x3dd)](0x2,0xa),_0x286149=_0x3dfc72+'_'+_0x5627ca;logger['log'](_0x51b8d2(0x2d0)+_0x3dfc72+'\x20的输入控件\x20'+_0x5627ca+'\x20设置翻译小部件');if(_0x55b373['inputEl']['readOnly']||_0x55b373['inputEl']['disabled']){logger[_0x51b8d2(0x278)]('跳过只读或禁用的输入控件');return;}const _0xbb43d0=TranslateManager[_0x51b8d2(0x2e9)](_0x286149);if(_0xbb43d0&&_0xbb43d0['text_element']===_0x55b373[_0x51b8d2(0x404)]){_0xbb43d0[_0x51b8d2(0x1e5)]&&(_0xbb43d0['isHiding']=![],_0xbb43d0[_0x51b8d2(0x31f)]&&(clearTimeout(_0xbb43d0['hideTimeout']),_0xbb43d0['hideTimeout']=null));if(_0xbb43d0['element']){if(window['getComputedStyle'](_0xbb43d0['element'])[_0x51b8d2(0x30f)]!==_0x51b8d2(0x331)&&_0xbb43d0[_0x51b8d2(0x2c5)]['classList'][_0x51b8d2(0x206)]('widget_show'))return;_0xbb43d0['element']['classList'][_0x51b8d2(0x2a4)](_0x3796da['aYwSu']),_0xbb43d0['element'][_0x51b8d2(0x35c)]['opacity']='0',_0xbb43d0['element']['style']['display']=_0x51b8d2(0x24f),void _0xbb43d0['element'][_0x51b8d2(0x356)],_0xbb43d0[_0x51b8d2(0x2c5)][_0x51b8d2(0x293)][_0x51b8d2(0x3bc)](_0x3796da['GCTox']);}return;}try{const _0x321c30=TranslateWidget(_0x27ccd0,_0x5627ca,null,_0x55b373);_0x321c30['nodeId']=_0x3dfc72,_0x321c30['inputId']=_0x5627ca,_0x321c30['widgetKey']=_0x286149;const _0x4b248e=app['ui'][_0x51b8d2(0x3db)][_0x51b8d2(0x2e1)](_0x3796da['PcFZa']),_0x4a1caa=_0x55b373['inputEl'][_0x51b8d2(0x318)];if(_0x4b248e||!_0x4a1caa||!_0x4a1caa['classList'][_0x51b8d2(0x206)](_0x51b8d2(0x2d5))){if(DEBUG)console['log'](_0x51b8d2(0x2b9));const _0x1cf085=document['createElement']('div');_0x1cf085['className']='prompt-widget-container',_0x1cf085['style']['position']=_0x3796da[_0x51b8d2(0x406)],_0x1cf085['style'][_0x51b8d2(0x3c3)]='999',_0x1cf085['style']['display']='flex',_0x1cf085[_0x51b8d2(0x35c)][_0x51b8d2(0x36a)]='flex-end',_0x1cf085['style']['pointerEvents']='none';if(_0x321c30[_0x51b8d2(0x2c5)]){_0x1cf085[_0x51b8d2(0x249)](_0x321c30['element']),document['body'][_0x51b8d2(0x249)](_0x1cf085),_0x321c30[_0x51b8d2(0x2c5)]['style'][_0x51b8d2(0x336)]=_0x3796da['mkwqs'],_0x321c30['element']['style'][_0x51b8d2(0x3c3)]=_0x3796da[_0x51b8d2(0x3bd)];const _0x59ecde=()=>{const _0x3faf1b=_0x51b8d2;if(!_0x321c30['element']||!_0x55b373[_0x3faf1b(0x404)]||!_0x1cf085)return;try{const _0x375147=_0x55b373[_0x3faf1b(0x404)]['getBoundingClientRect']();Object[_0x3faf1b(0x248)](_0x1cf085['style'],{'left':_0x375147['left']-0xc+'px','top':_0x375147[_0x3faf1b(0x3fc)]-0x22+'px','width':_0x375147['width']+'px','height':_0x3faf1b(0x397),'pointerEvents':_0x3796da[_0x3faf1b(0x2db)],'zIndex':_0x3796da[_0x3faf1b(0x3bd)]}),Object[_0x3faf1b(0x248)](_0x321c30['element']['style'],{'transformOrigin':'right\x20center','margin':'0','pointerEvents':_0x3faf1b(0x20a),'zIndex':_0x3796da[_0x3faf1b(0x27b)]});}catch(_0x1ef277){console[_0x3faf1b(0x20f)](_0x3796da['kABkL'],_0x1ef277);}};_0x3796da[_0x51b8d2(0x26d)](_0x59ecde),window[_0x51b8d2(0x3ca)]('resize',_0x59ecde);const _0x378755=new MutationObserver(()=>{const _0x1730d7=_0x51b8d2;_0x3796da[_0x1730d7(0x265)](requestAnimationFrame,_0x59ecde);});_0x378755['observe'](app[_0x51b8d2(0x35b)]['canvas'][_0x51b8d2(0x318)],{'attributes':!![],'attributeFilter':['style',_0x3796da['dBRpz']]});const _0x1afa9e=app[_0x51b8d2(0x35b)]['onDrawBackground'];app[_0x51b8d2(0x35b)][_0x51b8d2(0x3b3)]=function(){const _0x2248a3=_0x51b8d2,_0x450911=_0x1afa9e?.[_0x2248a3(0x3ea)](this,arguments);return requestAnimationFrame(_0x59ecde),_0x450911;};const _0x274ba0=_0x27ccd0['onNodeMoved'];_0x27ccd0['onNodeMoved']=function(){const _0x17fcfb=_0x51b8d2,_0x528aa6=_0x274ba0?.[_0x17fcfb(0x3ea)](this,arguments);return requestAnimationFrame(_0x59ecde),_0x528aa6;},_0x321c30['updatePosition']=_0x59ecde,_0x321c30['cleanup']=()=>{const _0x5a0a7b=_0x51b8d2,_0x3e5f4e='2|4|3|0|1'[_0x5a0a7b(0x38e)]('|');let _0x4779c2=0x0;while(!![]){switch(_0x3e5f4e[_0x4779c2++]){case'0':_0x274ba0&&(_0x27ccd0[_0x5a0a7b(0x36d)]=_0x274ba0);continue;case'1':_0x1cf085&&document[_0x5a0a7b(0x208)][_0x5a0a7b(0x206)](_0x1cf085)&&document['body']['removeChild'](_0x1cf085);continue;case'2':window[_0x5a0a7b(0x305)](_0x5a0a7b(0x211),_0x59ecde);continue;case'3':_0x1afa9e&&(app[_0x5a0a7b(0x35b)]['onDrawBackground']=_0x1afa9e);continue;case'4':_0x378755['disconnect']();continue;}break;}};}}else{if(DEBUG)console['log'](_0x51b8d2(0x2d3));if(_0x321c30['element']&&_0x55b373[_0x51b8d2(0x404)][_0x51b8d2(0x318)]){let _0x1d96c9=_0x55b373['inputEl']['parentElement'];window['getComputedStyle'](_0x1d96c9)['position']==='static'&&(_0x1d96c9['style']['position']=_0x3796da['YifSf']),_0x1d96c9['classList'][_0x51b8d2(0x3bc)](_0x3796da['oJRXU']),Object['assign'](_0x321c30['element']['style'],{'right':'12px','bottom':_0x51b8d2(0x315),'height':_0x3796da[_0x51b8d2(0x221)],'width':'auto','opacity':'0'}),_0x1d96c9[_0x51b8d2(0x249)](_0x321c30['element']),void _0x321c30['element']['offsetWidth'],_0x321c30['element'][_0x51b8d2(0x293)][_0x51b8d2(0x3bc)](_0x51b8d2(0x38a));}}_0x321c30['element']&&(_0x321c30['element'][_0x51b8d2(0x2a0)](_0x3796da[_0x51b8d2(0x402)],_0x3dfc72),_0x321c30[_0x51b8d2(0x2c5)][_0x51b8d2(0x2a0)](_0x3796da['XLneH'],_0x5627ca),_0x321c30[_0x51b8d2(0x2c5)][_0x51b8d2(0x2a0)](_0x51b8d2(0x313),_0x286149)),TranslateManager['instances']['set'](_0x286149,_0x321c30),logger['log'](_0x51b8d2(0x1db)+_0x3dfc72+'\x20创建翻译小部件');}catch(_0x3e9883){logger['error']('为节点\x20'+_0x3dfc72+'\x20创建翻译小部件失败:',_0x3e9883);}},'hideNodeWidgets'(_0x19e06){const _0xbbecbe=_0xe95701,_0x4f926f={'EkDZy':function(_0x5aeacc,_0x98b5ad){return _0x5aeacc(_0x98b5ad);},'UMMkP':'data-node-id','dknYP':'none','MPWDF':'widget_hide','KKiCO':function(_0x53b339,_0x45484a){return _0x53b339!==_0x45484a;}};if(!_0x19e06)return;try{const _0x35151c=String(_0x19e06['id']),_0x2a8221=[];TranslateManager[_0xbbecbe(0x3a8)][_0xbbecbe(0x1df)]((_0x2b4789,_0xe1b6dc)=>{const _0x41fe20=_0xbbecbe;try{const _0x3dca30=_0x4f926f['EkDZy'](String,_0xe1b6dc);if(_0x2b4789['nodeId']===_0x35151c){_0x2a8221[_0x41fe20(0x3cb)](_0x2b4789);return;}if(_0x3dca30['startsWith'](_0x35151c+'_')){_0x2a8221['push'](_0x2b4789);return;}if(_0x3dca30===_0x35151c){_0x2a8221[_0x41fe20(0x3cb)](_0x2b4789);return;}_0x2b4789['element']&&_0x2b4789['element']['getAttribute'](_0x4f926f[_0x41fe20(0x1e2)])===_0x35151c&&_0x2a8221[_0x41fe20(0x3cb)](_0x2b4789);}catch(_0x9cb922){}}),logger['log']('找到节点\x20'+_0x35151c+_0xbbecbe(0x3a9)+_0x2a8221['length']+'\x20个小部件需要隐藏'),_0x2a8221['forEach'](_0x1979c6=>{const _0x438d55=_0xbbecbe;if(!_0x1979c6||!_0x1979c6['element'])return;try{const _0x5e0fe2=_0x4f926f['KKiCO'](window['getComputedStyle'](_0x1979c6[_0x438d55(0x2c5)])[_0x438d55(0x30f)],_0x4f926f['dknYP']);if(_0x5e0fe2){if(_0x1979c6['isHiding'])return;_0x1979c6['isHiding']=!![],_0x1979c6['element']['classList'][_0x438d55(0x2a4)](_0x438d55(0x38a)),_0x1979c6[_0x438d55(0x2c5)]['style'][_0x438d55(0x30f)]=_0x438d55(0x24f),_0x1979c6[_0x438d55(0x2c5)]['style']['opacity']='1',void _0x1979c6['element']['offsetWidth'],_0x1979c6['element'][_0x438d55(0x293)][_0x438d55(0x3bc)](_0x4f926f[_0x438d55(0x24c)]),_0x1979c6[_0x438d55(0x31f)]&&clearTimeout(_0x1979c6['hideTimeout']),_0x1979c6['hideTimeout']=setTimeout(()=>{const _0x4c7838=_0x438d55;_0x1979c6['element']&&(_0x1979c6['element'][_0x4c7838(0x35c)][_0x4c7838(0x30f)]=_0x4f926f[_0x4c7838(0x2f3)],_0x1979c6['element']['classList']['remove'](_0x4f926f[_0x4c7838(0x24c)]),_0x1979c6['isHiding']=![],_0x1979c6[_0x4c7838(0x31f)]=null);},0x15e);}else _0x1979c6['element']['style']['display']=_0x438d55(0x331),_0x1979c6['element'][_0x438d55(0x293)]['remove'](_0x438d55(0x38a),_0x438d55(0x23a)),_0x1979c6['isHiding']=![],_0x1979c6[_0x438d55(0x31f)]&&(clearTimeout(_0x1979c6[_0x438d55(0x31f)]),_0x1979c6['hideTimeout']=null);}catch(_0x37ce06){logger['error'](_0x438d55(0x3f7)+_0x35151c+'\x20的小部件时出错:',_0x37ce06);}});}catch(_0x5791a3){logger['error']('隐藏节点小部件过程出错:',_0x5791a3);}},'cleanup'(){const _0x204bd1=_0xe95701;logger['info']('卸载PromptWidget扩展'),this['stopPeriodicCleanup'](),TranslateManager['cleanup'](),this['styleElement']&&document[_0x204bd1(0x3d8)]['contains'](this['styleElement'])&&document[_0x204bd1(0x3d8)][_0x204bd1(0x38c)](this[_0x204bd1(0x1fc)]),logger['info']('PromptWidget扩展已完全卸载');},'showHistory'(_0x1a74ed){const _0x4862fe=_0xe95701,_0x2f4c12={'GhQVo':function(_0xf27cb9,_0x1e26b8){return _0xf27cb9===_0x1e26b8;}};if(!_0x1a74ed)return![];let _0x58ef62,_0x21ac56;_0x1a74ed['includes']('_')?[_0x58ef62,_0x21ac56]=_0x1a74ed['split']('_',0x2):(_0x58ef62=_0x1a74ed,_0x21ac56=_0x4862fe(0x312));TranslateManager[_0x4862fe(0x32d)](_0x1a74ed);const _0x25a8b0=TranslateManager['history'][_0x4862fe(0x2d7)](_0x1a74ed);if(!_0x25a8b0)return logger['warn']('找不到节点\x20'+_0x1a74ed+_0x4862fe(0x25f)),![];TranslateManager['closeHistoryPopup']();if(_0x2f4c12['GhQVo'](_0x25a8b0['past']['length'],0x0)&&!_0x25a8b0[_0x4862fe(0x2f8)])return logger['log']('节点\x20'+_0x1a74ed+'\x20没有历史记录'),![];return TranslateManager['createHistoryPopup'](_0x1a74ed,_0x25a8b0),!![];},'createHistoryPopup'(_0x3797d2,_0x5b9967){const _0x9b6c73=_0xe95701,_0x46fac9={'cUirR':_0x9b6c73(0x1f6),'hFqhO':function(_0xe71321,_0x52fb1b){return _0xe71321-_0x52fb1b;},'aSUis':_0x9b6c73(0x3fc)},_0x384ac4=document['querySelector'](_0x9b6c73(0x400)+_0x3797d2+'[title*=\x22历史\x22]');if(!_0x384ac4){logger['warn'](_0x9b6c73(0x1f4)+_0x3797d2+_0x9b6c73(0x1d2));return;}const _0x5e52b7=_0x384ac4[_0x9b6c73(0x403)]();let _0x27b446=_0x5e52b7['left'],_0x3bf17c=_0x5e52b7['bottom']+0x5;const _0x195535=document['createElement'](_0x46fac9[_0x9b6c73(0x2e4)]);_0x195535[_0x9b6c73(0x363)]=_0x9b6c73(0x299),_0x195535[_0x9b6c73(0x2b0)]['widgetKey']=_0x3797d2;const _0x3f6472=0x15e;_0x3bf17c+_0x3f6472>window['innerHeight']?(_0x3bf17c=_0x46fac9['hFqhO'](_0x5e52b7['top'],0x5),_0x195535[_0x9b6c73(0x35c)]['transformOrigin']=_0x46fac9['aSUis'],_0x195535['style']['top']='auto',_0x195535['style']['bottom']=window[_0x9b6c73(0x21c)]-_0x3bf17c+'px',_0x195535[_0x9b6c73(0x293)]['add'](_0x9b6c73(0x1ec))):(_0x195535['style'][_0x9b6c73(0x281)]='top',_0x195535['style']['top']=Math['max'](0xa,_0x3bf17c)+'px',_0x195535['style']['bottom']=_0x9b6c73(0x20a),_0x195535[_0x9b6c73(0x293)]['add'](_0x9b6c73(0x2b8)));_0x195535['style'][_0x9b6c73(0x378)]=Math['max'](0xa,_0x27b446)+'px';_0x5b9967['current']&&this['addHistoryItem'](_0x195535,_0x3797d2,_0x5b9967['current'],_0x9b6c73(0x2f8));if(_0x5b9967['past']['length']>0x0){if(_0x5b9967['current']){const _0x5d8d42=document['createElement'](_0x46fac9['cUirR']);_0x5d8d42['className']='prompt_history_separator',_0x195535[_0x9b6c73(0x249)](_0x5d8d42);}_0x5b9967['past'][_0x9b6c73(0x2e0)]()['reverse']()['forEach'](_0x4cee69=>{const _0x545de7=_0x9b6c73;this[_0x545de7(0x1c6)](_0x195535,_0x3797d2,_0x4cee69,'past');});}this[_0x9b6c73(0x329)](_0x195535),document['body']['appendChild'](_0x195535),this['activeHistoryPopup']=_0x195535;},'addHistoryItem'(_0x34121e,_0x4c813c,_0x4ce433,_0x13aaeb){const _0x186646=_0xe95701,_0x5006d4={'lIiMB':function(_0x514a19,_0x111416){return _0x514a19===_0x111416;},'KqVeZ':'click'},_0x449ae3=document['createElement']('div');_0x449ae3['className']='prompt_history_item\x20'+(_0x5006d4['lIiMB'](_0x13aaeb,'current')?_0x186646(0x2a9):'');const _0x31b6d2=document['createElement'](_0x186646(0x1f6));_0x31b6d2['className']='prompt_history_text',_0x31b6d2[_0x186646(0x1f7)]=_0x4ce433,_0x449ae3[_0x186646(0x249)](_0x31b6d2),_0x449ae3['addEventListener'](_0x5006d4[_0x186646(0x1e6)],()=>{const _0x3b700d=_0x186646;let _0x399833,_0x182802;_0x4c813c[_0x3b700d(0x2b4)]('_')?[_0x399833,_0x182802]=_0x4c813c['split']('_',0x2):(_0x399833=_0x4c813c,_0x182802='default');const _0x33fbdf=TranslateManager['getInstance'](_0x399833);if(!_0x33fbdf){logger['warn']('找不到节点\x20'+_0x399833+'\x20的实例');return;}TranslateManager[_0x3b700d(0x3ff)](_0x399833,_0x182802,_0x4ce433),TranslateManager['closeHistoryPopup']();}),_0x34121e['appendChild'](_0x449ae3);},'createHistoryPopupWithAllRecords'(_0x3a567e,_0x1f61ca,_0x5e6428){return TranslateManager['createHistoryPopupWithAllRecords'](_0x3a567e,_0x1f61ca,_0x5e6428);},'addOutsideClickHandler'(_0x1007f6){const _0x4b41ab=_0xe95701;_0x1007f6['addEventListener']('click',_0x21ef0f=>{_0x21ef0f['stopPropagation']();}),document[_0x4b41ab(0x3ca)]('click',_0xc8c40c=>{const _0x31dbfc=_0x4b41ab;!_0x1007f6['contains'](_0xc8c40c[_0x31dbfc(0x200)])&&TranslateManager['closeHistoryPopup']();},{'once':!![]});}};window[_0xe95701(0x22b)]={'manager':TranslateManager,'extension':PromptWidget,'throttle':THROTTLE},app['registerExtension']({'name':'Comfy.PromptWidget',async 'beforeRegisterNodeDef'(_0x8c7cbd,_0x4d33f3,app){const _0x4a300d=_0xe95701,_0x1ec82c={'OpNNP':'PromptWidget'};if(_0x4d33f3['name']===_0x1ec82c['OpNNP']){const _0x4c6d95=_0x8c7cbd['prototype']['onNodeCreated'];_0x8c7cbd[_0x4a300d(0x2c3)]['onNodeCreated']=function(){const _0x2b17bd=_0x4a300d,_0x21c0d5=_0x4c6d95?.['apply'](this,arguments),_0x54b8d5=document['createElement']('div');return _0x54b8d5['className']=_0x2b17bd(0x37d),this['statusEl']=_0x54b8d5,this[_0x2b17bd(0x277)]['appendChild'](_0x54b8d5),_0x21c0d5;};const _0x4ad0b8=_0x8c7cbd['prototype']['onExecuted'];_0x8c7cbd[_0x4a300d(0x2c3)]['onExecuted']=function(_0x19f779){const _0x5667a0=_0x4ad0b8?.['apply'](this,arguments);return _0x5667a0;};}},async 'nodeCreated'(_0xa113ef){const _0x45f573=_0xe95701,_0x421d49={'tpIXM':'loading','AbGDH':'translate','lMqMX':function(_0x2d7908,_0x3c981c){return _0x2d7908===_0x3c981c;},'ZrVsi':_0x45f573(0x2aa),'zQeXw':_0x45f573(0x32e)};if(_0xa113ef[_0x45f573(0x1e1)]!==_0x421d49['zQeXw'])return;api['addEventListener']('prompt_translate_update',({detail:_0xedf87e})=>{const _0x500531=_0x45f573;if(_0xedf87e['node_id']!==_0xa113ef['id'])return;const _0x154105=TranslateManager[_0x500531(0x2e9)](_0xa113ef['id']);if(!_0x154105||!_0x154105['text_element']){logger[_0x500531(0x2c4)]('无法找到节点\x20'+_0xa113ef['id']+_0x500531(0x322));return;}if(_0xedf87e['status']==='translating'){const _0x3a1e79=_0xedf87e['progress'];_0x3a1e79&&(TranslateManager[_0x500531(0x31d)](_0x154105['text_element'],_0x421d49['tpIXM'],_0x500531(0x22f)+_0x3a1e79['current']+'/'+_0x3a1e79['total']),THROTTLE&&(THROTTLE[_0x500531(0x294)][_0xa113ef['id']]=Date['now']()));}else{if(_0xedf87e[_0x500531(0x254)]==='success'){const _0x212278=_0xedf87e[_0x500531(0x324)]||_0x421d49['AbGDH'],_0x33b43a=_0xedf87e['from_cache']||![];if(_0x421d49['lMqMX'](_0x212278,'restore'))TranslateManager[_0x500531(0x31d)](_0x154105['text_element'],'restore',_0xedf87e[_0x500531(0x32c)]||'已恢复');else{const _0x3acf72=_0x33b43a?_0x500531(0x232):'',_0x52aa88=_0xedf87e['translate_direction']?_0xedf87e['translate_direction']+'完成'+_0x3acf72:_0x33b43a?'使用缓存翻译':'翻译完成';TranslateManager[_0x500531(0x31d)](_0x154105['text_element'],_0x421d49['ZrVsi'],_0x52aa88);}}else _0xedf87e[_0x500531(0x254)]==='error'&&TranslateManager['showStatusTip'](_0x154105['text_element'],'error','错误:\x20'+_0xedf87e['message']);}});}});!app['extensions'][_0xe95701(0x1eb)](_0x5e1b7a=>_0x5e1b7a['name']===EXTENSION_NAME)&&app[_0xe95701(0x2a5)]({'name':EXTENSION_NAME,'nodes':PromptWidget['nodes'],async 'setup'(){const _0x4af800=_0xe95701,_0x23b058={'cyuLV':function(_0x597395,_0x43161c,_0x134071){return _0x597395(_0x43161c,_0x134071);},'jjJGD':_0x4af800(0x246)};PromptWidget['initialize']();const _0x54659f=app[_0x4af800(0x35b)]['onNodeSelectionChange'];app['canvas']['onNodeSelectionChange']=function(_0x4dd7c8,_0x57f8b9){const _0x186e0d=_0x4af800;if(!FEATURES[_0x186e0d(0x3c7)]){_0x54659f&&_0x54659f['call'](app['canvas'],_0x4dd7c8,_0x57f8b9);return;}_0x54659f&&_0x54659f['call'](app['canvas'],_0x4dd7c8,_0x57f8b9),_0x57f8b9?PromptWidget[_0x186e0d(0x2ea)](_0x4dd7c8):(PromptWidget['hideNodeWidgets'](_0x4dd7c8),_0x4dd7c8&&_0x4dd7c8['id']&&_0x23b058['cyuLV'](setTimeout,()=>{const _0x56284e=_0x186e0d;FEATURES[_0x56284e(0x3c7)]&&TranslateManager[_0x56284e(0x257)](_0x4dd7c8['id'])&&(!app['canvas']['selected_nodes']||!app['canvas']['selected_nodes']['includes'](_0x4dd7c8))&&(logger[_0x56284e(0x278)](_0x56284e(0x377)+_0x4dd7c8['id']+'\x20取消选中且实例为空，执行清理'),TranslateManager['cleanup'](_0x4dd7c8['id']),logger[_0x56284e(0x349)](_0x56284e(0x372)+_0x4dd7c8['id']+_0x56284e(0x1f2)+TranslateManager['instances'][_0x56284e(0x275)]+_0x56284e(0x2fd)));},0x1f4));};const _0x478baa=_0x378eab=>{const _0x9078b4=_0x4af800;if(!FEATURES[_0x9078b4(0x3c7)])return;_0x378eab['target']&&_0x378eab['target']['tagName']&&!_0x378eab['target']['closest'](_0x23b058['jjJGD'])&&(app['graph']&&app[_0x9078b4(0x1d7)]['setDirtyCanvas'](!![],!![]));};document['addEventListener']('click',_0x478baa),this['_handleGlobalClick']=_0x478baa;const _0x31e401=app['graphToPrompt'];app[_0x4af800(0x33f)]=function(){const _0x42bccd=_0x4af800,_0x57c079=_0x31e401['apply'](this,arguments);if(_0x57c079&&_0x57c079['extra']&&_0x57c079['extra']['ds']){if(!_0x57c079[_0x42bccd(0x227)]['ds']['offset']||!Array['isArray'](_0x57c079[_0x42bccd(0x227)]['ds'][_0x42bccd(0x244)]))_0x57c079['extra']['ds']['offset']=[0x0,0x0];else{_0x57c079['extra']['ds'][_0x42bccd(0x244)]=_0x57c079['extra']['ds']['offset']['map'](_0x23f4c9=>typeof _0x23f4c9==='number'&&!isNaN(_0x23f4c9)?_0x23f4c9:0x0);while(_0x57c079['extra']['ds']['offset'][_0x42bccd(0x215)]<0x2){_0x57c079['extra']['ds']['offset']['push'](0x0);}_0x57c079['extra']['ds']['offset']['length']>0x2&&(_0x57c079[_0x42bccd(0x227)]['ds']['offset']=_0x57c079[_0x42bccd(0x227)]['ds']['offset']['slice'](0x0,0x2));}}return _0x57c079;};},async 'beforeRegisterNodeDef'(_0x356b85,_0x5c9089){const _0x5cfef2=_0xe95701,_0x478484={'soLRc':'执行原始onRemoved方法时出错:'},_0x5f1e5c=_0x356b85[_0x5cfef2(0x2c3)]['onNodeCreated'],_0x5a5e09=_0x356b85[_0x5cfef2(0x2c3)]['onRemoved'],_0x283b18=_0x356b85['prototype']['onConfigure'],_0x4c0693=_0x356b85['prototype']['onDrawForeground'],_0x1cd014=this;_0x356b85['prototype']['onNodeCreated']=function(){const _0x596eb7=this['id'],_0x636e01=_0x5f1e5c?.['apply'](this,arguments);return _0x1cd014['nodes'][_0x596eb7]=this,_0x636e01;},_0x356b85['prototype']['onRemoved']=function(){const _0x5536bf=_0x5cfef2;let _0x451e22=null;try{_0x451e22=this?.['id']||this?.[_0x5536bf(0x2ca)]?.['id']||null,_0x451e22&&logger['log']('节点删除:\x20'+_0x451e22);}catch(_0x197ce1){logger['error']('获取节点ID时出错:',_0x197ce1);}let _0xf689d;try{_0xf689d=_0x5a5e09?.[_0x5536bf(0x3ea)](this,arguments);}catch(_0xbf7b38){logger['error'](_0x478484[_0x5536bf(0x295)],_0xbf7b38);}try{TranslateManager['cleanupEmptyInstances']('nodeDelete');}catch(_0xc88cd9){logger[_0x5536bf(0x20f)]('节点删除清理过程出错:',_0xc88cd9);}return _0xf689d;},_0x356b85['prototype']['onConfigure']=function(){const _0x230af2=_0x5cfef2,_0x34b04a=this['id'],_0xd404e9=_0x283b18?.['apply'](this,arguments);return _0x1cd014[_0x230af2(0x384)][_0x34b04a]=this,_0xd404e9;},_0x356b85[_0x5cfef2(0x2c3)]['onDrawForeground']=function(_0x28c197){const _0x42ac9d=_0x5cfef2;try{_0x4c0693?.['apply'](this,arguments);const _0x248dae=app['canvas']['selected_nodes']&&app['canvas']['selected_nodes'][this['id']];_0x248dae?PromptWidget['checkAndSetupNode'](this):PromptWidget['hideNodeWidgets'](this);}catch(_0x5e4f80){logger['error']('节点\x20'+this['id']+_0x42ac9d(0x352),_0x5e4f80);}};},async 'beforeExtensionUnload'(){const _0x1d703c=_0xe95701,_0x4fcb1a={'KpAVT':_0x1d703c(0x246),'CJEaE':_0x1d703c(0x337),'AYDYV':_0x1d703c(0x2cd),'ENKgg':'扩展卸载前清理时出错:'};try{app['canvas']&&app['canvas']['onNodeSelectionChange']&&(app[_0x1d703c(0x35b)][_0x1d703c(0x20b)]=app[_0x1d703c(0x35b)]['_onNodeSelectionChange']||null);orphanWidgetChecker&&orphanWidgetChecker['stop']();PromptWidget['stopPeriodicCleanup']();const _0x165a1e=[_0x4fcb1a[_0x1d703c(0x3f6)],_0x1d703c(0x2c8),'.widget_icon_button',_0x4fcb1a['CJEaE']],_0x24bf72=DOMUtils['removeElementsBySelectors'](_0x165a1e);logger['log']('扩展卸载时移除了\x20'+_0x24bf72+'\x20个DOM元素'),TranslateManager[_0x1d703c(0x3a6)](),PromptWidget['styleElement']&&document[_0x1d703c(0x3d8)]['contains'](PromptWidget['styleElement'])&&document['head']['removeChild'](PromptWidget['styleElement']),logger['info'](_0x4fcb1a[_0x1d703c(0x3e2)]);}catch(_0x48ce72){logger['error'](_0x4fcb1a['ENKgg'],_0x48ce72);}},'settings':[{'id':'PromptWidget.Features.Enabled','name':'\x20小部件总开关','category':['✨提示词小部件','\x20功能开关',_0xe95701(0x30d)],'type':'boolean','defaultValue':!![],'tooltip':'关闭后将完全禁用小部件功能','onChange':_0x1af5c6=>{const _0xdc7cfe=_0xe95701,_0x115bdb={'RPRFT':_0xdc7cfe(0x247)};FEATURES['enabled']=_0x1af5c6;if(!_0x1af5c6)PromptWidget['stopPeriodicCleanup'](),TranslateManager[_0xdc7cfe(0x3a6)](),app[_0xdc7cfe(0x35b)]&&(app['canvas']['_originalNodeSelectionChange']=app['canvas'][_0xdc7cfe(0x2fe)],app['canvas']['_onNodeSelectionChange']=function(){}),logger[_0xdc7cfe(0x278)]('小部件功能已完全禁用，停止所有相关服务');else{if(FEATURES['areAllFeaturesDisabled']()){app['ui'][_0xdc7cfe(0x3db)]['setSettingValue'](_0x115bdb['RPRFT'],![]),logger['log'](_0xdc7cfe(0x22e));return;}app['canvas']&&(app['canvas'][_0xdc7cfe(0x239)]&&(app['canvas']['_onNodeSelectionChange']=app['canvas']['_originalNodeSelectionChange'],delete app['canvas']['_originalNodeSelectionChange'])),PromptWidget['startPeriodicCleanup'](),app['graph']&&app['graph']['nodes']&&app['graph'][_0xdc7cfe(0x384)]['forEach'](_0x10c340=>{PromptWidget['checkAndSetupNode'](_0x10c340);}),logger['log'](_0xdc7cfe(0x256));}}},{'id':_0xe95701(0x1ef),'name':_0xe95701(0x30e),'category':['✨提示词小部件',_0xe95701(0x34e),'历史功能'],'type':'boolean','defaultValue':!![],'tooltip':_0xe95701(0x29b),'onChange':_0x4ee75c=>{const _0xd4e7e2=_0xe95701,_0x1ba0c8={'FUnlZ':'history','ITGqW':_0xd4e7e2(0x3bb),'calWZ':_0xd4e7e2(0x3b7)};FEATURES['history']=_0x4ee75c,TranslateManager['instances'][_0xd4e7e2(0x1df)](_0x282727=>{const _0x5e4354=_0xd4e7e2;if(_0x282727['buttons']){[_0x1ba0c8['FUnlZ'],_0x1ba0c8[_0x5e4354(0x284)],'redo'][_0x5e4354(0x1df)](_0x1345fd=>{const _0x4c5dd7=_0x5e4354,_0x413fc1=_0x282727['buttons'][_0x1345fd];_0x413fc1&&(_0x413fc1[_0x4c5dd7(0x35c)]['display']=_0x4ee75c?_0x4c5dd7(0x3b7):'none');});const _0x2ba647=_0x282727['element']?.['querySelector']('.widget_divider');_0x2ba647&&(_0x2ba647['style'][_0x5e4354(0x30f)]=_0x4ee75c?_0x1ba0c8['calWZ']:_0x5e4354(0x331));}}),FEATURES['updateEnabledState'](),logger[_0xd4e7e2(0x278)]('历史功能已'+(_0x4ee75c?'启用':'禁用'));}},{'id':'PromptWidget.Features.Preset','name':_0xe95701(0x355),'category':[_0xe95701(0x389),_0xe95701(0x34e),'预设功能'],'type':_0xe95701(0x39d),'defaultValue':!![],'tooltip':'控制提示词预设功能','onChange':_0x18c951=>{const _0x4e33f4=_0xe95701,_0x52f56d={'PGHVP':'block'};FEATURES['preset']=_0x18c951,TranslateManager[_0x4e33f4(0x3a8)][_0x4e33f4(0x1df)](_0x27412e=>{const _0x3e107c=_0x4e33f4;_0x27412e['buttons']?.['preset']&&(_0x27412e['buttons']['preset']['style']['display']=_0x18c951?_0x52f56d[_0x3e107c(0x39b)]:'none');}),FEATURES[_0x4e33f4(0x28a)](),logger[_0x4e33f4(0x278)]('预设功能已'+(_0x18c951?'启用':'禁用'));}},{'id':'PromptWidget.Features.Expand','name':_0xe95701(0x354),'category':[_0xe95701(0x389),_0xe95701(0x34e),'扩写功能'],'type':'boolean','defaultValue':!![],'tooltip':'控制文本扩写功能','onChange':_0x3eb3e0=>{const _0x5c5444=_0xe95701;FEATURES['expand']=_0x3eb3e0,TranslateManager['instances']['forEach'](_0x44645e=>{_0x44645e['buttons']?.['expand']&&(_0x44645e['buttons']['expand']['style']['display']=_0x3eb3e0?'block':'none');}),FEATURES[_0x5c5444(0x28a)](),logger['log']('扩写功能已'+(_0x3eb3e0?'启用':'禁用'));}},{'id':'PromptWidget.Features.Translate','name':_0xe95701(0x309),'category':[_0xe95701(0x389),'\x20功能开关',_0xe95701(0x236)],'type':_0xe95701(0x39d),'defaultValue':!![],'tooltip':_0xe95701(0x269),'onChange':_0x355cdc=>{const _0x55bb7a=_0xe95701;FEATURES[_0x55bb7a(0x203)]=_0x355cdc,TranslateManager['instances']['forEach'](_0x2ab05f=>{const _0x33f15f=_0x55bb7a;_0x2ab05f['buttons']?.['translate']&&(_0x2ab05f['buttons']['translate']['style'][_0x33f15f(0x30f)]=_0x355cdc?'block':'none');}),FEATURES['updateEnabledState'](),logger['log']('翻译功能已'+(_0x355cdc?'启用':'禁用'));}},{'id':'PromptWidget.PresetManagement','name':_0xe95701(0x2f7),'category':['✨提示词小部件','\x20\x20预设管理'],'type':()=>{const _0x1c5c43=_0xe95701,_0x464c20={'KrddA':_0x1c5c43(0x399),'aNwFF':_0x1c5c43(0x2d4),'oczof':_0x1c5c43(0x2ce),'ltVzC':_0x1c5c43(0x297)},_0xe58da=document['createElement']('tr');_0xe58da['className']='promptwidget-settings-row';const _0x2b7d37=document['createElement']('td');_0x2b7d37[_0x1c5c43(0x363)]=_0x464c20['aNwFF'],_0xe58da['appendChild'](_0x2b7d37);const _0x2b7dd9=document['createElement']('td'),_0x50a7f6=document[_0x1c5c43(0x32a)](_0x464c20[_0x1c5c43(0x296)]);return _0x50a7f6['className']=_0x464c20['ltVzC'],_0x50a7f6[_0x1c5c43(0x1f7)]=_0x1c5c43(0x3d7),_0x50a7f6['onclick']=()=>{try{if(DEBUG)console['log']('点击了管理提示词预设按钮');showPresetManagerDialog();}catch(_0x39f797){console['error'](_0x464c20['KrddA'],_0x39f797),alert('打开预设管理器出错:\x20'+_0x39f797['message']);}},_0x2b7dd9['appendChild'](_0x50a7f6),_0xe58da['appendChild'](_0x2b7dd9),_0xe58da;}},{'id':'PromptWidget.APIConfig','name':'配置百度翻译和LLM\x20key','category':['✨提示词小部件',_0xe95701(0x2e5)],'type':()=>{const _0x3dd8c1=_0xe95701,_0x50a24f={'kKxED':function(_0xf0d37b,_0x4241a1){return _0xf0d37b(_0x4241a1);}},_0x24c79=document['createElement']('tr');_0x24c79['className']='promptwidget-settings-row';const _0x6d0c01=document['createElement']('td');_0x6d0c01['className']='comfy-menu-label',_0x24c79[_0x3dd8c1(0x249)](_0x6d0c01);const _0x4f24cb=document['createElement']('td'),_0x29d2e7=document['createElement']('button');return _0x29d2e7['className']='preset-manager-button',_0x29d2e7['textContent']='打开配置界面',_0x29d2e7['onclick']=()=>{const _0x3ff897=_0x3dd8c1;try{if(DEBUG)console['log']('点击了配置API按钮');showAPIConfigDialog();}catch(_0x41e581){console['error']('点击配置API按钮出错:',_0x41e581),_0x50a24f[_0x3ff897(0x3a5)](alert,'打开API配置器出错:\x20'+_0x41e581['message']);}},_0x4f24cb['appendChild'](_0x29d2e7),_0x24c79['appendChild'](_0x4f24cb),_0x24c79;}},{'id':_0xe95701(0x2d2),'name':'前端调试日志','category':['✨提示词小部件',_0xe95701(0x1c5),'前端'],'type':'hidden','defaultValue':![],'tooltip':_0xe95701(0x2e2),'onChange':_0x80c02f=>{const _0x169c66=_0xe95701,_0x50facf={'ZRYWm':function(_0x116d8f,_0x3c3ece){return _0x116d8f+_0x3c3ece;},'Bdxyi':_0x169c66(0x3fe)};DEBUG=_0x80c02f,logger['log'](_0x50facf['ZRYWm'](_0x50facf[_0x169c66(0x251)],_0x80c02f?'启用':'禁用'));}},{'id':'PromptWidget.Debug.Backend','name':'后端调试日志','category':['✨提示词小部件',_0xe95701(0x1c5),'后端'],'type':'boolean','defaultValue':![],'tooltip':_0xe95701(0x2e2),'onChange':async _0x43bc7b=>{const _0x3fbe20=_0xe95701,_0x1ced7a={'TdwBa':function(_0x3b6109,_0x78f7ad){return _0x3b6109+_0x78f7ad;}};try{const _0x41177f=await fetch('/prompt_widget/set_debug',{'method':'POST','headers':{'Content-Type':_0x3fbe20(0x3cd)},'body':JSON[_0x3fbe20(0x3f1)]({'debug':_0x43bc7b})});if(!_0x41177f['ok'])throw new Error(_0x3fbe20(0x230)+_0x41177f['status']);const _0x23775d=await _0x41177f['json']();if(_0x23775d['status']==='success')logger['log'](_0x1ced7a['TdwBa']('后端调试模式已',_0x43bc7b?'启用':'禁用'));else throw new Error(_0x23775d['message']||_0x3fbe20(0x25e));}catch(_0x3367a1){console['error'](_0x3fbe20(0x2be),_0x3367a1),app['ui']['settings']['setSettingValue']('PromptWidget.Debug.Backend',!_0x43bc7b);}}},{'id':_0xe95701(0x3dc),'name':'小部件清理间隔','category':['✨提示词小部件','调试选项','性能'],'type':_0xe95701(0x316),'defaultValue':0x3c,'min':0x1e,'max':0x78,'step':0x1,'tooltip':'设置自动清理小部件的时间间隔（秒），默认60秒。范围30-120秒','attrs':{'showButtons':!![],'maxFractionDigits':0x0},'onChange':_0x2f9f0=>{const _0x4b8b82=_0xe95701,_0x2b10c4=Math['max'](0xa,Math[_0x4b8b82(0x220)](0x78,_0x2f9f0));PromptWidget['cleanupInterval']&&clearInterval(PromptWidget['cleanupInterval']),PromptWidget['startPeriodicCleanup'](_0x2b10c4*0x3e8),logger['log'](_0x4b8b82(0x202)+_0x2b10c4+'\x20秒');}},{'id':_0xe95701(0x34d),'name':'\x20\x20','category':[_0xe95701(0x389),'\x20\x20✨提示词小部件\x20PromptWidget'],'type':()=>{const _0x2f0f4a=_0xe95701,_0x405e20={'tVtMr':'comfy-menu-content','mZPHL':'p-tag-container','LFXPQ':_0x2f0f4a(0x1f6),'hvWAp':'fit-content','hXgYS':'Version','VkbPz':_0x2f0f4a(0x331),'ivQzY':'img','pnCNz':'https://img.shields.io/badge/Github-Yawiii-blue?style=flat&logo=github&logoColor=black&labelColor=white&color=%2307A3D7','vhCLQ':'block','dLwEl':_0x2f0f4a(0x1fb),'XtAhP':'wrap','FAeaY':'span','rPShU':'#ddd','XfoAZ':'nowrap','DjNeV':'https://github.com/yawiii/comfyui_prompt_widget','dSoaj':_0x2f0f4a(0x28c),'rnnxI':'center','ftWxc':'https://img.shields.io/badge/b%E7%AB%99-FFFFFF?style=flat&logo=bilibili&logoColor=%2307A3D7','jvMJU':'20px','puOsm':'flex','hhEGi':'https://img.shields.io/badge/%E6%8A%96%E9%9F%B3-FFFFFF?style=flat&logo=TikTok&logoColor=%23161823'},_0xe286f2=document[_0x2f0f4a(0x32a)]('tr');_0xe286f2['className']='promptwidget-settings-row';const _0xa55abd=document['createElement']('td');_0xa55abd['className']=_0x2f0f4a(0x2d4),_0xe286f2['appendChild'](_0xa55abd);const _0x216179=document['createElement']('td');_0x216179['className']=_0x405e20[_0x2f0f4a(0x308)];const _0x395416=document[_0x2f0f4a(0x32a)]('div');_0x395416['className']=_0x405e20['mZPHL'],_0x395416['style']['display']='flex',_0x395416[_0x2f0f4a(0x35c)]['alignItems']='center',_0x395416['style'][_0x2f0f4a(0x263)]=_0x2f0f4a(0x24b),_0x395416[_0x2f0f4a(0x35c)]['flexWrap']='wrap';const _0x47d60f=document['createElement'](_0x405e20['LFXPQ']);_0x47d60f[_0x2f0f4a(0x35c)]['display']=_0x2f0f4a(0x24f),_0x47d60f['style'][_0x2f0f4a(0x3d0)]='center',_0x47d60f['style'][_0x2f0f4a(0x263)]='10px',_0x47d60f['style']['flexWrap']=_0x2f0f4a(0x205),_0x47d60f[_0x2f0f4a(0x35c)]['minWidth']=_0x405e20['hvWAp'];const _0xa2ed1a=document[_0x2f0f4a(0x32a)]('img');_0xa2ed1a['alt']=_0x405e20['hXgYS'],_0xa2ed1a['src']=_0x2f0f4a(0x307)+EXTENSION_VERSION+'-green?style=flat',_0xa2ed1a['style']['display']='block',_0xa2ed1a['style']['height']='20px';const _0x2c5524=document[_0x2f0f4a(0x32a)]('a');_0x2c5524['href']='https://github.com/yawiii/comfyui_prompt_widget',_0x2c5524[_0x2f0f4a(0x200)]='_blank',_0x2c5524[_0x2f0f4a(0x35c)]['textDecoration']=_0x405e20[_0x2f0f4a(0x3b6)],_0x2c5524['style']['display']='flex',_0x2c5524['style']['alignItems']=_0x2f0f4a(0x27e);const _0x3c4918=document['createElement'](_0x405e20['ivQzY']);_0x3c4918['alt']=_0x2f0f4a(0x2f4),_0x3c4918[_0x2f0f4a(0x238)]=_0x405e20['pnCNz'],_0x3c4918['style']['display']=_0x405e20['vhCLQ'],_0x3c4918['style']['height']='20px',_0x2c5524['appendChild'](_0x3c4918),_0x47d60f['appendChild'](_0xa2ed1a),_0x47d60f[_0x2f0f4a(0x249)](_0x2c5524);const _0x5d90f8=document['createElement'](_0x405e20['LFXPQ']);_0x5d90f8[_0x2f0f4a(0x35c)][_0x2f0f4a(0x343)]='2px',_0x5d90f8['style']['height']='20px',_0x5d90f8['style']['backgroundColor']=_0x405e20['dLwEl'],_0x5d90f8['style']['margin']=_0x2f0f4a(0x31c),_0x5d90f8['style'][_0x2f0f4a(0x276)]='0';const _0x1b0283=document[_0x2f0f4a(0x32a)](_0x2f0f4a(0x1f6));_0x1b0283[_0x2f0f4a(0x35c)]['display']='flex',_0x1b0283[_0x2f0f4a(0x35c)][_0x2f0f4a(0x3d0)]='center',_0x1b0283['style'][_0x2f0f4a(0x263)]='10px',_0x1b0283['style'][_0x2f0f4a(0x32f)]=_0x405e20['XtAhP'],_0x1b0283['style'][_0x2f0f4a(0x3b8)]='fit-content';const _0x435079=document['createElement'](_0x405e20['FAeaY']);_0x435079['textContent']='使用教程：',_0x435079['style'][_0x2f0f4a(0x3c8)]=_0x405e20[_0x2f0f4a(0x2a6)],_0x435079['style'][_0x2f0f4a(0x1ee)]=_0x2f0f4a(0x364),_0x435079['style'][_0x2f0f4a(0x2f2)]=_0x405e20[_0x2f0f4a(0x27c)];const _0x23ddea=document['createElement']('a');_0x23ddea['href']=_0x405e20['DjNeV'],_0x23ddea['target']=_0x405e20['dSoaj'],_0x23ddea[_0x2f0f4a(0x35c)][_0x2f0f4a(0x3a2)]='none',_0x23ddea['style']['display']='flex',_0x23ddea['style']['alignItems']=_0x405e20[_0x2f0f4a(0x274)];const _0x285bcc=document[_0x2f0f4a(0x32a)](_0x2f0f4a(0x3ba));_0x285bcc[_0x2f0f4a(0x2c1)]='Bilibili',_0x285bcc[_0x2f0f4a(0x238)]=_0x405e20['ftWxc'],_0x285bcc['style']['display']='block',_0x285bcc[_0x2f0f4a(0x35c)][_0x2f0f4a(0x23f)]=_0x405e20['jvMJU'],_0x23ddea['appendChild'](_0x285bcc);const _0x1334b=document['createElement']('a');_0x1334b['href']=_0x405e20[_0x2f0f4a(0x39a)],_0x1334b[_0x2f0f4a(0x200)]='_blank',_0x1334b['style']['textDecoration']=_0x2f0f4a(0x331),_0x1334b['style']['display']=_0x405e20[_0x2f0f4a(0x31b)],_0x1334b['style'][_0x2f0f4a(0x3d0)]='center';const _0x3dbbe9=document['createElement'](_0x2f0f4a(0x3ba));return _0x3dbbe9['alt']=_0x2f0f4a(0x292),_0x3dbbe9[_0x2f0f4a(0x238)]=_0x405e20['hhEGi'],_0x3dbbe9[_0x2f0f4a(0x35c)]['display']=_0x405e20[_0x2f0f4a(0x2f6)],_0x3dbbe9['style'][_0x2f0f4a(0x23f)]=_0x405e20[_0x2f0f4a(0x2dc)],_0x1334b[_0x2f0f4a(0x249)](_0x3dbbe9),_0x1b0283[_0x2f0f4a(0x249)](_0x435079),_0x1b0283['appendChild'](_0x23ddea),_0x1b0283[_0x2f0f4a(0x249)](_0x1334b),_0x395416['appendChild'](_0x47d60f),_0x395416[_0x2f0f4a(0x249)](_0x5d90f8),_0x395416[_0x2f0f4a(0x249)](_0x1b0283),_0x216179['appendChild'](_0x395416),_0xe286f2['appendChild'](_0x216179),_0xe286f2;}},{'id':_0xe95701(0x24a),'name':'开启兼容模式','category':['✨提示词小部件',_0xe95701(0x1c5),'兼容性'],'type':_0xe95701(0x39d),'defaultValue':![],'tooltip':'当出现小部件不能显示在输入框时，请打开此选项（需要重启comfyUI）','onChange':_0x46bde5=>{logger['log']('兼容模式已'+(_0x46bde5?'启用':'禁用'));}}]});async function showPresetManagerDialog(){const _0x46eb66=_0xe95701,_0x514433={'NYAkc':_0x46eb66(0x1f6),'BwuGk':_0x46eb66(0x340),'Cgwta':_0x46eb66(0x2ce),'Yjsdg':'preset-close-button','TwzIs':'prompt-preset-title','mdWNe':_0x46eb66(0x3c2),'BaHON':'none','NRKrC':'table','JYmCd':'preset-manager-footer','DTjtr':function(_0xed5423,_0x42d2a5,_0x2d1370){return _0xed5423(_0x42d2a5,_0x2d1370);},'eRPuW':_0x46eb66(0x23b),'KMBpm':'预设数据加载失败:'};try{if(DEBUG)console['log'](_0x46eb66(0x359));hasChanges=![];const _0x14415b=document['createElement'](_0x46eb66(0x1f6));_0x14415b[_0x46eb66(0x363)]=_0x46eb66(0x24e),document['body']['appendChild'](_0x14415b);const _0x2564b1=document[_0x46eb66(0x32a)](_0x514433['NYAkc']);_0x2564b1['className']='prompt-preset-manager-dialog';const _0x495c6a=document['createElement'](_0x46eb66(0x1f6));_0x495c6a[_0x46eb66(0x363)]=_0x514433['BwuGk'];const _0xeaca41=document['createElement'](_0x514433[_0x46eb66(0x298)]);_0xeaca41['className']=_0x514433[_0x46eb66(0x3c0)],_0xeaca41['innerHTML']='&#215;',_0xeaca41['onclick']=()=>handleClose(_0x2564b1,_0x14415b),_0x495c6a['appendChild'](_0xeaca41);const _0x2e31b7=document[_0x46eb66(0x32a)]('h2');_0x2e31b7['className']=_0x514433['TwzIs'],_0x2e31b7['textContent']='提示词预设管理',_0x495c6a[_0x46eb66(0x249)](_0x2e31b7);const _0x83558b=document['createElement']('p');_0x83558b['textContent']=_0x514433['mdWNe'],_0x83558b['style']['marginBottom']='20px',_0x83558b[_0x46eb66(0x35c)]['color']='#aaa',_0x495c6a['appendChild'](_0x83558b);const _0x51e86f=document['createElement']('div');_0x51e86f['className']=_0x46eb66(0x31a),_0x51e86f[_0x46eb66(0x1f7)]=_0x46eb66(0x217),_0x495c6a[_0x46eb66(0x249)](_0x51e86f);const _0x4f7cf4=document['createElement']('div');_0x4f7cf4['className']='preset-table-container',_0x4f7cf4['style'][_0x46eb66(0x30f)]=_0x514433['BaHON'];const _0x89bea4=document[_0x46eb66(0x32a)](_0x514433[_0x46eb66(0x2ac)]);_0x89bea4['className']='preset-table';const _0x290ff3=document[_0x46eb66(0x32a)]('thead'),_0x3f2a68=document['createElement']('tr');['颜色','类型','内容','说明','操作']['forEach'](_0x30089b=>{const _0x1f3a4e=document['createElement']('th');_0x1f3a4e['textContent']=_0x30089b,_0x3f2a68['appendChild'](_0x1f3a4e);}),_0x290ff3['appendChild'](_0x3f2a68),_0x89bea4['appendChild'](_0x290ff3);const _0xdaec67=document['createElement']('tbody');_0x89bea4[_0x46eb66(0x249)](_0xdaec67),_0x4f7cf4['appendChild'](_0x89bea4),_0x495c6a['appendChild'](_0x4f7cf4);const _0x53b8c1=document['createElement']('div');_0x53b8c1[_0x46eb66(0x363)]=_0x514433[_0x46eb66(0x380)];const _0x2d87f0=document[_0x46eb66(0x32a)]('button');_0x2d87f0['className']='preset-save-button',_0x2d87f0['textContent']='保存',_0x2d87f0['onclick']=()=>handleSave(_0x2564b1,_0x14415b,_0xdaec67),_0x53b8c1['appendChild'](_0x2d87f0),_0x495c6a[_0x46eb66(0x249)](_0x53b8c1),_0x2564b1['appendChild'](_0x495c6a),document[_0x46eb66(0x208)]['appendChild'](_0x2564b1),_0x2564b1[_0x46eb66(0x3ca)]('click',_0x318504=>{const _0xb5cfc6=_0x46eb66;_0x318504[_0xb5cfc6(0x200)]===_0x2564b1&&handleClose(_0x2564b1,_0x14415b);});try{const _0x24a9ff=await loadPresetData();await _0x514433['DTjtr'](displayPresetData,_0xdaec67,_0x24a9ff);const _0x54f34f=_0xdaec67['querySelectorAll']('input,\x20select');_0x54f34f['forEach'](_0xbab6f4=>{const _0x4db2a0=_0x46eb66;_0xbab6f4[_0x4db2a0(0x3ca)](_0x4db2a0(0x321),trackChanges);}),_0x51e86f['style']['display']='none',_0x4f7cf4['style'][_0x46eb66(0x30f)]='block';if(DEBUG)console['log']('预设数据加载完成');}catch(_0x223838){_0x51e86f[_0x46eb66(0x1f7)]='加载失败:\x20'+_0x223838['message'],_0x51e86f['style'][_0x46eb66(0x3c8)]=_0x514433[_0x46eb66(0x3ee)];if(DEBUG)console[_0x46eb66(0x20f)](_0x514433[_0x46eb66(0x3a0)],_0x223838);}}catch(_0x328d5b){console['error'](_0x46eb66(0x21f),_0x328d5b),showCustomDialog({'title':'错误','content':'创建预设管理对话框时出错:\x20'+_0x328d5b[_0x46eb66(0x314)],'confirmText':'确定','showCancel':![]});}}const PRESET_COLORS={'blue':{'name':'蓝色','color':_0xe95701(0x326)},'green':{'name':'绿色','color':'rgb(120,\x20255,\x20120)'},'red':{'name':'红色','color':'rgb(255,\x20120,\x20120)'},'orange':{'name':'橙色','color':'rgb(255,\x20200,\x20100)'},'cyan':{'name':'青色','color':'rgb(100,\x20220,\x20220)'},'purple':{'name':'紫色','color':'rgb(210,\x20150,\x20240)'},'yellow':{'name':'黄色','color':'rgb(255,\x20230,\x20150)'},'lightblue':{'name':'淡蓝','color':'rgb(160,\x20200,\x20255)'},'pink':{'name':'粉色','color':_0xe95701(0x2a2)},'lime':{'name':'青柠','color':_0xe95701(0x37e)},'coral':{'name':'珊瑚','color':'rgb(240,\x20140,\x20140)'},'indigo':{'name':'靛蓝','color':_0xe95701(0x366)}};async function loadPresetData(_0x1c56c0){const _0x268f37=_0xe95701,_0x403428={'tQDlE':'.preset-color-select','nfZMn':function(_0x5dd56f,_0x39fddc){return _0x5dd56f(_0x39fddc);}};try{if(_0x1c56c0){const _0x289d5c=[],_0x41b594=Array[_0x268f37(0x21a)](_0x1c56c0[_0x268f37(0x319)]('tr'))[_0x268f37(0x2e0)](0x0,-0x1);for(const _0x2b66de of _0x41b594){const _0x3f361d=_0x2b66de[_0x268f37(0x3aa)](_0x403428['tQDlE']),_0x454637=_0x2b66de['querySelector']('.preset-type-select'),_0x39532f=_0x2b66de['querySelector'](_0x268f37(0x393)),_0x5a9176=_0x2b66de['querySelector']('.preset-note-input');_0x39532f&&_0x39532f[_0x268f37(0x209)][_0x268f37(0x33e)]()&&_0x289d5c[_0x268f37(0x3cb)]({'color_type':_0x3f361d?_0x3f361d['value']:'default','type':_0x454637?_0x454637[_0x268f37(0x209)]:'未分类','content':_0x39532f[_0x268f37(0x209)]['trim'](),'note':_0x5a9176?_0x5a9176[_0x268f37(0x209)]['trim']():''});}return _0x289d5c;}const _0x5345cc=await _0x403428['nfZMn'](fetch,'/prompt_widget/presets');if(!_0x5345cc['ok'])throw new Error('Failed\x20to\x20load\x20presets:\x20'+_0x5345cc['status']+'\x20'+_0x5345cc[_0x268f37(0x1e7)]);const _0x9bfe21=await _0x5345cc['json']();return _0x9bfe21['presets']||[];}catch(_0x3aab9d){console[_0x268f37(0x20f)]('加载预设数据失败:',_0x3aab9d);throw _0x3aab9d;}}function movePreset(_0x21c75b,_0x45e2e1,_0x31c357,_0xa66e6a){const _0x1f804d=_0xe95701,_0x2944e7={'fMbHz':function(_0x23e7cd,_0x4a49b9){return _0x23e7cd<_0x4a49b9;},'KMOcc':'移动预设时出错:'};try{const _0x438285=_0x21c75b+_0x45e2e1;if(_0x438285<0x0||_0x438285>=_0xa66e6a['length'])return![];[_0xa66e6a[_0x21c75b],_0xa66e6a[_0x438285]]=[_0xa66e6a[_0x438285],_0xa66e6a[_0x21c75b]];const _0x4163c1=Array['from'](_0x31c357['getElementsByTagName']('tr'))['slice'](0x0,-0x1),_0x3544e4=_0x4163c1[_0x21c75b],_0x939888=_0x4163c1[_0x438285];if(!_0x3544e4||!_0x939888)return console[_0x1f804d(0x20f)]('找不到要交换的行:',_0x21c75b,_0x438285),![];return _0x2944e7[_0x1f804d(0x264)](_0x45e2e1,0x0)?_0x31c357[_0x1f804d(0x225)](_0x3544e4,_0x939888):_0x31c357[_0x1f804d(0x225)](_0x939888,_0x3544e4),_0x3544e4['dataset'][_0x1f804d(0x222)]=_0x438285,_0x939888['dataset']['index']=_0x21c75b,updatePresetRows(_0x31c357,_0xa66e6a),!![];}catch(_0x303055){return console['error'](_0x2944e7['KMOcc'],_0x303055),![];}}function updatePresetRows(_0x3b4b25,_0x4e1571){const _0x16e105=_0xe95701,_0x2c3f26={'pRmCQ':'.move-top-button','PAbxn':'widget_button_disabled','iyMMH':function(_0x3f88ca,_0x3e5420){return _0x3f88ca===_0x3e5420;}};try{const _0x5a67b2=Array['from'](_0x3b4b25[_0x16e105(0x319)]('tr'))['slice'](0x0,-0x1);_0x5a67b2[_0x16e105(0x1df)]((_0x79dfca,_0x4b57e8)=>{const _0x2ecd88=_0x16e105,_0x2a2798=_0x79dfca['querySelector'](_0x2c3f26['pRmCQ']);_0x2a2798&&(_0x2a2798[_0x2ecd88(0x266)]=_0x4b57e8===0x0,_0x2a2798['disabled']?_0x2a2798['classList']['add'](_0x2c3f26['PAbxn']):_0x2a2798['classList']['remove']('widget_button_disabled'));const _0xc9ad9c=_0x79dfca['querySelector']('.up-button');_0xc9ad9c&&(_0xc9ad9c['disabled']=_0x2c3f26[_0x2ecd88(0x1ce)](_0x4b57e8,0x0),_0xc9ad9c[_0x2ecd88(0x266)]?_0xc9ad9c['classList']['add']('widget_button_disabled'):_0xc9ad9c[_0x2ecd88(0x293)]['remove']('widget_button_disabled'));const _0xc16561=_0x79dfca['querySelector']('.down-button');_0xc16561&&(_0xc16561['disabled']=_0x4b57e8===_0x4e1571['length']-0x1,_0xc16561['disabled']?_0xc16561['classList']['add'](_0x2c3f26['PAbxn']):_0xc16561['classList'][_0x2ecd88(0x2a4)](_0x2ecd88(0x382))),_0x79dfca['dataset']['index']=_0x4b57e8,_0x2a2798&&(_0x2a2798['onclick']=()=>movePresetToTop(_0x4b57e8,_0x3b4b25,_0x4e1571)),_0xc9ad9c&&(_0xc9ad9c['onclick']=()=>movePreset(_0x4b57e8,-0x1,_0x3b4b25,_0x4e1571)),_0xc16561&&(_0xc16561['onclick']=()=>movePreset(_0x4b57e8,0x1,_0x3b4b25,_0x4e1571));});}catch(_0x537e0c){console[_0x16e105(0x20f)]('更新预设行状态时出错:',_0x537e0c);}}async function displayPresetData(_0x312714,_0x369aa7){const _0x4dbe15=_0xe95701,_0x12aa5d={'BNzep':'确认删除','xtJXu':_0x4dbe15(0x3fa),'fhdYt':'添加新类型...','IBajT':_0x4dbe15(0x3df),'hkgKD':'text','Aidmh':'preset-note-input','MXpMq':_0x4dbe15(0x374),'CxABt':'button','LoVIc':'widget_button_disabled','uZJFq':'preset-action-button\x20down-button','exaUT':'preset-action-button\x20delete-button','GsILd':function(_0x1b17db){return _0x1b17db();},'SVBrA':function(_0x2a0123,_0x4c75f8){return _0x2a0123===_0x4c75f8;},'ApUIP':'new','xzqdo':function(_0x488999,_0x1cdabb){return _0x488999(_0x1cdabb);}};try{_0x312714['innerHTML']='';if(!_0x369aa7||_0x369aa7[_0x4dbe15(0x215)]===0x0){const _0x1613ae=document['createElement']('tr'),_0x59951d=document['createElement']('td');_0x59951d['colSpan']=0x5,_0x59951d[_0x4dbe15(0x1f7)]='没有找到任何预设',_0x59951d[_0x4dbe15(0x35c)]['textAlign']='center',_0x1613ae['appendChild'](_0x59951d),_0x312714['appendChild'](_0x1613ae);return;}const _0x48a255=new Set();_0x369aa7[_0x4dbe15(0x1df)](_0x2a5a30=>{const _0x4b7268=_0x4dbe15;if(_0x2a5a30['type'])_0x48a255['add'](_0x2a5a30[_0x4b7268(0x1e1)]);});const _0x139d4b=Array[_0x4dbe15(0x21a)](_0x48a255);_0x369aa7[_0x4dbe15(0x1df)]((_0x4ff786,_0x11a76d)=>{const _0x4be71a=_0x4dbe15,_0x5299d4={'EiJCU':'option','AiZmK':function(_0x9416d0,_0x235f3c){return _0x9416d0===_0x235f3c;},'FYVum':_0x12aa5d['BNzep']},_0x47e949=document['createElement']('tr');_0x47e949['dataset']['index']=_0x11a76d;const _0x1d1cc9=document['createElement']('td');_0x1d1cc9['style']['width']='30px';const _0x5abfad=document['createElement'](_0x12aa5d['xtJXu']);_0x5abfad['className']='preset-color-select',_0x5abfad['style'][_0x4be71a(0x343)]=_0x4be71a(0x3c1),_0x5abfad['style'][_0x4be71a(0x23f)]='24px',_0x5abfad[_0x4be71a(0x353)]='选择类型颜色',Object['entries'](PRESET_COLORS)['forEach'](([_0x121627,_0x1b8c77])=>{const _0x2a62f3=_0x4be71a,_0x1260bf=document[_0x2a62f3(0x32a)](_0x2a62f3(0x1cf));_0x1260bf['value']=_0x121627,_0x1260bf['textContent']='●',_0x1260bf['style']['color']=_0x1b8c77['color'],_0x1260bf['title']=_0x1b8c77[_0x2a62f3(0x351)],_0x4ff786['color_type']===_0x121627&&(_0x1260bf['selected']=!![],_0x5abfad['style']['color']=_0x1b8c77[_0x2a62f3(0x3c8)]),_0x5abfad[_0x2a62f3(0x249)](_0x1260bf);});if(!_0x4ff786['color_type']){const _0x5afda8=Object[_0x4be71a(0x370)](PRESET_COLORS)[0x0];_0x5afda8&&(_0x4ff786['color_type']=_0x5afda8[0x0],_0x5abfad['style']['color']=_0x5afda8[0x1]['color'],_0x5abfad['value']=_0x5afda8[0x0]);}_0x5abfad[_0x4be71a(0x2b7)]=_0x2f23d1=>{const _0x15d0bf=_0x4be71a;_0x4ff786['color_type']=_0x2f23d1[_0x15d0bf(0x200)]['value'];const _0x4a3303=PRESET_COLORS[_0x2f23d1[_0x15d0bf(0x200)]['value']]?.['color'];_0x4a3303&&(_0x2f23d1['target'][_0x15d0bf(0x35c)]['color']=_0x4a3303);const _0x3a5182=_0x47e949['querySelector']('.preset-type-select');_0x3a5182&&(_0x3a5182['className']='preset-type-select\x20preset_type_'+_0x2f23d1['target'][_0x15d0bf(0x209)]);},_0x1d1cc9[_0x4be71a(0x249)](_0x5abfad),_0x47e949['appendChild'](_0x1d1cc9);const _0x22fe6b=document[_0x4be71a(0x32a)]('td'),_0x4092db=document['createElement'](_0x4be71a(0x3fa));_0x4092db[_0x4be71a(0x363)]='preset-type-select'+(_0x4ff786['color_type']?'\x20preset_type_'+_0x4ff786['color_type']:''),_0x139d4b[_0x4be71a(0x1df)](_0x59c1a3=>{const _0x519ded=_0x4be71a,_0x38c40d=document['createElement'](_0x5299d4[_0x519ded(0x34a)]);_0x38c40d['value']=_0x59c1a3,_0x38c40d['textContent']=_0x59c1a3,_0x5299d4[_0x519ded(0x2fb)](_0x59c1a3,_0x4ff786[_0x519ded(0x1e1)])&&(_0x38c40d['selected']=!![]),_0x4092db['appendChild'](_0x38c40d);});const _0x196d8c=document[_0x4be71a(0x32a)](_0x4be71a(0x1cf));_0x196d8c['value']=_0x4be71a(0x3a3),_0x196d8c['textContent']=_0x12aa5d['fhdYt'],_0x4092db['appendChild'](_0x196d8c),_0x4092db[_0x4be71a(0x2b7)]=_0x4718b5=>handleTypeChange(_0x4718b5['target'],_0x4ff786,_0x196d8c),_0x22fe6b[_0x4be71a(0x249)](_0x4092db),_0x47e949[_0x4be71a(0x249)](_0x22fe6b);const _0x4f45b1=document['createElement']('td'),_0x51752b=document[_0x4be71a(0x32a)](_0x12aa5d['IBajT']);_0x51752b['type']=_0x12aa5d['hkgKD'],_0x51752b['className']='preset-content-input',_0x51752b['value']=_0x4ff786['content'],_0x51752b[_0x4be71a(0x2b7)]=_0x29e551=>{const _0x642190=_0x4be71a;_0x4ff786['content']=_0x29e551[_0x642190(0x200)]['value'];},_0x4f45b1['appendChild'](_0x51752b),_0x47e949['appendChild'](_0x4f45b1);const _0x214326=document['createElement']('td'),_0x3a20f2=document[_0x4be71a(0x32a)](_0x12aa5d['IBajT']);_0x3a20f2[_0x4be71a(0x1e1)]='text',_0x3a20f2['className']=_0x12aa5d['Aidmh'],_0x3a20f2['value']=_0x4ff786['note']||'',_0x3a20f2['onchange']=_0x9e641c=>{_0x4ff786['note']=_0x9e641c['target']['value'];},_0x214326['appendChild'](_0x3a20f2),_0x47e949['appendChild'](_0x214326);const _0x2b2a4c=document['createElement']('td');_0x2b2a4c['className']=_0x12aa5d['MXpMq'];const _0x1a27f5=document['createElement']('button');_0x1a27f5['className']=_0x4be71a(0x3d3),_0x1a27f5['innerHTML']='',_0x1a27f5['title']='移至顶部',_0x1a27f5[_0x4be71a(0x2c7)]=()=>movePresetToTop(_0x11a76d,_0x312714,_0x369aa7),_0x1a27f5['disabled']=_0x11a76d===0x0;_0x1a27f5['disabled']&&_0x1a27f5['classList']['add']('widget_button_disabled');const _0x41b322=document['createElement'](_0x12aa5d['CxABt']);_0x41b322['className']='preset-action-button\x20up-button',_0x41b322[_0x4be71a(0x1c9)]='',_0x41b322[_0x4be71a(0x353)]='上移',_0x41b322[_0x4be71a(0x2c7)]=()=>movePreset(_0x11a76d,-0x1,_0x312714,_0x369aa7),_0x41b322['disabled']=_0x11a76d===0x0;_0x41b322[_0x4be71a(0x266)]&&_0x41b322['classList'][_0x4be71a(0x3bc)](_0x12aa5d[_0x4be71a(0x3e5)]);const _0x51382e=document[_0x4be71a(0x32a)]('button');_0x51382e[_0x4be71a(0x363)]=_0x12aa5d['uZJFq'],_0x51382e[_0x4be71a(0x1c9)]='',_0x51382e['title']='下移',_0x51382e['onclick']=()=>movePreset(_0x11a76d,0x1,_0x312714,_0x369aa7),_0x51382e['disabled']=_0x11a76d===_0x369aa7['length']-0x1;_0x51382e['disabled']&&_0x51382e['classList']['add']('widget_button_disabled');const _0x2a1c5c=document['createElement'](_0x12aa5d['CxABt']);_0x2a1c5c['className']=_0x12aa5d['exaUT'],_0x2a1c5c['innerHTML']='',_0x2a1c5c['title']='删除',_0x2a1c5c['onclick']=()=>{const _0x309df9=_0x4be71a;showCustomDialog({'title':_0x5299d4['FYVum'],'content':_0x309df9(0x2eb),'confirmText':'确定','cancelText':'取消','onConfirm':()=>{_0x369aa7['splice'](_0x11a76d,0x1),_0x312714['removeChild'](_0x47e949),updatePresetRows(_0x312714,_0x369aa7),trackChanges();}});};const _0x571d80=document['createElement'](_0x4be71a(0x1f6));_0x571d80['className']='preset-action-divider',_0x2b2a4c['appendChild'](_0x1a27f5),_0x2b2a4c['appendChild'](_0x41b322),_0x2b2a4c['appendChild'](_0x51382e),_0x2b2a4c['appendChild'](_0x571d80),_0x2b2a4c['appendChild'](_0x2a1c5c),_0x47e949[_0x4be71a(0x249)](_0x2b2a4c),_0x312714['appendChild'](_0x47e949);});const _0x3eb889=document['createElement']('tr');_0x3eb889[_0x4dbe15(0x363)]='preset-add-row';const _0x461f53=document['createElement']('td'),_0x213996=document['createElement'](_0x12aa5d['xtJXu']);_0x213996['className']='preset-color-select',_0x213996[_0x4dbe15(0x35c)]['width']=_0x4dbe15(0x3c1),_0x213996['style']['height']=_0x4dbe15(0x397);const _0xdad0f7=Object['entries'](PRESET_COLORS)[0x0];Object[_0x4dbe15(0x370)](PRESET_COLORS)['forEach'](([_0x2a1a6e,_0x2ac7ce])=>{const _0x1b2fbc=_0x4dbe15,_0x524ddd=document['createElement'](_0x1b2fbc(0x1cf));_0x524ddd[_0x1b2fbc(0x209)]=_0x2a1a6e,_0x524ddd['textContent']='●',_0x524ddd['style'][_0x1b2fbc(0x3c8)]=_0x2ac7ce['color'],_0x524ddd['title']=_0x2ac7ce['name'],_0x213996['appendChild'](_0x524ddd);});_0xdad0f7&&(_0x213996[_0x4dbe15(0x209)]=_0xdad0f7[0x0],_0x213996['style']['color']=_0xdad0f7[0x1][_0x4dbe15(0x3c8)]);_0x213996['onchange']=_0x3b286e=>{const _0x334cb8=_0x4dbe15,_0x5bc27e=PRESET_COLORS[_0x3b286e['target'][_0x334cb8(0x209)]]?.['color'];_0x5bc27e&&(_0x3b286e['target'][_0x334cb8(0x35c)][_0x334cb8(0x3c8)]=_0x5bc27e);},_0x461f53['appendChild'](_0x213996),_0x3eb889[_0x4dbe15(0x249)](_0x461f53);const _0x4157e5=document[_0x4dbe15(0x32a)]('td'),_0x2ba5c2=document[_0x4dbe15(0x32a)](_0x12aa5d['xtJXu']);_0x2ba5c2[_0x4dbe15(0x363)]='preset-type-select',_0x139d4b['forEach'](_0x4ad736=>{const _0xe23957=_0x4dbe15,_0x4f35ed=document[_0xe23957(0x32a)]('option');_0x4f35ed['value']=_0x4ad736,_0x4f35ed['textContent']=_0x4ad736,_0x2ba5c2['appendChild'](_0x4f35ed);});const _0x5b0909=document['createElement']('option');_0x5b0909['value']=_0x4dbe15(0x3a3),_0x5b0909['textContent']=_0x4dbe15(0x250),_0x2ba5c2['appendChild'](_0x5b0909),_0x4157e5['appendChild'](_0x2ba5c2),_0x3eb889[_0x4dbe15(0x249)](_0x4157e5);const _0x54d48c=document['createElement']('td'),_0x1667c9=document[_0x4dbe15(0x32a)]('input');_0x1667c9['type']=_0x4dbe15(0x2b6),_0x1667c9['className']='preset-content-input',_0x1667c9['placeholder']='输入预设内容',_0x54d48c['appendChild'](_0x1667c9),_0x3eb889['appendChild'](_0x54d48c);const _0x33924f=document[_0x4dbe15(0x32a)]('td'),_0x5653c8=document['createElement'](_0x12aa5d['IBajT']);_0x5653c8['type']=_0x12aa5d['hkgKD'],_0x5653c8['className']='preset-note-input',_0x5653c8['placeholder']='输入说明',_0x33924f[_0x4dbe15(0x249)](_0x5653c8),_0x3eb889['appendChild'](_0x33924f);const _0x3e0c08=document['createElement']('td'),_0x5eb1ad=document['createElement'](_0x12aa5d[_0x4dbe15(0x383)]);_0x5eb1ad['className']='preset-add-button',_0x5eb1ad[_0x4dbe15(0x1f7)]='添加',_0x5eb1ad['onclick']=()=>{const _0x19a767=_0x4dbe15,_0x2374e2=_0x2ba5c2[_0x19a767(0x209)],_0xf5969e=_0x1667c9[_0x19a767(0x209)]['trim'](),_0x4d246a=_0x5653c8[_0x19a767(0x209)]['trim']();if(!_0xf5969e){showCustomDialog({'title':'提示','content':'请输入预设内容','confirmText':'确定'});return;}if(_0x12aa5d['SVBrA'](_0x2374e2,_0x12aa5d['ApUIP']))_0x12aa5d['xzqdo'](showCustomDialog,{'title':'添加新类型','content':_0x19a767(0x376),'showInput':!![],'onConfirm':_0x54a555=>{if(_0x54a555){const _0x78b055={'type':_0x54a555,'content':_0xf5969e,'note':_0x4d246a,'color_type':_0x213996['value']};_0x369aa7['push'](_0x78b055),displayPresetData(_0x312714,_0x369aa7),_0x12aa5d['GsILd'](trackChanges);}}});else{const _0x27375b={'type':_0x2374e2,'content':_0xf5969e,'note':_0x4d246a,'color_type':_0x213996['value']};_0x369aa7['push'](_0x27375b),displayPresetData(_0x312714,_0x369aa7),trackChanges();}},_0x3e0c08['appendChild'](_0x5eb1ad),_0x3eb889['appendChild'](_0x3e0c08),_0x312714['appendChild'](_0x3eb889);}catch(_0x45b3cf){console['error']('显示预设数据时出错:',_0x45b3cf);throw _0x45b3cf;}}function showCustomDialog({title:_0x7648ff,content:_0x32bbd1,inputLabel:_0x3def81,defaultValue:defaultValue='',confirmText:confirmText='确定',cancelText:cancelText=null,onConfirm:_0x24910d,onCancel:_0x3d2fd8,showInput:showInput=![]}){const _0x188748=_0xe95701,_0xb513a2={'DZNOD':'div'},_0x1914f8=document['createElement']('div');_0x1914f8['className']='custom-dialog-overlay';const _0x4a1359=document['createElement'](_0xb513a2['DZNOD']);_0x4a1359[_0x188748(0x363)]=_0x188748(0x261);let _0x12c74c=null;_0x4a1359['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22custom-dialog-title\x22>'+_0x7648ff+_0x188748(0x3bf)+_0x32bbd1+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20'+(showInput?'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22custom-dialog-input-group\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x3def81?'<label>'+_0x3def81+'</label>':'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20class=\x22custom-dialog-input\x22\x20value=\x22'+defaultValue+_0x188748(0x21e):'')+_0x188748(0x35d)+(cancelText?'<button\x20class=\x22custom-dialog-button\x20secondary\x22>'+cancelText+'</button>':'')+_0x188748(0x2ff)+confirmText+'</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20';showInput&&(_0x12c74c=_0x4a1359[_0x188748(0x3aa)]('.custom-dialog-input'),_0x12c74c[_0x188748(0x29d)]());const _0x55db06=_0x4a1359[_0x188748(0x1d0)](_0x188748(0x2ce));return cancelText&&(_0x55db06[0x0]['onclick']=()=>{const _0x2c8554=_0x188748;document[_0x2c8554(0x208)]['removeChild'](_0x1914f8),_0x3d2fd8?.();}),_0x55db06[cancelText?0x1:0x0][_0x188748(0x2c7)]=()=>{const _0x43e4b4=_0x188748;document['body'][_0x43e4b4(0x38c)](_0x1914f8),_0x24910d?.(_0x12c74c?.['value']);},_0x1914f8['appendChild'](_0x4a1359),document[_0x188748(0x208)]['appendChild'](_0x1914f8),_0x1914f8;}function showSuccessToast(_0x48ca5b,_0x5144b3=0x7d0){const _0x2a6006=_0xe95701,_0xe2b17={'LWlzT':'toastSlideOut\x200.3s\x20ease-in-out\x20forwards'},_0x26b99c=document[_0x2a6006(0x32a)]('div');_0x26b99c['className']=_0x2a6006(0x1e8),_0x26b99c['textContent']=_0x48ca5b,document['body']['appendChild'](_0x26b99c),setTimeout(()=>{const _0x436697=_0x2a6006;_0x26b99c[_0x436697(0x35c)]['animation']=_0xe2b17['LWlzT'],setTimeout(()=>{const _0x4c9ecc=_0x436697;document['body'][_0x4c9ecc(0x206)](_0x26b99c)&&document['body']['removeChild'](_0x26b99c);},0x12c);},_0x5144b3);}function handleTypeChange(_0x2a82dc,_0xd2f1de,_0x3d13e2){const _0xab5a0c=_0xe95701,_0x38290b={'yexEs':'option','blpcg':function(_0x3eb82f,_0x4ff48b){return _0x3eb82f(_0x4ff48b);},'BbCBb':_0xab5a0c(0x391),'RVfbY':'请输入新的类型名称：'};if(_0x2a82dc['value']===_0xab5a0c(0x3a3))_0x38290b['blpcg'](showCustomDialog,{'title':_0x38290b[_0xab5a0c(0x38f)],'content':_0x38290b['RVfbY'],'showInput':!![],'inputLabel':'类型名称','confirmText':'确定','cancelText':'取消','onConfirm':_0x2a4897=>{const _0x526769=_0xab5a0c;if(_0x2a4897&&_0x2a4897['trim']()){const _0x518dbd=document['createElement'](_0x38290b['yexEs']);_0x518dbd['value']=_0x2a4897,_0x518dbd['textContent']=_0x2a4897,_0x2a82dc[_0x526769(0x225)](_0x518dbd,_0x3d13e2),_0x2a82dc[_0x526769(0x209)]=_0x2a4897,_0xd2f1de&&(_0xd2f1de['type']=_0x2a4897,trackChanges());}else _0x2a82dc['value']=_0xd2f1de?_0xd2f1de['type']:_0x2a82dc['options'][0x0]['value'];},'onCancel':()=>{const _0x2c52d6=_0xab5a0c;_0x2a82dc['value']=_0xd2f1de?_0xd2f1de[_0x2c52d6(0x1e1)]:_0x2a82dc['options'][0x0]['value'];}});else _0xd2f1de&&(_0xd2f1de[_0xab5a0c(0x1e1)]=_0x2a82dc['value'],trackChanges());}let hasChanges=![];function trackChanges(){hasChanges=!![];}function handleClose(_0x35bf2f,_0x50c549){const _0x547352=_0xe95701;hasChanges?showCustomDialog({'title':'确认关闭','content':'您有未保存的修改，确定要关闭吗？','confirmText':'确定','cancelText':'取消','onConfirm':()=>{const _0x43529b=_0x431d;document['body']['removeChild'](_0x35bf2f),document[_0x43529b(0x208)]['removeChild'](_0x50c549),hasChanges=![];}}):(document[_0x547352(0x208)][_0x547352(0x38c)](_0x35bf2f),document['body'][_0x547352(0x38c)](_0x50c549));}function _0x3adf(){const _0x590bb1=['\x20个多行输入控件','qKSgW','isTranslating','updateEnabledState','计算位置时出错:','_blank','join','NUJSQ','data-element-id','blurHandler','brfrL','Douyin','classList','lastRequestTime','soLRc','oczof','preset-manager-button','Cgwta','prompt_history_popup','更新预设项状态时出错:','控制历史、撤销、重做功能','nodeId','focus','showTextPreview','GXuxp','setAttribute','VvGXy','rgb(240,\x20180,\x20240)','restore','remove','registerExtension','rPShU','检查节点:\x20','保存预设失败:','prompt_history_current','success','Dzfpb','NRKrC','prompt_history_node_id','safeRemoveElement','使用缓存翻译','dataset','preset_type_','0px','string','includes','初始化或清空节点\x20','text','onchange','popup_up','[PromptWidget]🔧兼容模式','button.widget_icon_button','prompt_text_updated','wctDu','quarter-width','设置后端调试模式失败:','POST','scale','alt','Baviw','prototype','warn','element','color_type','onclick','.prompt_widget_status','ttUhc','properties','\x20显示预设失败:','unshift','扩展卸载前清理完成','button','json','为节点\x20','发送文本到API，长度:\x20','PromptWidget.Debug.Frontend','[PromptWidget]🎉标准模式','comfy-menu-label','dom-widget','输入百度翻译Key','get','scale(','nOVPF',')到节点\x20','ksOfe','jvMJU','widgets','pgzBi','jbzAM','slice','getSettingValue','无需开启，遇到bug排查用的','处理配置更新事件失败:','cUirR','\x20翻译和扩写','fetchApi','api-config-form','kFhJF','getInstance','checkAndSetupNode','确定要删除这个预设吗？','\x20出错:','isExpanding','初始化','oqZKx','timer','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20flex;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20flex:\x201;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20overflow:\x20hidden;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20align-items:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','whiteSpace','dknYP','Static\x20Badge','TwFNW','vhCLQ','提示词预设词库管理','current','API配置','note','AiZmK','clipFloatUp\x200.5s\x20ease-in-out\x20forwards','\x20个实例','_onNodeSelectionChange','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22custom-dialog-button\x20primary\x22>','backgroundColor','replace','past','closeHistoryPopup','has','removeEventListener','Mccym','https://img.shields.io/badge/Version-','tVtMr','启用翻译功能','minInterval','closePresetPopup','执行操作失败:\x20','总开关','启用历史功能','display','zCRcl','offsetHeight','default','data-widget-key','message','8px','number','innerWidth','parentElement','getElementsByTagName','preset-loading-indicator','puOsm','0\x2010px','showStatusTip','收到翻译响应:','hideTimeout','activePresetPopup','change','\x20的实例或文本元素','widget_button_loading','operation_type','showEffect','rgb(135,\x20165,\x20255)','扩写失败','\x27)\x20!important;\x0a\x20\x20\x20\x20\x20\x20\x20\x20background-size:\x2016px\x20!important;\x0a\x20\x20\x20\x20\x20\x20\x20\x20background-position:\x20center\x20!important;\x0a\x20\x20\x20\x20\x20\x20\x20\x20background-repeat:\x20no-repeat\x20!important;\x0a\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x200.8;\x0a\x20\x20\x20\x20\x20\x20\x20\x20transition:\x20opacity\x200.2s;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x0a\x20\x20\x20\x20.move-top-button:hover\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x201;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x0a\x20\x20\x20\x20.move-top-button:disabled\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x200.3;\x0a\x20\x20\x20\x20\x20\x20\x20\x20cursor:\x20not-allowed;\x0a\x20\x20\x20\x20}\x0a','addOutsideClickHandler','createElement','lxTMb','operation_desc','initOrClearHistory','PromptWidget','flexWrap','翻译功能已禁用','none','handleDocumentClick','/prompt_widget/presets','selectionStart','vyTKw','pointerEvents','.prompt_history_popup','RqCVM','XAwmY','BJyAA','startsWith','top','所有功能已禁用，自动关闭小部件总开关','trim','graphToPrompt','prompt-preset-manager-content','keys','widget_button_active','width','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20flex;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20flex-direction:\x20column;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20width:\x20100%;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','url(\x27','bEmjn','GbCxO','appid','info','EiJCU','clearHistory','isCurrentNode','PromptWidget.About','\x20功能开关','statusTips','restoreButtonStates','name','\x20绘制前景时出错:','title','启用扩写功能','启用预设功能','offsetWidth','没有找到任何预设','fcZXM','正在打开提示词预设管理对话框...','input,\x20textarea','canvas','style','\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22custom-dialog-buttons\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','iwspc','stopPropagation','已应用预设','1px\x20solid\x20rgba(100,\x20255,\x20100,\x200.5)','在小部件中找到预设按钮','className','12px','#llm_api_base','rgb(140,\x20190,\x20230)','createPresetPopup','无法找到节点\x20','5028155mnSCNM','justifyContent','使用翻译按钮作为参考元素','prompt_history_title_bar','onNodeMoved','显示配置数据时出错:','llm_api_base','entries','asFzZ','[PromptWidget]节点\x20','click','preset-action-buttons','执行操作失败：参数不完整','请输入新的类型名称：','节点\x20','left','presets','loadPresets','RYmzX','button[title*=\x22预设\x22]','clip-translate-status','rgb(140,\x20220,\x20140)','BUTTON','JYmCd','API响应:\x20','widget_button_disabled','CxABt','nodes','AZQCx','\x20匹配的元素时出错:','读取清理间隔设置失败，使用默认值60秒','\x20的实例是否存在时出错:','✨提示词小部件','widget_show','updateButtonStates','removeChild','创建翻译按钮失败:','split','BbCBb','api-config-row','添加新类型','vgnrO','.preset-content-input','zBIvl','成功创建节点\x20','2759706CIPJuO','24px','正在打开API配置对话框...','点击管理提示词预设按钮出错:','DjNeV','PGHVP','翻译请求失败:\x20','boolean','加载预设失败:','\x20translateX(','KMBpm','timeoutId','textDecoration','new','feHUC','kKxED','cleanup','显示状态提示时出错:','instances','\x20的\x20','querySelector','prompt_history_text','kePSB','1.0.1','1326314tnPCnv','已撤销节点\x20','getAttribute','PNwix','button[title*=\x22历史\x22]','onDrawBackground','2|1|3|0|4','[节点删除]\x20已清理\x20','VkbPz','block','minWidth','.preset-clean-button-container','img','undo','add','SrbMt','updatePresetItemState','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22custom-dialog-content\x22>','Yjsdg','30px','您可以在这里管理提示词预设，修改后请点击保存按钮。注意：结尾不要加逗号！！','zIndex','eRmuL','mENnj','6888364KnjAhz','enabled','color','dPqMW','addEventListener','push','ComfyUI.PromptWidget','application/json','qZCmu',';\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transition:\x20all\x200.2s;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','alignItems','preset','multiline','preset-action-button\x20move-top-button','4|3|1|0|2','tfBXs','保存失败','打开管理界面','head','disableAllButtons','max','settings','PromptWidget.Cleanup.Interval','substring','localeCompare','input','recordHistory','使用扩写按钮作为参考元素','AYDYV','text_element','setupWebSocket','LoVIc','loading','dfaDi','redoOperation','WqBrr','apply','SmpmQ','\x20的历史时出错:','0|4|1|3|2','eRPuW','parentNode','prompt_history_list','stringify','https://api.openai.com/v1','#key','当前无历史记录','temperature','KpAVT','隐藏节点\x20','1px\x20solid\x20rgba(100,\x20100,\x20255,\x200.5)','FzmhE','select','KnIhd','bottom','API\x20Key','前端调试模式已','updateTextInput','.translate-button-','juWcO','XURkt','getBoundingClientRect','inputEl','已应用历史记录(源自节点\x20','vhtPc','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background:\x20none;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border:\x20none;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20rgba(255,\x20255,\x20255,\x200.4);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2014px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20cursor:\x20pointer;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20padding:\x200\x204px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin-left:\x204px;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20','splice','配置数据加载完成','match','aWivT','llm_expand','removeElement','textElement','调试选项','addHistoryItem','ziyIp','translationCache','innerHTML','没有历史记录可显示','\x20个空实例（不包含有历史记录的实例），当前剩余\x20','rXyvp','xGrLA','iyMMH','option','querySelectorAll','创建API配置对话框时出错:\x20','\x20的历史按钮','activeHistoryPopup','prompt_preset_type','data-node-id','cleanupInterval','graph','尝试创建翻译小部件:\x20','Xndrl','api_key','成功为节点\x20','prompt_preset_content','196952pOnOEn','lastRequestText','forEach','opacity','type','UMMkP','updateTextValue','PoFKz','isHiding','KqVeZ','statusText','success-toast','rxjDT','closing-up','find','popup_down','wvdQR','fontSize','PromptWidget.Features.History','JwQJI','wHfva','\x20已清理，当前剩余\x20','float_out','找不到节点\x20','qAMQd','div','textContent','0.1','api-config-textarea','hcyvy','rgba(255,\x20255,\x20255,\x200.1)','styleElement','ASXLR','expand','buttons','target','FZBrP','小部件清理间隔已更新为\x20','translate','\x20的实例','wrap','contains','getTransform','body','value','auto','onNodeSelectionChange','closest','preset-close-button','cdrkA','error','printedMessages','resize','请求失败:\x20','Temperature','href','length','历史记录','正在加载预设数据...','3190950HKHawL','无法显示历史记录：找不到节点\x20','from','removeTimeoutId','innerHeight','tagName','\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','创建预设管理对话框时出错:','min','OIVRq','index','kSDaT','执行节点\x20','insertBefore','0.8','extra','rel','cleanPresetFromInput','Ojkqo','__CLIP_TRANSLATE__','AIRHH','lmWVb','无法启用小部件：所有功能都处于禁用状态','翻译中...\x20','HTTP\x20error!\x20status:\x20','TgqTy','(缓存)','hideNodeWidgets','未知操作类型:\x20','multiline-input','翻译功能','DbaRB','src','_originalNodeSelectionChange','widget_hide','red','输入最大token数','cssText','stopPeriodicCleanup','height','api-config-container','创建预设按钮失败:','some','position','offset','UtPPi','.prompt_widget_box','PromptWidget.Features.Enabled','assign','appendChild','PromptWidget.Compatibility.Mode','20px','MPWDF','history','preset-overlay','flex','添加新类型...','Bdxyi','vpDjc','nQOiM','status','selectionEnd','小部件功能已启用，恢复所有相关服务','isEmptyInstance','初始化PromptWidget扩展','0\x200','oxQhu','transform','LLM扩写配置','showHistory','更新失败','\x20的历史记录','textarea','custom-dialog','inline-flex','gap','fMbHz','jlKvY','disabled','jIWPc','fqGhN','控制文本翻译功能','加载配置失败:','addHoverEffect','21610309OscJvU','amUGW','OBfXg','翻译处理中，请稍候...','collapsed','button[title*=\x22翻译\x22]','content','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20display:\x20flex;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20justify-content:\x20space-between;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20align-items:\x20center;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','rnnxI','size','flexShrink','wrapper','log','EDBpt','VdBtz','TZBpn','XfoAZ','originalText','center','kotjW','预设内容已存在','transformOrigin','system_prompt','\x20current','ITGqW','撤销节点\x20','prompt_translate'];_0x3adf=function(){return _0x590bb1;};return _0x3adf();}async function handleSave(_0x4d15f2,_0x1a5bb7,_0x34ed5a){const _0x54942e=_0xe95701,_0x22d86e={'LENPO':function(_0x336f56,_0x300b1a){return _0x336f56(_0x300b1a);},'Xndrl':function(_0x41adeb,_0x4eb054,_0x3c653d){return _0x41adeb(_0x4eb054,_0x3c653d);},'xKwhs':'application/json','pVPaK':'保存成功！预设已更新','zQpgq':_0x54942e(0x2a8)};try{const _0x3987f3=await _0x22d86e['LENPO'](loadPresetData,_0x34ed5a),_0x2d6dfb=await _0x22d86e[_0x54942e(0x1d9)](fetch,'/prompt_widget/save_presets',{'method':_0x54942e(0x2bf),'headers':{'Content-Type':_0x22d86e['xKwhs']},'body':JSON['stringify']({'presets':_0x3987f3})}),_0x53d1d8=await _0x2d6dfb['json']();if(!_0x2d6dfb['ok'])throw new Error(_0x53d1d8[_0x54942e(0x314)]||'保存失败:\x20'+_0x2d6dfb['status']+'\x20'+_0x2d6dfb['statusText']);if(_0x53d1d8['status']===_0x54942e(0x2aa))await TranslateManager['reloadConfig'](),showSuccessToast(_0x22d86e['pVPaK']),hasChanges=![];else throw new Error(_0x53d1d8[_0x54942e(0x314)]||'保存失败');}catch(_0x3f7fcf){console[_0x54942e(0x20f)](_0x22d86e['zQpgq'],_0x3f7fcf),showCustomDialog({'title':_0x54942e(0x3d6),'content':_0x3f7fcf['message'],'confirmText':'确定'});}}async function showAPIConfigDialog(){const _0x3f2ab7=_0xe95701,_0x495b33={'BWPKS':function(_0x41039f,_0x4598df){return _0x41039f===_0x4598df;},'OuPjM':'preset-overlay','yqrbG':'div','QOQqD':_0x3f2ab7(0x31a),'amEBF':'正在加载配置数据...','KwYby':_0x3f2ab7(0x240),'RCMVl':'api-config-section','hWyfy':'appid','GbCxO':'half-width','PLAkg':_0x3f2ab7(0x2b6),'PNwix':_0x3f2ab7(0x2d6),'pltxH':'api-config-form','xAyQx':_0x3f2ab7(0x390),'ksqCn':_0x3f2ab7(0x3fd),'XqbrM':'输入LLM\x20API\x20Key','dyTPG':'number','oirqY':function(_0x256058,_0x15a84d,_0x5755c8,_0x10bc98,_0x446dff,_0x5df548,_0x2bec78,_0x3722ce,_0x27f1b9){return _0x256058(_0x15a84d,_0x5755c8,_0x10bc98,_0x446dff,_0x5df548,_0x2bec78,_0x3722ce,_0x27f1b9);},'JLfKG':'textarea','LXcfA':'click','WzXEo':function(_0x101f3b){return _0x101f3b();},'aPxYA':function(_0x5e0949,_0xc8d8f0,_0x54ea81){return _0x5e0949(_0xc8d8f0,_0x54ea81);},'jugPs':_0x3f2ab7(0x35a),'AZQCx':'创建API配置对话框时出错:'};try{if(DEBUG)console['log'](_0x3f2ab7(0x398));hasChanges=![];const _0x4da40e=document['createElement']('div');_0x4da40e['className']=_0x495b33['OuPjM'],document['body'][_0x3f2ab7(0x249)](_0x4da40e);const _0x51ff21=document['createElement'](_0x495b33['yqrbG']);_0x51ff21[_0x3f2ab7(0x363)]='prompt-preset-manager-dialog';const _0x4db131=document[_0x3f2ab7(0x32a)]('div');_0x4db131['className']='prompt-preset-manager-content';const _0x5b78c1=document['createElement']('button');_0x5b78c1[_0x3f2ab7(0x363)]=_0x3f2ab7(0x20d),_0x5b78c1['innerHTML']='&#215;',_0x5b78c1['onclick']=()=>handleClose(_0x51ff21,_0x4da40e),_0x4db131[_0x3f2ab7(0x249)](_0x5b78c1);const _0x412b3e=document[_0x3f2ab7(0x32a)]('h2');_0x412b3e[_0x3f2ab7(0x363)]='prompt-preset-title',_0x412b3e['textContent']=_0x3f2ab7(0x2f9),_0x4db131['appendChild'](_0x412b3e);const _0x5e73f1=document['createElement']('p');_0x5e73f1['textContent']='配置百度翻译和LLM扩写功能的API参数。',_0x5e73f1['style']['marginBottom']=_0x3f2ab7(0x2b2),_0x4db131['appendChild'](_0x5e73f1);const _0x2a3979=document['createElement']('div');_0x2a3979['className']=_0x495b33['QOQqD'],_0x2a3979[_0x3f2ab7(0x1f7)]=_0x495b33['amEBF'],_0x4db131['appendChild'](_0x2a3979);const _0x208ec0=document[_0x3f2ab7(0x32a)]('div');_0x208ec0['className']=_0x495b33['KwYby'],_0x208ec0[_0x3f2ab7(0x35c)][_0x3f2ab7(0x30f)]='none';const _0x8a019a=document['createElement']('div');_0x8a019a['className']=_0x495b33['RCMVl'];const _0x3687d0=document['createElement']('h3');_0x3687d0['textContent']='百度翻译配置',_0x8a019a['appendChild'](_0x3687d0);const _0x17bd0d=document['createElement'](_0x495b33['yqrbG']);_0x17bd0d[_0x3f2ab7(0x363)]=_0x3f2ab7(0x2e7);const _0x306f04=document['createElement'](_0x495b33['yqrbG']);_0x306f04['className']=_0x3f2ab7(0x390);const _0x21335c=createInputGroup('百度翻译AppID',_0x495b33['hWyfy'],'text','输入百度翻译AppID',null,null,null,_0x495b33[_0x3f2ab7(0x347)]);_0x306f04['appendChild'](_0x21335c);const _0x2ba442=createInputGroup('百度翻译Key','key',_0x495b33['PLAkg'],_0x495b33[_0x3f2ab7(0x3b1)],null,null,null,'half-width');_0x306f04['appendChild'](_0x2ba442),_0x17bd0d[_0x3f2ab7(0x249)](_0x306f04),_0x8a019a[_0x3f2ab7(0x249)](_0x17bd0d),_0x208ec0['appendChild'](_0x8a019a);const _0x5d0be3=document['createElement']('div');_0x5d0be3['className']='api-config-section';const _0x3f4419=document['createElement']('h3');_0x3f4419['textContent']=_0x3f2ab7(0x25c),_0x5d0be3['appendChild'](_0x3f4419);const _0x30df4c=document['createElement']('div');_0x30df4c[_0x3f2ab7(0x363)]=_0x495b33['pltxH'];const _0x1dea52=document[_0x3f2ab7(0x32a)](_0x495b33['yqrbG']);_0x1dea52['className']=_0x495b33['xAyQx'];const _0x375f39=createInputGroup(_0x495b33['ksqCn'],'llm_api_key','text',_0x495b33['XqbrM'],null,null,null,_0x495b33['GbCxO']);_0x1dea52['appendChild'](_0x375f39);const _0x10b5ad=createInputGroup('API\x20Base\x20URL',_0x3f2ab7(0x36f),_0x495b33['PLAkg'],'输入API\x20Base\x20URL',null,null,null,_0x495b33['GbCxO']);_0x1dea52[_0x3f2ab7(0x249)](_0x10b5ad),_0x30df4c[_0x3f2ab7(0x249)](_0x1dea52);const _0x2f2af6=document['createElement']('div');_0x2f2af6['className']='api-config-row';const _0x16c6b5=createInputGroup('模型','llm_model',_0x3f2ab7(0x2b6),'输入模型名称',null,null,null,'model-width');_0x2f2af6['appendChild'](_0x16c6b5);const _0x37e536=createInputGroup(_0x3f2ab7(0x213),'llm_temperature',_0x495b33['dyTPG'],'输入temperature值','0','1',_0x3f2ab7(0x1f8),_0x3f2ab7(0x2bd));_0x2f2af6['appendChild'](_0x37e536);const _0x407234=createInputGroup('Max\x20Tokens','llm_max_tokens',_0x495b33['dyTPG'],_0x3f2ab7(0x23c),'1','2000','1','quarter-width');_0x2f2af6['appendChild'](_0x407234),_0x30df4c['appendChild'](_0x2f2af6);const _0x4d1210=_0x495b33['oirqY'](createInputGroup,'System\x20Prompt','llm_system_prompt',_0x495b33['JLfKG'],'输入系统提示词',null,null,null,'full-width');_0x30df4c['appendChild'](_0x4d1210),_0x5d0be3['appendChild'](_0x30df4c),_0x208ec0['appendChild'](_0x5d0be3),_0x4db131['appendChild'](_0x208ec0);const _0x507e3d=document['createElement'](_0x495b33['yqrbG']);_0x507e3d['className']='api-config-footer';const _0x406917=document[_0x3f2ab7(0x32a)]('button');_0x406917['className']='api-config-save',_0x406917[_0x3f2ab7(0x1f7)]='保存',_0x406917['onclick']=()=>handleSaveConfig(_0x51ff21,_0x4da40e,_0x208ec0),_0x507e3d['appendChild'](_0x406917),_0x4db131['appendChild'](_0x507e3d),_0x51ff21['appendChild'](_0x4db131),document['body']['appendChild'](_0x51ff21),_0x51ff21['addEventListener'](_0x495b33['LXcfA'],_0xdaba68=>{const _0x29cbb2=_0x3f2ab7;_0x495b33['BWPKS'](_0xdaba68[_0x29cbb2(0x200)],_0x51ff21)&&handleClose(_0x51ff21,_0x4da40e);});try{const _0x5cd29b=await _0x495b33['WzXEo'](loadConfig);await new Promise(_0x30e186=>setTimeout(_0x30e186,0x64)),await _0x495b33['aPxYA'](displayConfig,_0x208ec0,_0x5cd29b);const _0x43d70c=_0x208ec0[_0x3f2ab7(0x1d0)](_0x495b33['jugPs']);_0x43d70c['forEach'](_0xe056f0=>{const _0xdbd4a9=_0x3f2ab7;_0xe056f0[_0xdbd4a9(0x3ca)](_0xdbd4a9(0x321),trackChanges);}),_0x2a3979['style']['display']=_0x3f2ab7(0x331),_0x208ec0[_0x3f2ab7(0x35c)][_0x3f2ab7(0x30f)]='block';if(DEBUG)console['log'](_0x3f2ab7(0x409));}catch(_0x1f68c3){_0x2a3979['textContent']='加载失败:\x20'+_0x1f68c3['message'],_0x2a3979['style']['color']=_0x3f2ab7(0x23b),console['error']('配置数据加载失败:',_0x1f68c3);}}catch(_0x214c1c){console[_0x3f2ab7(0x20f)](_0x495b33[_0x3f2ab7(0x385)],_0x214c1c),showCustomDialog({'title':'错误','content':_0x3f2ab7(0x1d1)+_0x214c1c[_0x3f2ab7(0x314)],'confirmText':'确定','showCancel':![]});}}function createInputGroup(_0x111c10,_0x116423,_0x3cdecc,_0x56b0f5,_0x22cd2c,_0x4025a0,_0x27952e,_0x2c2790=''){const _0xab37ef=_0xe95701,_0x1007cf={'Dzfpb':function(_0x40e727,_0x49293c){return _0x40e727===_0x49293c;},'Mccym':'number','hxzmF':'api-config-input'},_0x497b8b=document[_0xab37ef(0x32a)]('div');_0x497b8b['className']='api-config-group\x20'+_0x2c2790;const _0x5cfb7f=document[_0xab37ef(0x32a)]('label');_0x5cfb7f['textContent']=_0x111c10,_0x5cfb7f['htmlFor']=_0x116423,_0x497b8b['appendChild'](_0x5cfb7f);let _0x5f0389;return _0x1007cf[_0xab37ef(0x2ab)](_0x3cdecc,_0xab37ef(0x260))?(_0x5f0389=document[_0xab37ef(0x32a)](_0xab37ef(0x260)),_0x5f0389['rows']=0x4):(_0x5f0389=document[_0xab37ef(0x32a)]('input'),_0x5f0389['type']=_0x3cdecc,_0x3cdecc===_0x1007cf[_0xab37ef(0x306)]&&(_0x5f0389[_0xab37ef(0x220)]=_0x22cd2c,_0x5f0389['max']=_0x4025a0,_0x5f0389['step']=_0x27952e)),_0x5f0389['id']=_0x116423,_0x5f0389['name']=_0x116423,_0x5f0389['className']=_0x3cdecc==='textarea'?_0xab37ef(0x1f9):_0x1007cf['hxzmF'],_0x5f0389['placeholder']=_0x56b0f5,_0x497b8b[_0xab37ef(0x249)](_0x5f0389),_0x497b8b;}async function loadConfig(){const _0x3ac5e0=_0xe95701;try{const _0x191cf5=await fetch('/prompt_widget/load_config');if(!_0x191cf5['ok'])throw new Error('Failed\x20to\x20load\x20config:\x20'+_0x191cf5['status']+'\x20'+_0x191cf5['statusText']);const _0x477150=await _0x191cf5[_0x3ac5e0(0x2cf)]();return _0x477150;}catch(_0x3a9b0a){console[_0x3ac5e0(0x20f)](_0x3ac5e0(0x26a),_0x3a9b0a);throw _0x3a9b0a;}}async function displayConfig(_0x3a896e,_0x52e746){const _0xdf7c9b=_0xe95701,_0x1fe7e1={'Msffr':_0xdf7c9b(0x36e)};try{if(_0x52e746['prompt_translate']){const _0x409181=_0x3a896e['querySelector']('#appid'),_0x37a60c=_0x3a896e['querySelector'](_0xdf7c9b(0x3f3));if(_0x409181)_0x409181['value']=_0x52e746['prompt_translate'][_0xdf7c9b(0x348)]||'';if(_0x37a60c)_0x37a60c['value']=_0x52e746[_0xdf7c9b(0x286)]['key']||'';}if(_0x52e746['llm_expand']){const _0x44dd1d={'llm_api_key':_0x52e746[_0xdf7c9b(0x1c2)][_0xdf7c9b(0x1da)]||'','llm_api_base':_0x52e746[_0xdf7c9b(0x1c2)]['api_base']||_0xdf7c9b(0x3f2),'llm_model':_0x52e746[_0xdf7c9b(0x1c2)]['model']||'gpt-3.5-turbo','llm_temperature':_0x52e746['llm_expand'][_0xdf7c9b(0x3f5)]||0.7,'llm_max_tokens':_0x52e746['llm_expand']['max_tokens']||0x3e8,'llm_system_prompt':_0x52e746['llm_expand'][_0xdf7c9b(0x282)]||''};Object[_0xdf7c9b(0x370)](_0x44dd1d)['forEach'](([_0x20c91c,_0x510903])=>{const _0x9b947a=_0xdf7c9b,_0x247720=_0x3a896e[_0x9b947a(0x3aa)]('#'+_0x20c91c);_0x247720?_0x247720[_0x9b947a(0x209)]=_0x510903:console[_0x9b947a(0x2c4)]('找不到ID为\x20'+_0x20c91c+'\x20的输入框');});}}catch(_0x3a8cbf){console['error'](_0x1fe7e1['Msffr'],_0x3a8cbf);throw _0x3a8cbf;}}async function handleSaveConfig(_0x179f15,_0x5741b3,_0x3ad53f){const _0x2c1227=_0xe95701,_0x3cf064={'JxifB':'#appid','DAdRJ':'#llm_api_key','HnHOx':'#llm_model','cQefL':function(_0x5e869e,_0x5402b5){return _0x5e869e(_0x5402b5);},'UOvtO':function(_0x202c02,_0x2ffc87,_0x548627){return _0x202c02(_0x2ffc87,_0x548627);},'SdnMr':'POST','JmGvY':function(_0x10b278,_0xa22faf){return _0x10b278(_0xa22faf);}};try{const _0x4a775d={'prompt_translate':{'appid':_0x3ad53f[_0x2c1227(0x3aa)](_0x3cf064['JxifB'])[_0x2c1227(0x209)],'key':_0x3ad53f['querySelector']('#key')[_0x2c1227(0x209)]},'llm_expand':{'api_key':_0x3ad53f[_0x2c1227(0x3aa)](_0x3cf064['DAdRJ'])['value'],'api_base':_0x3ad53f['querySelector'](_0x2c1227(0x365))['value'],'model':_0x3ad53f['querySelector'](_0x3cf064['HnHOx'])[_0x2c1227(0x209)],'temperature':parseFloat(_0x3ad53f[_0x2c1227(0x3aa)]('#llm_temperature')['value']),'max_tokens':_0x3cf064['cQefL'](parseInt,_0x3ad53f[_0x2c1227(0x3aa)]('#llm_max_tokens')['value']),'system_prompt':_0x3ad53f[_0x2c1227(0x3aa)]('#llm_system_prompt')['value']}},_0x5d38bc=await _0x3cf064['UOvtO'](fetch,'/prompt_widget/save_config',{'method':_0x3cf064['SdnMr'],'headers':{'Content-Type':'application/json'},'body':JSON[_0x2c1227(0x3f1)](_0x4a775d)}),_0x3ea767=await _0x5d38bc['json']();if(!_0x5d38bc['ok'])throw new Error(_0x3ea767['message']||'保存失败:\x20'+_0x5d38bc['status']+'\x20'+_0x5d38bc['statusText']);if(_0x3ea767['status']==='success'){const _0x5688aa='4|1|2|3|0'['split']('|');let _0x3fc735=0x0;while(!![]){switch(_0x5688aa[_0x3fc735++]){case'0':document[_0x2c1227(0x208)]['removeChild'](_0x5741b3);continue;case'1':_0x3cf064['JmGvY'](showSuccessToast,'保存成功！配置已更新');continue;case'2':hasChanges=![];continue;case'3':document[_0x2c1227(0x208)][_0x2c1227(0x38c)](_0x179f15);continue;case'4':await TranslateManager['reloadConfig']();continue;}break;}}else throw new Error(_0x3ea767['message']||_0x2c1227(0x3d6));}catch(_0x2490e7){console[_0x2c1227(0x20f)]('保存配置失败:',_0x2490e7),showCustomDialog({'title':'保存失败','content':_0x2490e7[_0x2c1227(0x314)],'confirmText':'确定'});}}function movePresetToTop(_0xaffdcf,_0xabd839,_0x27fdf6){const _0x2f4f97=_0xe95701,_0x29a131={'eWueY':function(_0x37a389){return _0x37a389();},'JAgzi':'移动预设到顶部时出错:'};try{if(_0xaffdcf===0x0)return![];const _0x3626fa=Array['from'](_0xabd839['getElementsByTagName']('tr'))['slice'](0x0,-0x1),_0x28edd8=_0x3626fa[_0xaffdcf];if(!_0x28edd8)return![];const _0x17d331=_0x27fdf6[_0x2f4f97(0x408)](_0xaffdcf,0x1)[0x0];return _0x27fdf6['unshift'](_0x17d331),_0xabd839['insertBefore'](_0x28edd8,_0xabd839['firstChild']),updatePresetRows(_0xabd839,_0x27fdf6),_0x29a131['eWueY'](trackChanges),!![];}catch(_0x50d259){return console[_0x2f4f97(0x20f)](_0x29a131['JAgzi'],_0x50d259),![];}}function _0x431d(_0x4671fc,_0xe84dc1){const _0x3adf70=_0x3adf();return _0x431d=function(_0x431d51,_0x2208c2){_0x431d51=_0x431d51-0x1c1;let _0x482fbf=_0x3adf70[_0x431d51];return _0x482fbf;},_0x431d(_0x4671fc,_0xe84dc1);}const moveTopButtonStyle=document['createElement'](_0xe95701(0x35c));moveTopButtonStyle['textContent']='\x0a\x20\x20\x20\x20.move-top-button\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20background-image:\x20url(\x27'+import.meta['url']['replace']('prompt_widget.js','assets/icon-movetop.svg')+_0xe95701(0x328),document['head'][_0xe95701(0x249)](moveTopButtonStyle);